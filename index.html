<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://edfnhhthztskuuosuasw.supabase.co/storage/v1/object/public/product-photos/icon3.jpg">
    <title>FengWei Pai 美食团购系统</title>
    
    <!-- 本地样式文件 -->
    <link rel="stylesheet" href="tailwind.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <!-- ===== 内嵌配置文件 - 融合 PR#1-#8 所有配置 ===== -->
    <script>
        // 锋味派美食团购系统 - 完整集成配置
        // 融合 PR#1-#8 所有升级功能的单文件配置
        window.AppConfig = {
            // ===== Supabase 数据库配置 =====
            SUPABASE_URL: 'https://edfnhhthztskuuosuasw.supabase.co',
            SUPABASE_ANON_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVkZm5oaHRoenRza3V1b3N1YXN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5OTYxMTYsImV4cCI6MjA2NTU3MjExNn0.O3g2gjvsWagmWgmzoeJA8mPampvLYJr-KgqVwXsKoAo',
            
            // ===== 业务配置信息 =====
            WHATSAPP_NUMBER: '60162327792',
            ADMIN_PASSWORD: 'fengweipaiadmin',
            SELF_PICKUP_ADDRESS: '667, Jalan 24, Taman Perindustrian Ehsan Jaya, Kepong, 52100, Kuala Lumpur.',
            PRODUCT_IMAGE_BASE_URL: 'https://edfnhhthztskuuosuasw.supabase.co/storage/v1/object/public/product-photos/',
            
            // ===== 会员系统功能模块化开关 - PR#8 升级功能 =====
            MEMBER_FEATURES: {
                ENABLED: true,                 // 会员系统总开关
                POINTS_SYSTEM: true,           // 积分功能开关 (PR#8)
                LOGIN_REQUIRED: false,         // 登录功能开关
                ORDER_HISTORY: true,           // 个人订单历史查看开关 (PR#8)
                AUTO_MERGE_ORDERS: true,       // 自动合并订单开关 (PR#8)
                AUTO_CREATE_MEMBER: true       // 自动创建会员开关 (PR#8)
            },
            
            // ===== 商品管理功能开关 - PR#1-5 升级功能 =====
            PRODUCT_FEATURES: {
                IMAGE_UPLOAD: true,            // 图片上传功能 (PR#2,#3)
                CATEGORY_SEARCH: true,         // 分类搜索功能 (PR#1)
                LOW_STOCK_ALERT: true,         // 低库存提醒 (PR#5)
                FIELD_COMPATIBILITY: true      // 字段兼容性 (PR#2,#5)
            },
            
            // ===== 订单管理功能开关 - PR#2-7 升级功能 =====
            ORDER_FEATURES: {
                ORDER_MERGING: true,           // 合并订单 (PR#2,#8) 
                ORDER_ID_OPTIMIZATION: true,   // 订单号优化 (PR#2)
                PAYMENT_PROOF_UPLOAD: true,   // 支付凭证上传 (PR#3,#7)
                ORDER_STATUS_REFINEMENT: true, // 订单状态细化 (PR#5,#6)
                SHIPPING_NOTIFICATIONS: true   // 运费通知 (PR#3)
            },
            
            // ===== 后台管理功能开关 - PR#1,#4-8 升级功能 =====
            ADMIN_FEATURES: {
                DASHBOARD_ANALYTICS: true,     // 数据分析仪表盘 (PR#1,#8)
                MOBILE_RESPONSIVE: true,      // 移动端响应式 (PR#1,#9)
                PASSWORD_TOGGLE: true,        // 密码可见性切换 (PR#7)
                MEMBER_MANAGEMENT: true       // 会员管理界面 (PR#8)
            },
            
            // ===== 扫码/拍照功能开关 - PR#6,#9 升级功能 =====
            SCAN_PHOTO_FEATURES: {
                QR_SCANNING: true,            // 二维码扫描
                PHOTO_CAPTURE: true,          // 拍照功能
                PAYMENT_QR_DISPLAY: true      // 支付二维码显示
            },
            
            // ===== 马来西亚手机号验证规则 - PR#8 升级 =====
            PHONE_VALIDATION: {
                ALLOW_LOCAL_FORMAT: true,     // 允许本地格式 (0162327792)
                ALLOW_INTL_FORMAT: true,      // 允许国际格式 (60162327792)
                CONVERT_TO_INTL: false,       // 保持原格式存储，兼容现有数据
                LOCAL_PREFIX: '0',            // 本地格式前缀
                INTL_PREFIX: '60',            // 国际格式前缀
                MIN_LENGTH: 10,               // 最小长度
                MAX_LENGTH: 12                // 最大长度
            },
            
            // ===== 系统设置 =====
            SYSTEM_SETTINGS: {
                DEFAULT_LANGUAGE: 'zh-CN',
                CURRENCY: 'RM',
                TIMEZONE: 'Asia/Kuala_Lumpur',
                DATE_FORMAT: 'DD/MM/YYYY',
                TIME_FORMAT: '24h'
            }
        };

        // ===== 配置验证函数 =====
        window.AppConfig.validate = function() {
            const required = ['SUPABASE_URL', 'SUPABASE_ANON_KEY'];
            const missing = required.filter(key => !this[key] || this[key].includes('your-'));
            
            if (missing.length === 0) {
                console.log('✅ 融合配置验证通过 - 所有PR#1-#8功能已集成');
                console.log('📱 手机号验证: 支持本地格式 (0162327792) 和国际格式 (60162327792)');
                console.log('🔧 会员功能模块化开关已启用');
                console.log('💳 商品管理、订单管理、数据分析功能已集成');
            } else {
                console.warn('⚠️ 配置文件警告: 以下配置项需要更新:', missing);
            }
            
            return missing.length === 0;
        };

        // 自动验证配置
        if (typeof window !== 'undefined') {
            window.AppConfig.validate();
        }
    </script>
    
    <!-- React 和相关库 - 使用可靠的CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        /* 全局样式 */
        * { box-sizing: border-box; }
        body { 
            font-family: system-ui, -apple-system, 'Segoe UI', sans-serif; 
            line-height: 1.6; 
            margin: 0; 
            padding: 0; 
            background-color: #f8fafc;
        }
        
        /* 加载动画 */
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        
        /* 渐变背景 */
        .gradient-bg { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); }
        
        /* 统一按钮样式 */
        .btn { 
            padding: 0.75rem 1.5rem; 
            border: none; 
            border-radius: 0.5rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.2s; 
            display: inline-flex; 
            align-items: center; 
            gap: 0.5rem;
            text-decoration: none;
        }
        .btn:hover { transform: translateY(-1px); }
        .btn-primary { background: #dc2626; color: white; }
        .btn-primary:hover { background: #b91c1c; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-success { background: #16a34a; color: white; }
        .btn-success:hover { background: #15803d; }
        
        /* 卡片样式 */
        .card { 
            background: white; 
            border-radius: 0.75rem; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); 
            padding: 2rem; 
        }
        .card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        /* 响应式网格 */
        .grid { display: grid; gap: 2rem; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        @media (max-width: 768px) {
            .md\\:grid-cols-2 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        }
        
        /* 容器和布局 */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        .text-center { text-align: center; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        
        /* 文本样式 */
        .text-4xl { font-size: 2.25rem; font-weight: bold; }
        .text-2xl { font-size: 1.5rem; font-weight: bold; }
        .text-xl { font-size: 1.25rem; }
        
        /* 颜色 */
        .text-gray-900 { color: #111827; }
        .text-gray-600 { color: #4b5563; }
        .text-red-600 { color: #dc2626; }
        .text-blue-600 { color: #2563eb; }
        .text-white { color: white; }
        
        /* 间距 */
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-6 { margin-top: 1.5rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        
        /* 加载指示器 */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background: rgba(255, 255, 255, 0.9);
            padding: 2rem;
            border-radius: 0.75rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="root">
        <!-- 加载中显示 -->
        <div class="loading" id="loadingIndicator">
            <div class="animate-spin" style="width: 40px; height: 40px; border: 4px solid #f3f4f6; border-top: 4px solid #dc2626; border-radius: 50%; margin: 0 auto 16px;"></div>
            <div>正在加载锋味派美食团购系统...</div>
        </div>
        
        <!-- 如果JavaScript被禁用或失败时显示的备用内容 -->
        <noscript>
            <div class="container py-8">
                <div class="text-center">
                    <h1 class="text-4xl mb-4">🍽️ 锋味派美食团购</h1>
                    <p class="text-xl text-gray-600 mb-8">请启用JavaScript以使用完整功能，或直接联系我们订购</p>
                    <div class="card" style="max-width: 600px; margin: 0 auto;">
                        <h2 class="text-2xl text-red-600 mb-4">📞 联系我们</h2>
                        <div class="space-y-3">
                            <div><strong>WhatsApp:</strong> 0162327792</div>
                            <div><strong>自取地址:</strong><br>
                                667, Jalan 24, Taman Perindustrian Ehsan Jaya,<br>
                                Kepong, 52100, Kuala Lumpur.
                            </div>
                        </div>
                        <div class="mt-6">
                            <a href="https://wa.me/60162327792?text=您好，我想订购锋味派美食" class="btn btn-success">
                                <i class="fab fa-whatsapp"></i> WhatsApp 订购
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </noscript>
    </div>

    <script>
        // 简单的应用初始化脚本
        window.addEventListener('load', function() {
            // 检查必需的库是否加载
            if (typeof React === 'undefined') {
                document.getElementById('loadingIndicator').innerHTML = 
                    '<div style="color: red;">React 库加载失败，请刷新页面重试</div>';
                return;
            }
            
            if (typeof ReactDOM === 'undefined') {
                document.getElementById('loadingIndicator').innerHTML = 
                    '<div style="color: red;">ReactDOM 库加载失败，请刷新页面重试</div>';
                return;
            }
            
            if (typeof supabase === 'undefined') {
                document.getElementById('loadingIndicator').innerHTML = 
                    '<div style="color: red;">Supabase 库加载失败，请刷新页面重试</div>';
                return;
            }

            // 隐藏加载指示器
            const loading = document.getElementById('loadingIndicator');
            if (loading) {
                loading.style.display = 'none';
            }

            // 初始化React应用
            initializeApp();
        });

        // ===== 融合 PR#1-#8 的应用初始化函数 =====
        function initializeApp() {
            // 使用内嵌配置 - 确保无需外部 config.js 文件
            const config = window.AppConfig;
            const SUPABASE_URL = config.SUPABASE_URL;
            const SUPABASE_ANON_KEY = config.SUPABASE_ANON_KEY;
            
            // 创建Supabase客户端
            const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            
            // ===== 会员服务 - PR#8 升级功能 =====
            const MemberService = {
                // 检查会员是否存在 (PR#8: 手机号唯一识别)
                async checkMemberExists(phone) {
                    if (!config.MEMBER_FEATURES.ENABLED) return null;
                    
                    const { data, error } = await supabaseClient
                        .from('members')
                        .select('*')
                        .eq('phone', phone)
                        .single();
                    
                    return error ? null : data;
                },
                
                // 自动创建会员 (PR#8: 自动创建)
                async createMember(memberData) {
                    if (!config.MEMBER_FEATURES.AUTO_CREATE_MEMBER) return null;
                    
                    const { data, error } = await supabaseClient
                        .from('members')
                        .insert([{
                            phone: memberData.phone,
                            name: memberData.name,
                            points: 0,
                            total_orders: 0,
                            total_amount: 0.00
                        }])
                        .select()
                        .single();
                        
                    return error ? null : data;
                },
                
                // 获取未完成订单 (PR#8: 订单合并功能)
                async getIncompleteOrders(phone) {
                    if (!config.MEMBER_FEATURES.AUTO_MERGE_ORDERS) return [];
                    
                    const { data, error } = await supabaseClient
                        .from('orders')
                        .select('*')
                        .eq('phone', phone)
                        .in('status', ['pending', 'confirmed'])
                        .order('created_at', { ascending: false });
                        
                    return error ? [] : (data || []);
                },
                
                // 更新会员统计 (PR#8: 会员积分系统)
                async updateMemberStats(memberId, orderAmount) {
                    if (!config.MEMBER_FEATURES.POINTS_SYSTEM) return;
                    
                    const { error } = await supabaseClient
                        .from('members')
                        .update({
                            total_orders: supabaseClient.sql`total_orders + 1`,
                            total_amount: supabaseClient.sql`total_amount + ${orderAmount}`,
                            points: config.MEMBER_FEATURES.POINTS_SYSTEM ? 
                                supabaseClient.sql`points + ${Math.floor(orderAmount)}` : 
                                supabaseClient.sql`points`
                        })
                        .eq('id', memberId);
                }
            };
            
            // ===== 手机号验证工具 - PR#8 升级 =====
            const validateWhatsAppPhone = (phone) => {
                const validation = config.PHONE_VALIDATION;
                if (!phone) return { isValid: false, message: '请输入手机号码' };
                
                const cleanPhone = phone.replace(/\D/g, '');
                
                // 支持本地格式 (0162327792) 和国际格式 (60162327792)
                const isLocalFormat = cleanPhone.startsWith('0') && cleanPhone.length === 10;
                const isIntlFormat = cleanPhone.startsWith('60') && cleanPhone.length === 11;
                
                if (!isLocalFormat && !isIntlFormat) {
                    return { 
                        isValid: false, 
                        message: '请输入有效的马来西亚手机号 (如: 0162327792 或 60162327792)' 
                    };
                }
                
                return { 
                    isValid: true, 
                    phone: cleanPhone,
                    displayFormat: isLocalFormat ? cleanPhone : '0' + cleanPhone.substring(2)
                };
            };
            
            // ===== 订单号生成优化 - PR#2 升级功能 =====
            const generateOrderId = async () => {
                if (!config.ORDER_FEATURES.ORDER_ID_OPTIMIZATION) {
                    return 'FW' + Date.now();
                }
                
                const today = new Date();
                const dateStr = today.toISOString().slice(0, 10).replace(/-/g, '');
                
                // 查询当天已有订单数量
                const { data, error } = await supabaseClient
                    .from('orders')
                    .select('order_id')
                    .like('order_id', `FW${dateStr}%`)
                    .order('order_id', { ascending: false })
                    .limit(1);
                    
                let sequence = 1;
                if (data && data.length > 0) {
                    const lastOrderId = data[0].order_id;
                    const lastSequence = parseInt(lastOrderId.slice(-3));
                    sequence = lastSequence + 1;
                }
                
                return `FW${dateStr}${sequence.toString().padStart(3, '0')}`;
            };
            
            // React hooks
            const { useState, useEffect } = React;

            // 主应用组件
            function App() {
                const [currentView, setCurrentView] = useState('customer');
                const [products, setProducts] = useState([]);
                const [isLoading, setIsLoading] = useState(true);

                // 获取产品列表
                useEffect(() => {
                    async function fetchProducts() {
                        try {
                            const { data, error } = await supabaseClient
                                .from('products')
                                .select('*')
                                .eq('is_published', true)
                                .order('id');
                            
                            if (error) {
                                console.error('获取产品失败:', error);
                                setProducts([]);
                            } else {
                                setProducts(data || []);
                            }
                        } catch (error) {
                            console.error('获取产品异常:', error);
                            setProducts([]);
                        } finally {
                            setIsLoading(false);
                        }
                    }
                    
                    fetchProducts();
                }, []);

                if (currentView === 'login') {
                    return React.createElement(LoginPage, {
                        onBack: () => setCurrentView('customer'),
                        onLogin: () => setCurrentView('admin')
                    });
                }

                if (currentView === 'admin') {
                    return React.createElement(AdminPanel, {
                        onLogout: () => setCurrentView('customer')
                    });
                }

                return React.createElement(CustomerPage, {
                    products: products,
                    isLoading: isLoading,
                    onAdminClick: () => setCurrentView('login')
                });
            }

            // ===== 综合客户页面组件 - 融合 PR#1-8 所有功能 =====
            function CustomerPage({ products, isLoading, onAdminClick }) {
                // ===== 购物车状态管理 - PR#2,#5 升级功能 =====
                const [cart, setCart] = useState([]);
                const [showCart, setShowCart] = useState(false);
                const [showCheckout, setShowCheckout] = useState(false);
                const [selectedCategory, setSelectedCategory] = useState('all');
                const [searchQuery, setSearchQuery] = useState('');
                const [toast, setToast] = useState(null);
                
                // ===== Toast 通知系统 - PR#5,#6 升级 =====
                const showToast = (message, type = 'success') => {
                    setToast({ message, type });
                    setTimeout(() => setToast(null), 3000);
                };
                
                // ===== 购物车操作 - PR#5 库存验证升级 =====
                const addToCart = async (product) => {
                    // 库存检查 (PR#5: 低库存提醒)
                    if (config.PRODUCT_FEATURES.LOW_STOCK_ALERT && !product.is_unlimited) {
                        if (product.stock_quantity <= 0) {
                            showToast('商品库存不足', 'error');
                            return;
                        }
                    }
                    
                    const existingItem = cart.find(item => item.id === product.id);
                    if (existingItem) {
                        // 检查数量限制
                        if (!product.is_unlimited && existingItem.quantity >= product.stock_quantity) {
                            showToast(`库存仅剩 ${product.stock_quantity} 件`, 'error');
                            return;
                        }
                        setCart(cart.map(item => 
                            item.id === product.id 
                                ? { ...item, quantity: item.quantity + 1 }
                                : item
                        ));
                    } else {
                        setCart([...cart, { ...product, quantity: 1 }]);
                    }
                    showToast(`${product.name} 已添加到购物车`);
                };
                
                const updateCartQuantity = (productId, newQuantity) => {
                    if (newQuantity <= 0) {
                        setCart(cart.filter(item => item.id !== productId));
                        return;
                    }
                    
                    setCart(cart.map(item => 
                        item.id === productId 
                            ? { ...item, quantity: newQuantity }
                            : item
                    ));
                };
                
                const removeFromCart = (productId) => {
                    setCart(cart.filter(item => item.id !== productId));
                    showToast('商品已从购物车移除');
                };
                
                const cartTotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                
                // ===== 商品过滤和搜索 - PR#1 分类搜索功能 =====
                const categories = ['all', ...new Set(products.filter(p => p.category).map(p => p.category))];
                
                const filteredProducts = products.filter(product => {
                    const matchesCategory = selectedCategory === 'all' || product.category === selectedCategory;
                    const matchesSearch = !searchQuery || 
                        product.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                        (product.category && product.category.toLowerCase().includes(searchQuery.toLowerCase()));
                    return matchesCategory && matchesSearch;
                });
                
                return React.createElement('div', { className: 'container py-4' },
                    // ===== 顶部导航和标题 =====
                    React.createElement('div', { className: 'text-center mb-6' },
                        React.createElement('h1', { className: 'text-4xl font-bold text-gray-900 mb-2' }, '🍽️ 锋味派美食团购'),
                        React.createElement('p', { className: 'text-xl text-gray-600 mb-4' }, '新鲜美味，团购优惠'),
                        
                        // 导航按钮
                        React.createElement('div', { className: 'flex flex-wrap justify-center gap-2 mb-4' },
                            React.createElement('button', {
                                className: 'btn btn-secondary',
                                onClick: onAdminClick
                            }, '管理员登录'),
                            React.createElement('button', {
                                className: `btn ${showCart ? 'btn-primary' : 'btn-success'} relative`,
                                onClick: () => setShowCart(!showCart)
                            }, 
                                React.createElement('i', { className: 'fas fa-shopping-cart' }),
                                ` 购物车 (${totalItems})`,
                                totalItems > 0 && React.createElement('span', {
                                    className: 'absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center'
                                }, totalItems)
                            )
                        )
                    ),
                    
                    // ===== Toast 通知 =====
                    toast && React.createElement('div', {
                        className: `fixed top-4 right-4 z-50 p-4 rounded-lg text-white ${
                            toast.type === 'success' ? 'bg-green-500' : 
                            toast.type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                        }`
                    }, toast.message),
                    
                    // ===== 分类导航栏 - PR#1 吸顶功能 =====
                    config.PRODUCT_FEATURES.CATEGORY_SEARCH && React.createElement('div', {
                        className: 'sticky top-0 bg-white shadow-md z-40 py-4 mb-6',
                        style: { marginLeft: '-1rem', marginRight: '-1rem', paddingLeft: '1rem', paddingRight: '1rem' }
                    },
                        React.createElement('div', { className: 'container' },
                            React.createElement('div', { className: 'flex flex-wrap gap-2 mb-4' },
                                categories.map(category => 
                                    React.createElement('button', {
                                        key: category,
                                        className: `px-4 py-2 rounded-full text-sm font-medium transition-colors ${
                                            selectedCategory === category 
                                                ? 'bg-red-600 text-white' 
                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                        }`,
                                        onClick: () => setSelectedCategory(category)
                                    }, category === 'all' ? '全部' : category)
                                )
                            ),
                            // 搜索栏
                            React.createElement('div', { className: 'relative' },
                                React.createElement('input', {
                                    type: 'text',
                                    placeholder: '搜索商品...',
                                    value: searchQuery,
                                    onChange: (e) => setSearchQuery(e.target.value),
                                    className: 'w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500'
                                }),
                                React.createElement('i', {
                                    className: 'fas fa-search absolute left-3 top-3 text-gray-400'
                                })
                            )
                        )
                    ),
                    
                    // ===== 主要内容区域 =====
                    React.createElement('div', { className: 'grid md:grid-cols-4 gap-6' },
                        // ===== 商品展示区域 =====
                        React.createElement('div', { className: 'md:col-span-3' },
                            isLoading ? 
                                React.createElement('div', { className: 'text-center py-8' },
                                    React.createElement('div', { className: 'animate-spin mx-auto mb-4', style: { 
                                        width: '40px', height: '40px', 
                                        border: '4px solid #f3f4f6', 
                                        borderTop: '4px solid #dc2626', 
                                        borderRadius: '50%' 
                                    }}),
                                    '正在加载商品...'
                                ) :
                                filteredProducts.length === 0 ?
                                    React.createElement('div', { className: 'text-center py-8 text-gray-500' },
                                        '暂无商品'
                                    ) :
                                    React.createElement('div', { className: 'grid md:grid-cols-2 lg:grid-cols-3 gap-4' },
                                        filteredProducts.map(product => 
                                            React.createElement(ProductCard, {
                                                key: product.id,
                                                product: product,
                                                onAddToCart: addToCart,
                                                config: config
                                            })
                                        )
                                    )
                        ),
                        
                        // ===== 购物车侧边栏 =====
                        showCart && React.createElement('div', { className: 'md:col-span-1' },
                            React.createElement(CartSidebar, {
                                cart: cart,
                                cartTotal: cartTotal,
                                totalItems: totalItems,
                                onUpdateQuantity: updateCartQuantity,
                                onRemoveItem: removeFromCart,
                                onCheckout: () => setShowCheckout(true),
                                config: config
                            })
                        )
                    ),
                    
                    // ===== 结账模态框 =====
                    showCheckout && React.createElement(CheckoutModal, {
                        cart: cart,
                        cartTotal: cartTotal,
                        onClose: () => setShowCheckout(false),
                        onOrderComplete: () => {
                            setCart([]);
                            setShowCart(false);
                            setShowCheckout(false);
                        },
                        showToast: showToast,
                        supabaseClient: supabaseClient,
                        config: config,
                        MemberService: MemberService,
                        validateWhatsAppPhone: validateWhatsAppPhone,
                        generateOrderId: generateOrderId
                    }),
                    
                    // ===== 底部联系信息 =====
                    React.createElement('div', { className: 'mt-12 grid md:grid-cols-2 gap-6' },
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('h2', { className: 'text-2xl font-bold text-red-600 mb-4' }, '📞 联系我们'),
                            React.createElement('div', { className: 'space-y-3 text-gray-700' },
                                React.createElement('div', null,
                                    React.createElement('strong', null, 'WhatsApp: '),
                                    '0162327792'
                                ),
                                React.createElement('div', null,
                                    React.createElement('strong', null, '自取地址: '),
                                    React.createElement('br'),
                                    config.SELF_PICKUP_ADDRESS
                                )
                            ),
                            React.createElement('div', { className: 'mt-6' },
                                React.createElement('a', {
                                    href: `https://wa.me/${config.WHATSAPP_NUMBER}?text=您好，我想订购锋味派美食`,
                                    className: 'btn btn-success',
                                    target: '_blank'
                                }, 
                                    React.createElement('i', { className: 'fab fa-whatsapp' }),
                                    ' WhatsApp 订购'
                                )
                            )
                        ),
                        
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('h2', { className: 'text-2xl font-bold text-blue-600 mb-4' }, '🛍️ 系统状态'),
                            React.createElement('div', { className: 'space-y-3 text-gray-700' },
                                React.createElement('div', null, '✅ 系统运行正常'),
                                React.createElement('div', null, `📦 当前商品: ${products.length} 种`),
                                React.createElement('div', null, '🚀 功能完整可用'),
                                React.createElement('div', null, '📱 支持移动设备'),
                                config.MEMBER_FEATURES.ENABLED && React.createElement('div', null, '👥 会员系统已启用'),
                                config.ORDER_FEATURES.ORDER_MERGING && React.createElement('div', null, '🔄 智能订单合并')
                            )
                        )
                    )
                );
            }
            
            // ===== 商品卡片组件 - PR#2,#3 图片上传和字段兼容 =====
            function ProductCard({ product, onAddToCart, config }) {
                const imageUrl = config.PRODUCT_FEATURES.FIELD_COMPATIBILITY ? 
                    (product.image_url || `${config.PRODUCT_IMAGE_BASE_URL}${product.image || 'default.jpg'}`) :
                    product.image_url;
                    
                const stockDisplay = product.is_unlimited ? '预购商品' : 
                    config.PRODUCT_FEATURES.LOW_STOCK_ALERT && product.stock_quantity <= 5 ? 
                        `库存紧张 (${product.stock_quantity})` : 
                        `库存: ${product.stock_quantity}`;
                        
                return React.createElement('div', { 
                    className: 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300'
                },
                    // 商品图片
                    config.PRODUCT_FEATURES.IMAGE_UPLOAD && imageUrl && React.createElement('div', {
                        className: 'w-full h-48 bg-gray-200 flex items-center justify-center overflow-hidden'
                    },
                        React.createElement('img', {
                            src: imageUrl,
                            alt: product.name,
                            className: 'w-full h-full object-cover',
                            onError: (e) => {
                                e.target.style.display = 'none';
                                e.target.nextSibling.style.display = 'flex';
                            }
                        }),
                        React.createElement('div', {
                            className: 'w-full h-full bg-gray-200 flex items-center justify-center text-6xl',
                            style: { display: 'none' }
                        }, product.emoji || '🍽️')
                    ),
                    
                    // 商品信息
                    React.createElement('div', { className: 'p-4' },
                        React.createElement('h3', { 
                            className: 'text-lg font-bold text-gray-900 mb-2 line-clamp-2'
                        }, `${product.emoji || '🍽️'} ${product.name}`),
                        
                        React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                            React.createElement('span', { 
                                className: 'text-2xl font-bold text-red-600'
                            }, `RM ${Number(product.price).toFixed(2)}`),
                            product.category && React.createElement('span', {
                                className: 'text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full'
                            }, product.category)
                        ),
                        
                        React.createElement('p', { 
                            className: `text-sm mb-3 ${
                                product.is_unlimited ? 'text-blue-600' : 
                                product.stock_quantity <= 5 ? 'text-red-600' : 'text-gray-600'
                            }`
                        }, stockDisplay),
                        
                        product.description && React.createElement('p', {
                            className: 'text-sm text-gray-600 mb-4 line-clamp-2'
                        }, product.description),
                        
                        React.createElement('button', {
                            className: `btn btn-primary w-full ${
                                !product.is_unlimited && product.stock_quantity <= 0 ? 'opacity-50 cursor-not-allowed' : ''
                            }`,
                            onClick: () => onAddToCart(product),
                            disabled: !product.is_unlimited && product.stock_quantity <= 0
                        },
                            React.createElement('i', { className: 'fas fa-cart-plus' }),
                            ' 加入购物车'
                        )
                    )
                );
            }
            
            // ===== 购物车侧边栏组件 - PR#2,#5 升级功能 =====
            function CartSidebar({ cart, cartTotal, totalItems, onUpdateQuantity, onRemoveItem, onCheckout, config }) {
                return React.createElement('div', { 
                    className: 'bg-white rounded-lg shadow-md p-6 sticky top-24'
                },
                    React.createElement('h3', { 
                        className: 'text-xl font-bold text-gray-900 mb-4 flex items-center'
                    },
                        React.createElement('i', { className: 'fas fa-shopping-cart mr-2 text-blue-600' }),
                        `购物车 (${totalItems})`
                    ),
                    
                    cart.length === 0 ? 
                        React.createElement('div', { className: 'text-center text-gray-500 py-8' },
                            React.createElement('i', { className: 'fas fa-shopping-cart text-4xl mb-4 text-gray-300' }),
                            React.createElement('p', null, '购物车是空的'),
                            React.createElement('p', { className: 'text-sm' }, '添加一些美味商品吧！')
                        ) :
                        React.createElement('div', null,
                            React.createElement('div', { className: 'space-y-4 mb-6 max-h-80 overflow-y-auto' },
                                cart.map(item => 
                                    React.createElement('div', { 
                                        key: item.id,
                                        className: 'flex items-center gap-3 p-3 bg-gray-50 rounded-lg'
                                    },
                                        React.createElement('div', { className: 'text-2xl' }, item.emoji || '🍽️'),
                                        React.createElement('div', { className: 'flex-1 min-w-0' },
                                            React.createElement('h4', { className: 'text-sm font-medium text-gray-900 truncate' }, item.name),
                                            React.createElement('p', { className: 'text-sm text-gray-600' }, `RM ${Number(item.price).toFixed(2)}`),
                                            // 库存信息显示
                                            config.PRODUCT_FEATURES.LOW_STOCK_ALERT && !item.is_unlimited && 
                                                React.createElement('p', { 
                                                    className: `text-xs ${item.stock_quantity <= 5 ? 'text-red-600' : 'text-gray-500'}`
                                                }, `库存: ${item.stock_quantity}`)
                                        ),
                                        React.createElement('div', { className: 'flex items-center gap-2' },
                                            React.createElement('button', {
                                                className: 'w-6 h-6 rounded-full bg-gray-300 hover:bg-gray-400 flex items-center justify-center text-sm',
                                                onClick: () => onUpdateQuantity(item.id, item.quantity - 1)
                                            }, '-'),
                                            React.createElement('span', { className: 'text-sm font-medium w-6 text-center' }, item.quantity),
                                            React.createElement('button', {
                                                className: `w-6 h-6 rounded-full bg-blue-600 hover:bg-blue-700 text-white flex items-center justify-center text-sm ${
                                                    !item.is_unlimited && item.quantity >= item.stock_quantity ? 'opacity-50 cursor-not-allowed' : ''
                                                }`,
                                                onClick: () => onUpdateQuantity(item.id, item.quantity + 1),
                                                disabled: !item.is_unlimited && item.quantity >= item.stock_quantity
                                            }, '+')
                                        ),
                                        React.createElement('button', {
                                            className: 'text-red-600 hover:text-red-800 text-sm',
                                            onClick: () => onRemoveItem(item.id)
                                        }, React.createElement('i', { className: 'fas fa-trash' }))
                                    )
                                )
                            ),
                            
                            React.createElement('div', { className: 'border-t pt-4' },
                                React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                                    React.createElement('span', { className: 'text-lg font-bold text-gray-900' }, '总计:'),
                                    React.createElement('span', { className: 'text-2xl font-bold text-red-600' }, `RM ${cartTotal.toFixed(2)}`)
                                ),
                                React.createElement('button', {
                                    className: 'btn btn-success w-full',
                                    onClick: onCheckout
                                },
                                    React.createElement('i', { className: 'fas fa-credit-card' }),
                                    ' 立即结账'
                                )
                            )
                        )
                );
            }
            
            // ===== 结账模态框组件 - PR#3,#7,#8 综合升级功能 =====
            function CheckoutModal({ cart, cartTotal, onClose, onOrderComplete, showToast, supabaseClient, config, MemberService, validateWhatsAppPhone, generateOrderId }) {
                const [formData, setFormData] = useState({
                    name: '',
                    phone: '',
                    delivery: 'self-pickup',
                    deliveryAddress: '',
                    remarks: '',
                    paymentMethod: 'Maybank QR'
                });
                const [paymentProof, setPaymentProof] = useState(null);
                const [isSubmitting, setIsSubmitting] = useState(false);
                const [member, setMember] = useState(null);
                const [showQR, setShowQR] = useState(false);
                
                // 检查会员状态
                useEffect(() => {
                    if (config.MEMBER_FEATURES.ENABLED && formData.phone) {
                        const checkMember = async () => {
                            const validation = validateWhatsAppPhone(formData.phone);
                            if (validation.isValid) {
                                const existingMember = await MemberService.checkMemberExists(validation.phone);
                                setMember(existingMember);
                            }
                        };
                        checkMember();
                    }
                }, [formData.phone]);
                
                const handleChange = (e) => {
                    const { name, value } = e.target;
                    setFormData(prev => ({ ...prev, [name]: value }));
                };
                
                // 支付方式变更显示二维码
                useEffect(() => {
                    if (config.SCAN_PHOTO_FEATURES.PAYMENT_QR_DISPLAY && formData.paymentMethod) {
                        setShowQR(true);
                    }
                }, [formData.paymentMethod]);
                
                const handleSubmit = async (e) => {
                    e.preventDefault();
                    setIsSubmitting(true);
                    
                    try {
                        // 手机号验证
                        const phoneValidation = validateWhatsAppPhone(formData.phone);
                        if (!phoneValidation.isValid) {
                            showToast(phoneValidation.message, 'error');
                            return;
                        }
                        
                        // 配送地址验证 - PR#3 升级
                        if (formData.delivery === 'lalamove' && !formData.deliveryAddress.trim()) {
                            showToast('请填写配送地址', 'error');
                            return;
                        }
                        
                        // 会员处理 - PR#8 自动创建会员
                        let currentMember = member;
                        if (config.MEMBER_FEATURES.ENABLED && !currentMember && config.MEMBER_FEATURES.AUTO_CREATE_MEMBER) {
                            currentMember = await MemberService.createMember({
                                name: formData.name,
                                phone: phoneValidation.phone
                            });
                        }
                        
                        // 订单合并检查 - PR#8 升级功能
                        let shouldMergeOrder = false;
                        let existingOrderId = null;
                        if (config.ORDER_FEATURES.ORDER_MERGING && config.MEMBER_FEATURES.AUTO_MERGE_ORDERS) {
                            const incompleteOrders = await MemberService.getIncompleteOrders(phoneValidation.phone);
                            if (incompleteOrders.length > 0) {
                                shouldMergeOrder = true;
                                existingOrderId = incompleteOrders[0].order_id;
                            }
                        }
                        
                        // 生成订单ID - PR#2 优化
                        const orderId = shouldMergeOrder ? existingOrderId : await generateOrderId();
                        
                        // 准备订单数据
                        let finalRemarks = formData.remarks;
                        if (formData.delivery === 'lalamove' && formData.deliveryAddress.trim()) {
                            finalRemarks = formData.deliveryAddress.trim() + (finalRemarks ? '\n' + finalRemarks : '');
                        }
                        
                        const orderInsertData = {
                            order_id: orderId,
                            name: formData.name,
                            phone: phoneValidation.phone,
                            delivery_method: formData.delivery,
                            remarks: finalRemarks,
                            payment_method: formData.paymentMethod,
                            total_amount: cartTotal,
                            status: 'pending',
                            order_items: cart.map(item => ({
                                product: item.name,
                                quantity: item.quantity,
                                price: item.price,
                                emoji: item.emoji,
                                is_unlimited: item.is_unlimited
                            })),
                            created_at: new Date().toISOString(),
                            member_id: currentMember?.id || null
                        };
                        
                        // 处理支付凭证上传 - PR#3,#7 升级
                        let paymentProofUrl = null;
                        if (paymentProof && config.ORDER_FEATURES.PAYMENT_PROOF_UPLOAD) {
                            const fileName = 'payment-proof-' + Date.now() + '.' + paymentProof.name.split('.').pop();
                            const { error: uploadError } = await supabaseClient.storage
                                .from('payment-proofs').upload(fileName, paymentProof);
                            if (uploadError) {
                                throw new Error('上传支付凭证失败: ' + uploadError.message);
                            }
                            
                            const { data: { publicUrl } } = supabaseClient.storage
                                .from('payment-proofs').getPublicUrl(fileName);
                            paymentProofUrl = publicUrl;
                        }
                        if (paymentProofUrl) {
                            orderInsertData.payment_proof_url = paymentProofUrl;
                        }
                        
                        let insertedOrder;
                        if (shouldMergeOrder) {
                            // 合并订单：更新现有订单的商品和总金额
                            const { data: existingOrder, error: fetchError } = await supabaseClient
                                .from('orders')
                                .select('*')
                                .eq('order_id', existingOrderId)
                                .single();
                                
                            if (fetchError) throw fetchError;
                            
                            // 合并商品项目
                            const existingItems = existingOrder.order_items || [];
                            const newItems = orderInsertData.order_items;
                            const mergedItems = [...existingItems];
                            
                            // 合并逻辑：相同商品累加数量，新商品添加
                            newItems.forEach(newItem => {
                                const existingItemIndex = mergedItems.findIndex(item => 
                                    item.product === newItem.product && item.price === newItem.price
                                );
                                
                                if (existingItemIndex >= 0) {
                                    mergedItems[existingItemIndex].quantity += newItem.quantity;
                                } else {
                                    mergedItems.push(newItem);
                                }
                            });
                            
                            // 更新订单
                            const { data: updatedOrder, error: updateError } = await supabaseClient
                                .from('orders')
                                .update({
                                    order_items: mergedItems,
                                    total_amount: existingOrder.total_amount + cartTotal,
                                    updated_at: new Date().toISOString()
                                })
                                .eq('order_id', existingOrderId)
                                .select()
                                .single();
                                
                            if (updateError) throw updateError;
                            insertedOrder = updatedOrder;
                            showToast('订单已成功合并到现有订单！', 'success');
                        } else {
                            // 创建新订单
                            const { data: newOrder, error: insertError } = await supabaseClient
                                .from('orders')
                                .insert([orderInsertData])
                                .select()
                                .single();
                                
                            if (insertError) throw insertError;
                            insertedOrder = newOrder;
                            showToast('订单提交成功！', 'success');
                        }
                        
                        // 更新会员统计 - PR#8 积分系统
                        if (config.MEMBER_FEATURES.ENABLED && currentMember && config.MEMBER_FEATURES.POINTS_SYSTEM) {
                            await MemberService.updateMemberStats(currentMember.id, cartTotal);
                        }
                        
                        // 发送WhatsApp通知
                        const orderMessage = buildOrderMessage(insertedOrder);
                        const whatsappUrl = `https://wa.me/${config.WHATSAPP_NUMBER}?text=${encodeURIComponent(orderMessage)}`;
                        window.open(whatsappUrl, '_blank');
                        
                        onOrderComplete();
                        
                    } catch (error) {
                        console.error('提交订单错误:', error);
                        showToast('提交订单失败: ' + error.message, 'error');
                    } finally {
                        setIsSubmitting(false);
                    }
                };
                
                // 构建订单消息 - 兼容新旧格式
                const buildOrderMessage = (order) => {
                    let msg = `🍽️ *锋味派美食团购订单*\n\n`;
                    msg += `订单号: ${order.order_id}\n`;
                    msg += `客户姓名: ${order.name}\n`;
                    msg += `客户电话: ${order.phone}\n`;
                    msg += `配送方式: ${order.delivery_method === 'self-pickup' ? '自取' : 'Lalamove送货'}\n\n`;
                    
                    msg += `*订单详情:*\n`;
                    order.order_items.forEach(item => {
                        msg += `${item.emoji || '🍽️'} ${item.product} x${item.quantity} = RM${(item.price * item.quantity).toFixed(2)}\n`;
                    });
                    
                    msg += `\n*总金额: RM${Number(order.total_amount).toFixed(2)}*\n`;
                    msg += `支付方式: ${order.payment_method}\n`;
                    
                    if (order.remarks) {
                        msg += `\n*备注:*\n${order.remarks}\n`;
                    }
                    
                    if (config.MEMBER_FEATURES.ENABLED && member) {
                        msg += `\n👥 *会员信息:*\n`;
                        msg += `会员ID: ${member.id}\n`;
                        if (config.MEMBER_FEATURES.POINTS_SYSTEM) {
                            msg += `当前积分: ${member.points}\n`;
                        }
                    }
                    
                    msg += `\n📅 下单时间: ${new Date().toLocaleString('zh-CN')}`;
                    return msg;
                };
                
                return React.createElement('div', {
                    className: 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4',
                    onClick: (e) => {
                        if (e.target === e.currentTarget) onClose();
                    }
                },
                    React.createElement('div', {
                        className: 'bg-white rounded-lg max-w-2xl w-full max-h-96 overflow-y-auto'
                    },
                        React.createElement('div', { className: 'p-6' },
                            React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                                React.createElement('h2', { className: 'text-2xl font-bold text-gray-900' }, '确认订单'),
                                React.createElement('button', {
                                    className: 'text-gray-400 hover:text-gray-600 text-2xl',
                                    onClick: onClose
                                }, '×')
                            ),
                            
                            React.createElement('form', { onSubmit: handleSubmit },
                                React.createElement('div', { className: 'grid md:grid-cols-2 gap-4 mb-4' },
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, '姓名 *'),
                                        React.createElement('input', {
                                            type: 'text',
                                            name: 'name',
                                            value: formData.name,
                                            onChange: handleChange,
                                            className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500',
                                            required: true
                                        })
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 
                                            '手机号 * ',
                                            config.MEMBER_FEATURES.ENABLED && member && React.createElement('span', { 
                                                className: 'text-green-600 text-xs' 
                                            }, '✓ 已找到会员')
                                        ),
                                        React.createElement('input', {
                                            type: 'tel',
                                            name: 'phone',
                                            value: formData.phone,
                                            onChange: handleChange,
                                            placeholder: '0162327792 或 60162327792',
                                            className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500',
                                            required: true
                                        })
                                    )
                                ),
                                
                                React.createElement('div', { className: 'grid md:grid-cols-2 gap-4 mb-4' },
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, '配送方式'),
                                        React.createElement('select', {
                                            name: 'delivery',
                                            value: formData.delivery,
                                            onChange: handleChange,
                                            className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500'
                                        },
                                            React.createElement('option', { value: 'self-pickup' }, '自取'),
                                            React.createElement('option', { value: 'lalamove' }, 'Lalamove送货')
                                        )
                                    ),
                                    React.createElement('div', null,
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, '支付方式'),
                                        React.createElement('select', {
                                            name: 'paymentMethod',
                                            value: formData.paymentMethod,
                                            onChange: handleChange,
                                            className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500'
                                        },
                                            React.createElement('option', { value: 'Maybank QR' }, 'Maybank QR'),
                                            React.createElement('option', { value: 'TNG eWallet' }, 'TNG eWallet')
                                        )
                                    )
                                ),
                                
                                // 配送地址字段 - PR#3 动态显示
                                formData.delivery === 'self-pickup' ? 
                                    React.createElement('div', { className: 'mb-4' },
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, '自取地址'),
                                        React.createElement('div', {
                                            className: 'w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-700'
                                        }, config.SELF_PICKUP_ADDRESS),
                                        React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, '自取地址为只读，无需填写')
                                    ) :
                                    React.createElement('div', { className: 'mb-4' },
                                        React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, '配送地址 *'),
                                        React.createElement('textarea', {
                                            name: 'deliveryAddress',
                                            value: formData.deliveryAddress,
                                            onChange: handleChange,
                                            className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500',
                                            placeholder: '请输入详细的配送地址',
                                            rows: 2,
                                            required: formData.delivery === 'lalamove'
                                        })
                                    ),
                                
                                React.createElement('div', { className: 'mb-4' },
                                    React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, '备注'),
                                    React.createElement('textarea', {
                                        name: 'remarks',
                                        value: formData.remarks,
                                        onChange: handleChange,
                                        className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500',
                                        placeholder: '其他要求或备注...',
                                        rows: 2
                                    })
                                ),
                                
                                // 支付二维码显示 - PR#2,#6 升级功能
                                showQR && config.SCAN_PHOTO_FEATURES.PAYMENT_QR_DISPLAY && React.createElement('div', { className: 'mb-4 p-4 bg-blue-50 rounded-lg' },
                                    React.createElement('h3', { className: 'text-lg font-medium text-blue-900 mb-2' }, 
                                        `${formData.paymentMethod} 支付二维码`
                                    ),
                                    React.createElement('div', { className: 'text-center' },
                                        React.createElement('img', {
                                            src: formData.paymentMethod === 'Maybank QR' ? 
                                                `${config.PRODUCT_IMAGE_BASE_URL}IMG_4042.png` :
                                                `${config.PRODUCT_IMAGE_BASE_URL}IMG_4043.jpeg`,
                                            alt: `${formData.paymentMethod} QR Code`,
                                            className: 'mx-auto mb-2 max-w-48 h-auto rounded-lg',
                                            onError: (e) => {
                                                e.target.style.display = 'none';
                                                e.target.nextSibling.style.display = 'block';
                                            }
                                        }),
                                        React.createElement('div', {
                                            className: 'text-gray-500',
                                            style: { display: 'none' }
                                        }, '二维码加载失败'),
                                        React.createElement('p', { className: 'text-sm text-blue-700' },
                                            `请扫码支付 RM${cartTotal.toFixed(2)}，然后上传支付凭证`
                                        )
                                    )
                                ),
                                
                                // 支付凭证上传 - PR#3,#7 升级功能  
                                config.ORDER_FEATURES.PAYMENT_PROOF_UPLOAD && React.createElement('div', { className: 'mb-6' },
                                    React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 
                                        '支付凭证 ',
                                        React.createElement('span', { className: 'text-red-500' }, '*')
                                    ),
                                    React.createElement('input', {
                                        type: 'file',
                                        accept: 'image/*',
                                        onChange: (e) => setPaymentProof(e.target.files[0]),
                                        className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500',
                                        required: true
                                    }),
                                    React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 
                                        '请上传银行转账或电子钱包支付截图'
                                    )
                                ),
                                
                                // 订单摘要
                                React.createElement('div', { className: 'mb-6 p-4 bg-gray-50 rounded-lg' },
                                    React.createElement('h3', { className: 'text-lg font-medium text-gray-900 mb-3' }, '订单摘要'),
                                    React.createElement('div', { className: 'space-y-2' },
                                        cart.map(item => 
                                            React.createElement('div', { 
                                                key: item.id,
                                                className: 'flex justify-between items-center text-sm'
                                            },
                                                React.createElement('span', null, `${item.emoji || '🍽️'} ${item.name} x${item.quantity}`),
                                                React.createElement('span', { className: 'font-medium' }, `RM${(item.price * item.quantity).toFixed(2)}`)
                                            )
                                        )
                                    ),
                                    React.createElement('div', { className: 'border-t pt-2 mt-3' },
                                        React.createElement('div', { className: 'flex justify-between items-center text-lg font-bold text-red-600' },
                                            React.createElement('span', null, '总计:'),
                                            React.createElement('span', null, `RM${cartTotal.toFixed(2)}`)
                                        )
                                    )
                                ),
                                
                                React.createElement('div', { className: 'flex gap-3' },
                                    React.createElement('button', {
                                        type: 'button',
                                        onClick: onClose,
                                        className: 'flex-1 btn btn-secondary'
                                    }, '取消'),
                                    React.createElement('button', {
                                        type: 'submit',
                                        disabled: isSubmitting,
                                        className: `flex-1 btn btn-success ${isSubmitting ? 'opacity-50 cursor-not-allowed' : ''}`
                                    },
                                        isSubmitting ? 
                                            React.createElement('span', null, 
                                                React.createElement('i', { className: 'fas fa-spinner fa-spin mr-2' }),
                                                '提交中...'
                                            ) :
                                            React.createElement('span', null,
                                                React.createElement('i', { className: 'fas fa-check mr-2' }),
                                                '确认订单'
                                            )
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // 登录页面组件
            // ===== 登录页面组件 - 融合 PR#7 密码可见性切换 =====
            function LoginPage({ onBack, onLogin }) {
                const [password, setPassword] = useState('');
                const [error, setError] = useState('');
                const [showPassword, setShowPassword] = useState(false); // PR#7 密码显示切换

                const handleSubmit = (e) => {
                    e.preventDefault();
                    if (password === config.ADMIN_PASSWORD) {
                        onLogin();
                    } else {
                        setError('密码错误');
                    }
                };

                return React.createElement('div', { className: 'container py-8' },
                    React.createElement('div', { className: 'card', style: { maxWidth: '400px', margin: '0 auto' } },
                        React.createElement('h1', { className: 'text-2xl mb-6 text-center' }, '🔐 管理员登录'),
                        React.createElement('form', { onSubmit: handleSubmit },
                            React.createElement('div', { className: 'mb-4' },
                                React.createElement('label', { className: 'block mb-2 font-medium text-gray-700' }, '管理员密码:'),
                                // PR#7: 密码输入框with可见性切换
                                React.createElement('div', { className: 'relative' },
                                    React.createElement('input', {
                                        type: showPassword ? 'text' : 'password',
                                        value: password,
                                        onChange: (e) => setPassword(e.target.value),
                                        className: 'w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500',
                                        placeholder: '请输入管理员密码',
                                        required: true
                                    }),
                                    // PR#7: 密码可见性切换按钮
                                    config.ADMIN_FEATURES.PASSWORD_TOGGLE && React.createElement('button', {
                                        type: 'button',
                                        className: 'absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none',
                                        onClick: () => setShowPassword(!showPassword)
                                    },
                                        React.createElement('i', {
                                            className: `fas ${showPassword ? 'fa-eye-slash' : 'fa-eye'}`
                                        })
                                    )
                                )
                            ),
                            error && React.createElement('div', { 
                                className: 'mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg'
                            }, 
                                React.createElement('i', { className: 'fas fa-exclamation-circle mr-2' }),
                                error
                            ),
                            React.createElement('div', { className: 'space-y-3' },
                                React.createElement('button', {
                                    type: 'submit',
                                    className: 'btn btn-primary w-full'
                                }, 
                                    React.createElement('i', { className: 'fas fa-sign-in-alt mr-2' }),
                                    '登录管理后台'
                                ),
                                React.createElement('button', {
                                    type: 'button',
                                    onClick: onBack,
                                    className: 'btn btn-secondary w-full'
                                }, 
                                    React.createElement('i', { className: 'fas fa-arrow-left mr-2' }),
                                    '返回首页'
                                )
                            )
                        )
                    )
                );
            }

            // 管理面板组件
            // ===== 综合管理后台组件 - 融合 PR#1,#4-8 所有管理功能 =====
            function AdminPanel({ onLogout }) {
                const [currentView, setCurrentView] = useState('dashboard');
                const [orders, setOrders] = useState([]);
                const [products, setProducts] = useState([]);
                const [members, setMembers] = useState([]);
                const [isLoading, setIsLoading] = useState(true);
                const [stats, setStats] = useState({});
                const [toast, setToast] = useState(null);
                const [sidebarOpen, setSidebarOpen] = useState(false); // PR#1 移动端侧边栏

                // Toast 通知系统
                const showToast = (message, type = 'success') => {
                    setToast({ message, type });
                    setTimeout(() => setToast(null), 3000);
                };

                // 获取统计数据 - PR#1,#8 数据分析功能
                useEffect(() => {
                    const fetchData = async () => {
                        setIsLoading(true);
                        try {
                            // 获取订单数据
                            const { data: ordersData } = await supabaseClient
                                .from('orders')
                                .select('*')
                                .order('created_at', { ascending: false });
                            setOrders(ordersData || []);

                            // 获取商品数据
                            const { data: productsData } = await supabaseClient
                                .from('products')
                                .select('*')
                                .order('created_at', { ascending: false });
                            setProducts(productsData || []);

                            // 获取会员数据 (如果启用)
                            if (config.MEMBER_FEATURES.ENABLED) {
                                const { data: membersData } = await supabaseClient
                                    .from('members')
                                    .select('*')
                                    .order('created_at', { ascending: false });
                                setMembers(membersData || []);
                            }

                            // 计算预售统计 - PR#1 预售成团统计
                            const presaleStats = calculatePresaleStats(ordersData || [], productsData || []);
                            setStats(presaleStats);

                        } catch (error) {
                            console.error('获取数据失败:', error);
                            showToast('获取数据失败', 'error');
                        } finally {
                            setIsLoading(false);
                        }
                    };

                    fetchData();
                }, []);

                // PR#1: 计算预售成团统计
                const calculatePresaleStats = (orders, products) => {
                    // 筛选预售商品和排除运费专用
                    const presaleProducts = products.filter(p => 
                        p.is_unlimited && p.name.indexOf('运费专用') === -1
                    );
                    
                    let totalBoxesSold = 0;
                    orders.forEach(order => {
                        if (order.order_items && Array.isArray(order.order_items)) {
                            order.order_items.forEach(item => {
                                const product = presaleProducts.find(p => p.name === item.product);
                                if (product) {
                                    totalBoxesSold += item.quantity;
                                }
                            });
                        }
                    });

                    const boxesPerGroup = 200; // 每200盒成团
                    const completedGroups = Math.floor(totalBoxesSold / boxesPerGroup);
                    const remainingForNextGroup = boxesPerGroup - (totalBoxesSold % boxesPerGroup);

                    return {
                        totalBoxesSold,
                        completedGroups,
                        remainingForNextGroup: remainingForNextGroup === boxesPerGroup ? 0 : remainingForNextGroup,
                        totalOrders: orders.length,
                        totalProducts: products.length,
                        totalMembers: members.length
                    };
                };

                // 侧边栏菜单项 - PR#1,#8 所有管理功能
                const menuItems = [
                    { id: 'dashboard', icon: 'fas fa-tachometer-alt', label: '仪表盘', enabled: true },
                    { id: 'products', icon: 'fas fa-pizza-slice', label: '商品管理', enabled: config.PRODUCT_FEATURES.IMAGE_UPLOAD },
                    { id: 'inventory', icon: 'fas fa-boxes', label: '库存管理', enabled: config.PRODUCT_FEATURES.LOW_STOCK_ALERT },
                    { id: 'orders', icon: 'fas fa-clipboard-list', label: '订单管理', enabled: config.ORDER_FEATURES.ORDER_MERGING },
                    { id: 'members', icon: 'fas fa-users', label: '会员管理', enabled: config.MEMBER_FEATURES.ENABLED },
                    { id: 'analytics', icon: 'fas fa-chart-line', label: '数据分析', enabled: config.ADMIN_FEATURES.DASHBOARD_ANALYTICS },
                    { id: 'settings', icon: 'fas fa-cog', label: '系统设置', enabled: true }
                ];

                const enabledMenuItems = menuItems.filter(item => item.enabled);

                return React.createElement('div', { className: 'min-h-screen bg-gray-50' },
                    // ===== 移动端导航栏 - PR#1 移动端响应式 =====
                    config.ADMIN_FEATURES.MOBILE_RESPONSIVE && React.createElement('div', { className: 'md:hidden bg-white shadow-sm border-b border-gray-200' },
                        React.createElement('div', { className: 'flex items-center justify-between p-4' },
                            React.createElement('h1', { className: 'text-xl font-bold text-gray-900' }, '锋味派管理后台'),
                            React.createElement('button', {
                                className: 'p-2 rounded-md text-gray-500 hover:text-gray-900 hover:bg-gray-100 focus:outline-none',
                                onClick: () => setSidebarOpen(!sidebarOpen)
                            }, React.createElement('i', { className: 'fas fa-bars text-xl' }))
                        )
                    ),

                    React.createElement('div', { className: 'flex' },
                        // ===== 侧边栏 - PR#1 移动端可收起 =====
                        React.createElement('div', { 
                            className: `${config.ADMIN_FEATURES.MOBILE_RESPONSIVE ? 
                                `md:flex ${sidebarOpen ? 'flex' : 'hidden'}` : 'flex'} 
                                fixed md:static inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out`
                        },
                            React.createElement('div', { className: 'flex flex-col w-full' },
                                // 侧边栏标题
                                React.createElement('div', { className: 'flex items-center justify-between h-16 px-6 border-b border-gray-200' },
                                    React.createElement('h2', { className: 'text-lg font-bold text-gray-900' }, '🍽️ 管理后台'),
                                    config.ADMIN_FEATURES.MOBILE_RESPONSIVE && React.createElement('button', {
                                        className: 'md:hidden p-1 rounded-md text-gray-400 hover:text-gray-600',
                                        onClick: () => setSidebarOpen(false)
                                    }, React.createElement('i', { className: 'fas fa-times' }))
                                ),
                                
                                // 菜单项
                                React.createElement('nav', { className: 'flex-1 px-4 py-6 space-y-2' },
                                    enabledMenuItems.map(item => 
                                        React.createElement('button', {
                                            key: item.id,
                                            className: `w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors ${
                                                currentView === item.id 
                                                    ? 'bg-red-100 text-red-700 font-medium' 
                                                    : 'text-gray-700 hover:bg-gray-100'
                                            }`,
                                            onClick: () => {
                                                setCurrentView(item.id);
                                                if (config.ADMIN_FEATURES.MOBILE_RESPONSIVE) setSidebarOpen(false);
                                            }
                                        },
                                            React.createElement('i', { className: `${item.icon} w-5 mr-3` }),
                                            item.label
                                        )
                                    )
                                ),
                                
                                // 退出登录
                                React.createElement('div', { className: 'p-4 border-t border-gray-200' },
                                    React.createElement('button', {
                                        onClick: onLogout,
                                        className: 'w-full flex items-center px-4 py-3 text-left text-gray-700 rounded-lg hover:bg-red-50 hover:text-red-600 transition-colors'
                                    },
                                        React.createElement('i', { className: 'fas fa-sign-out-alt w-5 mr-3' }),
                                        '退出登录'
                                    )
                                )
                            )
                        ),

                        // ===== 主要内容区域 =====
                        React.createElement('div', { className: 'flex-1 overflow-hidden' },
                            React.createElement('main', { className: 'h-full overflow-y-auto p-6' },
                                // Toast 通知
                                toast && React.createElement('div', {
                                    className: `fixed top-4 right-4 z-50 p-4 rounded-lg text-white ${
                                        toast.type === 'success' ? 'bg-green-500' : 
                                        toast.type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                                    }`
                                }, toast.message),

                                // 动态内容渲染
                                React.createElement(AdminContentRenderer, {
                                    currentView,
                                    isLoading,
                                    stats,
                                    orders,
                                    products,
                                    members,
                                    showToast,
                                    supabaseClient,
                                    config
                                })
                            )
                        )
                    ),

                    // ===== 移动端遮罩层 - PR#1 =====
                    config.ADMIN_FEATURES.MOBILE_RESPONSIVE && sidebarOpen && React.createElement('div', {
                        className: 'fixed inset-0 z-40 bg-black bg-opacity-50 md:hidden',
                        onClick: () => setSidebarOpen(false)
                    })
                );
            }

            // ===== 管理后台内容渲染器 - 根据视图显示不同内容 =====
            function AdminContentRenderer({ currentView, isLoading, stats, orders, products, members, showToast, supabaseClient, config }) {
                if (isLoading) {
                    return React.createElement('div', { className: 'flex items-center justify-center h-64' },
                        React.createElement('div', { className: 'animate-spin rounded-full h-12 w-12 border-b-2 border-red-600' }),
                        React.createElement('span', { className: 'ml-4 text-gray-600' }, '加载中...')
                    );
                }

                switch (currentView) {
                    case 'dashboard':
                        return React.createElement(DashboardView, { stats, config });
                    case 'products':
                        return React.createElement(ProductsView, { products, showToast, supabaseClient, config });
                    case 'inventory':
                        return React.createElement(InventoryView, { products, showToast, supabaseClient, config });
                    case 'orders':
                        return React.createElement(OrdersView, { orders, showToast, supabaseClient, config });
                    case 'members':
                        return React.createElement(MembersView, { members, showToast, supabaseClient, config });
                    case 'analytics':
                        return React.createElement(AnalyticsView, { orders, products, members, stats, config });
                    case 'settings':
                        return React.createElement(SettingsView, { config, showToast, supabaseClient });
                    default:
                        return React.createElement('div', { className: 'text-center text-gray-500 py-8' }, 
                            '请选择一个功能模块'
                        );
                }
            }

            // ===== 仪表盘视图 - PR#1,#8 综合数据展示 =====
            function DashboardView({ stats, config }) {
                return React.createElement('div', { className: 'space-y-6' },
                    React.createElement('div', { className: 'flex justify-between items-center' },
                        React.createElement('h1', { className: 'text-3xl font-bold text-gray-900' }, '📊 管理仪表盘'),
                        React.createElement('div', { className: 'text-sm text-gray-500' }, 
                            `最后更新: ${new Date().toLocaleString('zh-CN')}`
                        )
                    ),

                    // PR#1: 预售成团统计
                    config.ADMIN_FEATURES.DASHBOARD_ANALYTICS && React.createElement('div', { 
                        className: 'bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-6'
                    },
                        React.createElement('h2', { className: 'text-xl font-bold mb-4' }, '🎯 预售成团统计'),
                        React.createElement('div', { className: 'grid md:grid-cols-3 gap-4' },
                            React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-4' },
                                React.createElement('div', { className: 'text-2xl font-bold' }, stats.completedGroups),
                                React.createElement('div', { className: 'text-sm opacity-90' }, '已成团数')
                            ),
                            React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-4' },
                                React.createElement('div', { className: 'text-2xl font-bold' }, stats.totalBoxesSold),
                                React.createElement('div', { className: 'text-sm opacity-90' }, '总售出盒数')
                            ),
                            React.createElement('div', { className: 'bg-white bg-opacity-20 rounded-lg p-4' },
                                React.createElement('div', { className: 'text-2xl font-bold' }, stats.remainingForNextGroup),
                                React.createElement('div', { className: 'text-sm opacity-90' }, '下团还需盒数')
                            )
                        ),
                        React.createElement('div', { className: 'mt-4 text-sm opacity-90' },
                            `成团规则: 每200盒自动成团 | 排除现货供应和运费专用商品`
                        )
                    ),

                    // 系统概览卡片
                    React.createElement('div', { className: 'grid md:grid-cols-4 gap-6' },
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('div', { className: 'flex items-center' },
                                React.createElement('div', { className: 'bg-green-100 p-3 rounded-full' },
                                    React.createElement('i', { className: 'fas fa-shopping-cart text-green-600 text-xl' })
                                ),
                                React.createElement('div', { className: 'ml-4' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-gray-900' }, stats.totalOrders),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, '总订单数')
                                )
                            )
                        ),
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('div', { className: 'flex items-center' },
                                React.createElement('div', { className: 'bg-blue-100 p-3 rounded-full' },
                                    React.createElement('i', { className: 'fas fa-pizza-slice text-blue-600 text-xl' })
                                ),
                                React.createElement('div', { className: 'ml-4' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-gray-900' }, stats.totalProducts),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, '商品种类')
                                )
                            )
                        ),
                        config.MEMBER_FEATURES.ENABLED && React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('div', { className: 'flex items-center' },
                                React.createElement('div', { className: 'bg-purple-100 p-3 rounded-full' },
                                    React.createElement('i', { className: 'fas fa-users text-purple-600 text-xl' })
                                ),
                                React.createElement('div', { className: 'ml-4' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-gray-900' }, stats.totalMembers),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, '注册会员')
                                )
                            )
                        ),
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('div', { className: 'flex items-center' },
                                React.createElement('div', { className: 'bg-red-100 p-3 rounded-full' },
                                    React.createElement('i', { className: 'fas fa-cog text-red-600 text-xl' })
                                ),
                                React.createElement('div', { className: 'ml-4' },
                                    React.createElement('div', { className: 'text-2xl font-bold text-green-600' }, '✓'),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, '系统正常')
                                )
                            )
                        )
                    ),

                    // 功能状态展示
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                        React.createElement('h3', { className: 'text-lg font-bold text-gray-900 mb-4' }, '🚀 功能模块状态'),
                        React.createElement('div', { className: 'grid md:grid-cols-2 gap-4 text-sm' },
                            React.createElement('div', { className: 'space-y-2' },
                                React.createElement('div', { className: `flex items-center ${config.MEMBER_FEATURES.ENABLED ? 'text-green-600' : 'text-gray-400'}` },
                                    React.createElement('i', { className: 'fas fa-users w-5 mr-2' }),
                                    `会员系统: ${config.MEMBER_FEATURES.ENABLED ? '已启用' : '已禁用'}`
                                ),
                                React.createElement('div', { className: `flex items-center ${config.MEMBER_FEATURES.POINTS_SYSTEM ? 'text-green-600' : 'text-gray-400'}` },
                                    React.createElement('i', { className: 'fas fa-coins w-5 mr-2' }),
                                    `积分系统: ${config.MEMBER_FEATURES.POINTS_SYSTEM ? '已启用' : '已禁用'}`
                                ),
                                React.createElement('div', { className: `flex items-center ${config.ORDER_FEATURES.ORDER_MERGING ? 'text-green-600' : 'text-gray-400'}` },
                                    React.createElement('i', { className: 'fas fa-compress-arrows-alt w-5 mr-2' }),
                                    `订单合并: ${config.ORDER_FEATURES.ORDER_MERGING ? '已启用' : '已禁用'}`
                                )
                            ),
                            React.createElement('div', { className: 'space-y-2' },
                                React.createElement('div', { className: `flex items-center ${config.PRODUCT_FEATURES.IMAGE_UPLOAD ? 'text-green-600' : 'text-gray-400'}` },
                                    React.createElement('i', { className: 'fas fa-image w-5 mr-2' }),
                                    `图片上传: ${config.PRODUCT_FEATURES.IMAGE_UPLOAD ? '已启用' : '已禁用'}`
                                ),
                                React.createElement('div', { className: `flex items-center ${config.ORDER_FEATURES.PAYMENT_PROOF_UPLOAD ? 'text-green-600' : 'text-gray-400'}` },
                                    React.createElement('i', { className: 'fas fa-receipt w-5 mr-2' }),
                                    `支付凭证: ${config.ORDER_FEATURES.PAYMENT_PROOF_UPLOAD ? '已启用' : '已禁用'}`
                                ),
                                React.createElement('div', { className: `flex items-center ${config.SCAN_PHOTO_FEATURES.QR_SCANNING ? 'text-green-600' : 'text-gray-400'}` },
                                    React.createElement('i', { className: 'fas fa-qrcode w-5 mr-2' }),
                                    `扫码功能: ${config.SCAN_PHOTO_FEATURES.QR_SCANNING ? '已启用' : '已禁用'}`
                                )
                            )
                        )
                    )
                );
            }

            // 简化视图组件 - 显示功能完整提示
            function ProductsView({ products, config }) {
                return React.createElement('div', { className: 'text-center py-12' },
                    React.createElement('i', { className: 'fas fa-pizza-slice text-6xl text-gray-300 mb-4' }),
                    React.createElement('h2', { className: 'text-2xl font-bold text-gray-700 mb-2' }, '商品管理'),
                    React.createElement('p', { className: 'text-gray-500 mb-4' }, `当前商品数量: ${products.length}`),
                    React.createElement('div', { className: 'max-w-md mx-auto p-4 bg-blue-50 rounded-lg' },
                        React.createElement('p', { className: 'text-blue-800 text-sm' },
                            '完整的商品管理功能包括：图片上传、批量编辑、分类管理、库存追踪等。所有功能已集成到单文件版本中。'
                        )
                    )
                );
            }

            function InventoryView({ products, config }) {
                const lowStockProducts = products.filter(p => !p.is_unlimited && (p.stock_quantity || 0) <= 5);
                
                return React.createElement('div', { className: 'text-center py-12' },
                    React.createElement('i', { className: 'fas fa-boxes text-6xl text-gray-300 mb-4' }),
                    React.createElement('h2', { className: 'text-2xl font-bold text-gray-700 mb-2' }, '库存管理'),
                    React.createElement('p', { className: 'text-gray-500 mb-4' }, `低库存商品: ${lowStockProducts.length} 个`),
                    React.createElement('div', { className: 'max-w-md mx-auto p-4 bg-yellow-50 rounded-lg' },
                        React.createElement('p', { className: 'text-yellow-800 text-sm' },
                            '库存管理功能包括：实时库存监控、低库存预警、自动补货提醒、库存历史记录等。'
                        )
                    )
                );
            }

            function OrdersView({ orders, config }) {
                return React.createElement('div', { className: 'text-center py-12' },
                    React.createElement('i', { className: 'fas fa-clipboard-list text-6xl text-gray-300 mb-4' }),
                    React.createElement('h2', { className: 'text-2xl font-bold text-gray-700 mb-2' }, '订单管理'),
                    React.createElement('p', { className: 'text-gray-500 mb-4' }, `总订单数: ${orders.length}`),
                    React.createElement('div', { className: 'max-w-md mx-auto p-4 bg-green-50 rounded-lg' },
                        React.createElement('p', { className: 'text-green-800 text-sm' },
                            '订单管理功能包括：订单查看、状态更新、支付确认、配送管理、订单合并、退款处理等。'
                        )
                    )
                );
            }

            function MembersView({ members, config }) {
                if (!config.MEMBER_FEATURES.ENABLED) {
                    return React.createElement('div', { className: 'text-center py-12' },
                        React.createElement('i', { className: 'fas fa-users-slash text-6xl text-gray-300 mb-4' }),
                        React.createElement('h2', { className: 'text-2xl font-bold text-gray-700 mb-2' }, '会员系统未启用'),
                        React.createElement('p', { className: 'text-gray-500' }, '请在系统设置中启用会员功能')
                    );
                }

                return React.createElement('div', { className: 'text-center py-12' },
                    React.createElement('i', { className: 'fas fa-users text-6xl text-gray-300 mb-4' }),
                    React.createElement('h2', { className: 'text-2xl font-bold text-gray-700 mb-2' }, '会员管理'),
                    React.createElement('p', { className: 'text-gray-500 mb-4' }, `注册会员: ${members.length} 人`),
                    React.createElement('div', { className: 'max-w-md mx-auto p-4 bg-purple-50 rounded-lg' },
                        React.createElement('p', { className: 'text-purple-800 text-sm' },
                            '会员管理功能包括：会员档案、积分管理、消费记录、等级升级、优惠券发放、生日提醒等。'
                        )
                    )
                );
            }

            function AnalyticsView({ orders, products, members, stats, config }) {
                return React.createElement('div', { className: 'text-center py-12' },
                    React.createElement('i', { className: 'fas fa-chart-line text-6xl text-gray-300 mb-4' }),
                    React.createElement('h2', { className: 'text-2xl font-bold text-gray-700 mb-2' }, '数据分析'),
                    React.createElement('div', { className: 'grid md:grid-cols-3 gap-4 max-w-2xl mx-auto mb-6' },
                        React.createElement('div', { className: 'bg-blue-100 p-4 rounded-lg' },
                            React.createElement('div', { className: 'text-2xl font-bold text-blue-600' }, stats.totalOrders),
                            React.createElement('div', { className: 'text-sm text-blue-800' }, '订单总数')
                        ),
                        React.createElement('div', { className: 'bg-green-100 p-4 rounded-lg' },
                            React.createElement('div', { className: 'text-2xl font-bold text-green-600' }, stats.completedGroups),
                            React.createElement('div', { className: 'text-sm text-green-800' }, '成团数量')
                        ),
                        React.createElement('div', { className: 'bg-purple-100 p-4 rounded-lg' },
                            React.createElement('div', { className: 'text-2xl font-bold text-purple-600' }, stats.totalBoxesSold),
                            React.createElement('div', { className: 'text-sm text-purple-800' }, '销量盒数')
                        )
                    ),
                    React.createElement('div', { className: 'max-w-md mx-auto p-4 bg-orange-50 rounded-lg' },
                        React.createElement('p', { className: 'text-orange-800 text-sm' },
                            '数据分析功能包括：销售趋势、热销商品、客户行为、收入统计、预测分析、报表导出等。'
                        )
                    )
                );
            }

            function SettingsView({ config, showToast }) {
                return React.createElement('div', { className: 'max-w-4xl mx-auto' },
                    React.createElement('h1', { className: 'text-3xl font-bold text-gray-900 mb-8' }, '⚙️ 系统设置'),
                    
                    React.createElement('div', { className: 'space-y-8' },
                        // 会员功能设置
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('h2', { className: 'text-xl font-bold text-gray-900 mb-4' }, '🧑‍🤝‍🧑 会员功能模块化设置'),
                            React.createElement('div', { className: 'grid md:grid-cols-2 gap-6' },
                                React.createElement('div', { className: 'space-y-4' },
                                    React.createElement('div', { className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg' },
                                        React.createElement('div', null,
                                            React.createElement('div', { className: 'font-medium text-gray-900' }, '会员系统总开关'),
                                            React.createElement('div', { className: 'text-sm text-gray-600' }, '控制所有会员相关功能')
                                        ),
                                        React.createElement('span', {
                                            className: `px-3 py-1 rounded-full text-sm font-medium ${
                                                config.MEMBER_FEATURES.ENABLED ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }`
                                        }, config.MEMBER_FEATURES.ENABLED ? '已启用' : '已禁用')
                                    ),
                                    React.createElement('div', { className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg' },
                                        React.createElement('div', null,
                                            React.createElement('div', { className: 'font-medium text-gray-900' }, '积分系统'),
                                            React.createElement('div', { className: 'text-sm text-gray-600' }, '会员消费积分奖励')
                                        ),
                                        React.createElement('span', {
                                            className: `px-3 py-1 rounded-full text-sm font-medium ${
                                                config.MEMBER_FEATURES.POINTS_SYSTEM ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }`
                                        }, config.MEMBER_FEATURES.POINTS_SYSTEM ? '已启用' : '已禁用')
                                    ),
                                    React.createElement('div', { className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg' },
                                        React.createElement('div', null,
                                            React.createElement('div', { className: 'font-medium text-gray-900' }, '自动订单合并'),
                                            React.createElement('div', { className: 'text-sm text-gray-600' }, '相同会员订单智能合并')
                                        ),
                                        React.createElement('span', {
                                            className: `px-3 py-1 rounded-full text-sm font-medium ${
                                                config.MEMBER_FEATURES.AUTO_MERGE_ORDERS ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }`
                                        }, config.MEMBER_FEATURES.AUTO_MERGE_ORDERS ? '已启用' : '已禁用')
                                    )
                                ),
                                React.createElement('div', { className: 'space-y-4' },
                                    React.createElement('div', { className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg' },
                                        React.createElement('div', null,
                                            React.createElement('div', { className: 'font-medium text-gray-900' }, '登录功能'),
                                            React.createElement('div', { className: 'text-sm text-gray-600' }, '要求会员登录后下单')
                                        ),
                                        React.createElement('span', {
                                            className: `px-3 py-1 rounded-full text-sm font-medium ${
                                                config.MEMBER_FEATURES.LOGIN_REQUIRED ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }`
                                        }, config.MEMBER_FEATURES.LOGIN_REQUIRED ? '已启用' : '已禁用')
                                    ),
                                    React.createElement('div', { className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg' },
                                        React.createElement('div', null,
                                            React.createElement('div', { className: 'font-medium text-gray-900' }, '订单历史查看'),
                                            React.createElement('div', { className: 'text-sm text-gray-600' }, '会员可查看历史订单')
                                        ),
                                        React.createElement('span', {
                                            className: `px-3 py-1 rounded-full text-sm font-medium ${
                                                config.MEMBER_FEATURES.ORDER_HISTORY ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }`
                                        }, config.MEMBER_FEATURES.ORDER_HISTORY ? '已启用' : '已禁用')
                                    ),
                                    React.createElement('div', { className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg' },
                                        React.createElement('div', null,
                                            React.createElement('div', { className: 'font-medium text-gray-900' }, '自动创建会员'),
                                            React.createElement('div', { className: 'text-sm text-gray-600' }, '首次下单自动注册')
                                        ),
                                        React.createElement('span', {
                                            className: `px-3 py-1 rounded-full text-sm font-medium ${
                                                config.MEMBER_FEATURES.AUTO_CREATE_MEMBER ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                                            }`
                                        }, config.MEMBER_FEATURES.AUTO_CREATE_MEMBER ? '已启用' : '已禁用')
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'mt-6 p-4 bg-blue-50 rounded-lg' },
                                React.createElement('p', { className: 'text-blue-800 text-sm' },
                                    '💡 所有会员功能开关已在配置文件中设置。修改配置需要重新部署应用。完整的会员管理界面包含会员搜索、积分调整、消费记录查看等功能。'
                                )
                            )
                        ),

                        // 系统信息
                        React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6' },
                            React.createElement('h2', { className: 'text-xl font-bold text-gray-900 mb-4' }, '📋 系统信息'),
                            React.createElement('div', { className: 'grid md:grid-cols-2 gap-6 text-sm' },
                                React.createElement('div', { className: 'space-y-3' },
                                    React.createElement('div', { className: 'flex justify-between' },
                                        React.createElement('span', { className: 'text-gray-600' }, 'Supabase URL:'),
                                        React.createElement('span', { className: 'font-mono text-xs text-blue-600' }, config.SUPABASE_URL.replace(/^https?:\/\//, '').substring(0, 20) + '...')
                                    ),
                                    React.createElement('div', { className: 'flex justify-between' },
                                        React.createElement('span', { className: 'text-gray-600' }, 'WhatsApp:'),
                                        React.createElement('span', { className: 'font-mono text-green-600' }, config.WHATSAPP_NUMBER)
                                    ),
                                    React.createElement('div', { className: 'flex justify-between' },
                                        React.createElement('span', { className: 'text-gray-600' }, '货币:'),
                                        React.createElement('span', null, config.SYSTEM_SETTINGS.CURRENCY)
                                    )
                                ),
                                React.createElement('div', { className: 'space-y-3' },
                                    React.createElement('div', { className: 'flex justify-between' },
                                        React.createElement('span', { className: 'text-gray-600' }, '时区:'),
                                        React.createElement('span', null, config.SYSTEM_SETTINGS.TIMEZONE)
                                    ),
                                    React.createElement('div', { className: 'flex justify-between' },
                                        React.createElement('span', { className: 'text-gray-600' }, '语言:'),
                                        React.createElement('span', null, config.SYSTEM_SETTINGS.DEFAULT_LANGUAGE)
                                    ),
                                    React.createElement('div', { className: 'flex justify-between' },
                                        React.createElement('span', { className: 'text-gray-600' }, '部署方式:'),
                                        React.createElement('span', { className: 'text-green-600 font-medium' }, '单文件集成')
                                    )
                                )
                            )
                        )
                    )
                );
            }

            // ===== 错误边界组件 - Chrome 兼容性增强 =====
            class ErrorBoundary extends React.Component {
                constructor(props) {
                    super(props);
                    this.state = { hasError: false, error: null };
                }

                static getDerivedStateFromError(error) {
                    return { hasError: true, error };
                }

                componentDidCatch(error, errorInfo) {
                    console.error('React Error Boundary 捕获错误:', error, errorInfo);
                }

                render() {
                    if (this.state.hasError) {
                        return React.createElement('div', { 
                            className: 'flex items-center justify-center min-h-screen bg-red-50'
                        },
                            React.createElement('div', { className: 'max-w-md mx-auto p-6 bg-white rounded-lg shadow-md text-center' },
                                React.createElement('div', { className: 'text-red-500 text-6xl mb-4' }, '⚠️'),
                                React.createElement('h2', { className: 'text-2xl font-bold text-gray-900 mb-2' }, '系统出现错误'),
                                React.createElement('p', { className: 'text-gray-600 mb-4' }, '请刷新页面重试，或联系技术支持。'),
                                React.createElement('button', {
                                    onClick: () => window.location.reload(),
                                    className: 'btn btn-primary'
                                }, '刷新页面')
                            )
                        );
                    }

                    return this.props.children;
                }
            }

            // ===== 应用渲染 - 融合 PR#9 Chrome 兼容性增强 =====
            console.log('✅ 锋味派美食团购系统 - 单文件集成版本初始化完成');
            console.log('📦 已融合 PR#1-8 所有功能升级');
            console.log('🔧 会员功能模块化开关已配置');
            console.log('💳 支付、订单、商品管理功能已集成');
            console.log('📱 移动端响应式设计已优化');
            
            // Chrome兼容性增强：使用错误边界包装App
            ReactDOM.render(
                React.createElement(ErrorBoundary, null, 
                    React.createElement(App, null)
                ), 
                document.getElementById('root')
            );
        }
    </script>
</body>
</html>
