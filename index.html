<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://edfnhhthztskuuosuasw.supabase.co/storage/v1/object/public/product-photos/icon3.jpg">
    <title>锋味派美食团购系统</title>
    
    <!-- ===== 功能开关配置 ===== -->
    <script>
        // 🎯 会员功能配置开关 - 在此控制所有会员相关功能
        window.MEMBER_CONFIG = {
            ENABLE_MEMBER_SYSTEM: true,        // 启用会员系统
            ENABLE_MEMBER_LOGIN: true,         // 启用会员登录
            ENABLE_MEMBER_POINTS: true,        // 启用积分系统
            ENABLE_ORDER_HISTORY: true,       // 启用订单历史
            ENABLE_PHONE_VERIFICATION: true,  // 启用手机号验证
            ENABLE_AUTO_MEMBER_CREATE: true,  // 启用自动创建会员
            ENABLE_MEMBER_BACKEND: true       // 启用后台会员管理
        };
        
        // 🔧 系统功能配置
        window.SYSTEM_CONFIG = {
            ENABLE_INVENTORY_MANAGEMENT: true, // 启用库存管理
            ENABLE_CATEGORY_NAVIGATION: true,  // 启用分类导航
            ENABLE_SHOPPING_CART: true,        // 启用购物车
            ENABLE_ADMIN_BACKEND: true,        // 启用管理后台
            ENABLE_WHATSAPP_NOTIFY: true,      // 启用WhatsApp通知
            ENABLE_PAYMENT_PROOF: true,        // 启用支付凭证
            ENABLE_SCANNER_CAMERA: true        // 启用扫码拍照功能
        };
    </script>
    
    <!-- ===== Supabase 配置内嵌 ===== -->
    <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    
    <!-- ===== 增强CSS样式 - 融合设计系统 ===== -->
    <style>
        /* 设计系统变量 - 修复正确配色方案 */
        :root {
            --color-background: #f8fafc;
            --color-surface: #ffffff;
            --color-text: #333333;
            --color-text-secondary: #6b7280;
            --color-primary: #dc2626;
            --color-primary-hover: #b91c1c;
            --color-primary-active: #991b1b;
            --color-secondary: rgba(107, 114, 128, 0.12);
            --color-border: #d1d5db;
            --color-error: #dc2626;
            --color-success: #16a34a;
            --color-warning: #f59e0b;
            --color-focus-ring: rgba(220, 38, 38, 0.4);
            
            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            
            --space-1: 0.25rem;
            --space-2: 0.5rem;
            --space-3: 0.75rem;
            --space-4: 1rem;
            --space-5: 1.25rem;
            --space-6: 1.5rem;
            --space-8: 2rem;
            
            --radius-sm: 0.375rem;
            --radius-base: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-full: 9999px;
            
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        /* 暗色模式 */
        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: #111827;
                --color-surface: #1f2937;
                --color-text: #f9fafb;
                --color-text-secondary: rgba(156, 163, 175, 0.7);
                --color-primary: #ef4444;
                --color-border: rgba(75, 85, 99, 0.3);
            }
        }
        
        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-family-base);
            font-size: var(--font-size-base);
            line-height: 1.6;
            color: var(--color-text);
            background-color: var(--color-background);
            -webkit-font-smoothing: antialiased;
        }
        
        /* 🎨 组件样式 */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }
        
        /* 按钮系统 */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            border: none;
            border-radius: var(--radius-base);
            font-size: var(--font-size-sm);
            font-weight: 600;
            line-height: 1.5;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            position: relative;
        }
        
        .btn:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px var(--color-focus-ring);
        }
        
        .btn--primary {
            background: var(--color-primary);
            color: white;
        }
        
        .btn--primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-1px);
        }
        
        .btn--secondary {
            background: var(--color-secondary);
            color: var(--color-text);
        }
        
        .btn--danger {
            background: var(--color-error);
            color: white;
        }
        
        .btn--success {
            background: var(--color-success);
            color: white;
        }
        
        /* 表单控件 */
        .form-control {
            display: block;
            width: 100%;
            padding: var(--space-2) var(--space-3);
            font-size: var(--font-size-base);
            line-height: 1.5;
            color: var(--color-text);
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        .form-control:focus {
            border-color: var(--color-primary);
            outline: none;
            box-shadow: 0 0 0 3px var(--color-focus-ring);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--space-2);
            font-weight: 600;
            font-size: var(--font-size-sm);
            color: var(--color-text);
        }
        
        .form-group {
            margin-bottom: var(--space-4);
        }
        
        /* 密码可见性切换 */
        .password-input-container {
            position: relative;
        }
        
        .password-toggle {
            position: absolute;
            right: var(--space-3);
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--radius-sm);
        }
        
        .password-toggle:hover {
            color: var(--color-text);
            background: var(--color-secondary);
        }
        
        /* 卡片组件 */
        .card {
            background-color: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: box-shadow 0.2s ease;
        }
        
        .card:hover {
            box-shadow: var(--shadow-md);
        }
        
        .card__body {
            padding: var(--space-4);
        }
        
        /* 导航栏 */
        .navbar {
            background: var(--color-primary);
            color: white;
            padding: var(--space-4) 0;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 50;
        }
        
        /* 分类导航 */
        .category-nav {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: var(--space-3) 0;
            position: sticky;
            top: 70px;
            z-index: 40;
        }
        
        .category-buttons {
            display: flex;
            gap: var(--space-2);
            justify-content: center;
            flex-wrap: wrap;
            padding: 0 var(--space-4);
        }
        
        .category-btn {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-full);
            background: var(--color-surface);
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            font-size: var(--font-size-sm);
        }
        
        .category-btn:hover,
        .category-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
            transform: translateY(-1px);
        }
        
        /* 购物车侧边栏 */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--color-surface);
            box-shadow: var(--shadow-lg);
            transition: right 0.3s ease;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        
        .cart-sidebar.open {
            right: 0;
        }
        
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 90;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .cart-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* 购物车徽章 */
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--color-error);
            color: white;
            border-radius: var(--radius-full);
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        /* 浮动购物车按钮 */
        .floating-cart {
            position: fixed;
            bottom: var(--space-6);
            right: var(--space-6);
            z-index: 40;
        }
        
        .floating-cart-btn {
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: var(--space-4);
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .floating-cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        /* 产品网格 */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: var(--space-6);
            padding: var(--space-6) 0;
        }
        
        .product-card {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
        }
        
        .product-info {
            padding: var(--space-4);
        }
        
        .product-name {
            font-weight: 600;
            font-size: var(--font-size-lg);
            margin-bottom: var(--space-2);
            color: var(--color-text);
        }
        
        .product-price {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: var(--space-3);
        }
        
        /* 管理后台布局 */
        .admin-layout {
            display: flex;
            min-height: 100vh;
        }
        
        .admin-sidebar {
            width: 250px;
            background: var(--color-surface);
            border-right: 1px solid var(--color-border);
            padding: var(--space-6) 0;
        }
        
        .admin-content {
            flex: 1;
            padding: var(--space-6);
            background: var(--color-background);
            overflow-y: auto;
        }
        
        .admin-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .admin-nav-item {
            display: flex;
            align-items: center;
            padding: var(--space-3) var(--space-6);
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            color: var(--color-text);
        }
        
        .admin-nav-item:hover,
        .admin-nav-item.active {
            background: var(--color-secondary);
            border-left-color: var(--color-primary);
            color: var(--color-primary);
        }
        
        .admin-nav-icon {
            font-size: var(--font-size-lg);
            margin-right: var(--space-3);
            width: 20px;
        }
        
        /* 状态指示器 */
        .status {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-weight: 600;
            font-size: var(--font-size-sm);
        }
        
        .status--success {
            background: rgba(33, 128, 141, 0.1);
            color: var(--color-success);
            border: 1px solid rgba(33, 128, 141, 0.2);
        }
        
        .status--warning {
            background: rgba(168, 75, 47, 0.1);
            color: var(--color-warning);
            border: 1px solid rgba(168, 75, 47, 0.2);
        }
        
        .status--error {
            background: rgba(192, 21, 47, 0.1);
            color: var(--color-error);
            border: 1px solid rgba(192, 21, 47, 0.2);
        }
        
        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            padding: var(--space-5);
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: var(--space-5);
        }
        
        .modal-footer {
            padding: var(--space-5);
            border-top: 1px solid var(--color-border);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-3);
        }
        
        /* 登录界面 */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .login-container {
            background: var(--color-surface);
            padding: var(--space-8);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }
        
        .login-header h1 {
            color: var(--color-primary);
            margin-bottom: var(--space-2);
            font-size: var(--font-size-3xl);
        }
        
        .login-header p {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-6);
        }
        
        .login-form {
            text-align: left;
        }
        
        /* 表格样式 */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-4);
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }
        
        .data-table th,
        .data-table td {
            padding: var(--space-3);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }
        
        .data-table th {
            background: var(--color-secondary);
            font-weight: 600;
            color: var(--color-text);
        }
        
        .data-table tr:hover {
            background: var(--color-secondary);
        }
        
        /* 工具栏 */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            gap: var(--space-4);
            flex-wrap: wrap;
        }
        
        .toolbar-left,
        .toolbar-right {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        /* 加载状态 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--color-border);
            border-radius: 50%;
            border-top-color: var(--color-primary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 空状态 */
        .empty-state {
            text-align: center;
            padding: var(--space-8);
            color: var(--color-text-secondary);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: var(--space-4);
        }
        
        /* 通知消息 */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            padding: var(--space-3) var(--space-4);
            border-radius: var(--radius-base);
            max-width: 300px;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .toast.success {
            background: rgba(33, 128, 141, 0.1);
            color: var(--color-success);
            border: 1px solid rgba(33, 128, 141, 0.2);
        }
        
        .toast.error {
            background: rgba(192, 21, 47, 0.1);
            color: var(--color-error);
            border: 1px solid rgba(192, 21, 47, 0.2);
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                padding: 0 var(--space-3);
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: var(--space-4);
            }
            
            .category-buttons {
                justify-content: flex-start;
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: var(--space-2);
            }
            
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
            
            .admin-layout {
                flex-direction: column;
            }
            
            .admin-sidebar {
                width: 100%;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--color-border);
            }
            
            .admin-nav {
                display: flex;
                overflow-x: auto;
                padding: 0 var(--space-4);
            }
            
            .admin-nav-item {
                flex: 0 0 auto;
                padding: var(--space-2) var(--space-4);
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .admin-nav-item:hover,
            .admin-nav-item.active {
                border-left: none;
                border-bottom-color: var(--color-primary);
            }
            
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .toolbar-left,
            .toolbar-right {
                justify-content: center;
            }
        }
        
        /* 库存状态 */
        .stock-badge {
            display: inline-flex;
            align-items: center;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .stock-badge--in-stock {
            background: rgba(33, 128, 141, 0.1);
            color: var(--color-success);
        }
        
        .stock-badge--low-stock {
            background: rgba(168, 75, 47, 0.1);
            color: var(--color-warning);
        }
        
        .stock-badge--out-of-stock {
            background: rgba(192, 21, 47, 0.1);
            color: var(--color-error);
        }
        
        /* 产品徽章 */
        .product-badge {
            position: absolute;
            top: var(--space-3);
            right: var(--space-3);
            background: var(--color-primary);
            color: white;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .product-badge--presale {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }
        
        .product-badge--low-stock {
            background: linear-gradient(135deg, #f59e0b, #ef4444);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* 页面标题 */
        .page-header {
            margin-bottom: var(--space-6);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-4);
        }
        
        .page-title {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--color-text);
            margin: 0;
        }
        
        .page-subtitle {
            margin: var(--space-1) 0 0 0;
            color: var(--color-text-secondary);
            font-size: var(--font-size-base);
        }
        
        /* 功能切换开关 */
        .feature-toggle {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ccc;
            transition: 0.4s;
            border-radius: 24px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: 0.4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background: var(--color-primary);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        /* 统计卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-4);
            margin-bottom: var(--space-6);
        }
        
        .stat-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            display: flex;
            align-items: center;
            gap: var(--space-4);
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }
        
        .stat-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-secondary);
            border-radius: var(--radius-lg);
        }
        
        .stat-content h3 {
            margin: 0 0 var(--space-2) 0;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            font-weight: 500;
        }
        
        .stat-value {
            margin: 0;
            font-size: var(--font-size-2xl);
            font-weight: 700;
            color: var(--color-text);
        }
        
        /* 隐藏类 */
        .hidden {
            display: none !important;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- ===== 完整功能实现脚本 ===== -->
    <script type="text/babel">
        // 🔧 Supabase 配置
        const SUPABASE_URL = 'https://edfnhhthztskuuosuasw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVkZm5oaHRoenRza3V1b3N1YXN3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk5OTYxMTYsImV4cCI6MjA2NTU3MjExNn0.O3g2gjvsWagmWgmzoeJA8mPampvLYJr-KgqVwXsKoAo';
        const ADMIN_PASSWORD = 'fengweipaiadmin';
        const WHATSAPP_NUMBER = '60162327792';
        const SELF_PICKUP_ADDRESS = '667, Jalan 24, Taman Perindustrian Ehsan Jaya, Kepong, 52100, Kuala Lumpur.';
        
        // 创建 Supabase 客户端
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // React Hooks
        const { useState, useEffect, useCallback, useRef, useMemo } = React;
        
        // 🛠️ 工具函数
        const buildOrderMessage = (order) => {
            try {
                let msg = `🛎️ *锋味派新订单 #${order.order_id}*\n\n`;
                msg += `👤 *客户信息*\n📛 姓名: ${order.name}\n📱 电话: ${order.phone}\n🚚 取货方式: ${order.delivery_method === 'self-pickup' ? '自取' : 'Lalamove送货'}\n`;
                if (order.delivery_method === 'self-pickup') {
                    msg += `📍 自取地址: ${SELF_PICKUP_ADDRESS}\n`;
                }
                msg += `\n🛒 *订单明细*\n`;
                (order.order_items || []).forEach(item => {
                    const emoji = item.emoji || '🍽️';
                    const typeLabel = item.is_unlimited ? ' (预购)' : ' (现货)';
                    msg += `${emoji} ${item.product}${typeLabel} × ${item.quantity} = RM${(item.quantity * item.price).toFixed(2)}\n`;
                });
                msg += `\n💰 *总金额: RM${Number(order.total_amount).toFixed(2)}*\n`;
                msg += `📝 *备注*: ${order.remarks || '无'}\n`;
                msg += `📅 *下单时间*: ${new Date(order.created_at).toLocaleString('zh-CN')}`;
                return msg;
            } catch (error) {
                console.error('构建订单消息失败:', error);
                return '订单信息生成失败';
            }
        };
        
        const copyTextUniversal = async (text) => {
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(text);
                    return true;
                }
            } catch (e) {}
            try {
                const ta = document.createElement('textarea');
                ta.value = text;
                ta.style.position = 'fixed';
                ta.style.top = '-2000px';
                document.body.appendChild(ta);
                ta.select();
                document.execCommand('copy');
                document.body.removeChild(ta);
                return true;
            } catch (e) {
                return false;
            }
        };
        
        const generateOrderId = async () => {
            const today = new Date();
            const dateStr = today.getFullYear().toString() + 
                            (today.getMonth() + 1).toString().padStart(2, '0') + 
                            today.getDate().toString().padStart(2, '0');
            
            const { data: todayOrders } = await supabase
                .from('orders')
                .select('order_id')
                .ilike('order_id', `FW${dateStr}%`)
                .order('order_id', { ascending: false })
                .limit(1);
            
            let sequenceNumber = 1;
            if (todayOrders && todayOrders.length > 0) {
                const lastOrderId = todayOrders[0].order_id;
                const lastSequence = parseInt(lastOrderId.substring(10));
                sequenceNumber = lastSequence + 1;
            }
            
            return `FW${dateStr}${sequenceNumber.toString().padStart(3, '0')}`;
        };
        
        // 🎨 UI 组件
        const LoadingSpinner = ({ text }) => (
            <div className="flex justify-center items-center p-6">
                <div className="loading"></div>
                {text && <span className="ml-3 text-gray-600">{text}</span>}
            </div>
        );
        
        const Toast = ({ message, type = 'success', onDismiss }) => {
            useEffect(() => {
                const timer = setTimeout(() => {
                    if (onDismiss) onDismiss();
                }, 3000);
                return () => clearTimeout(timer);
            }, [onDismiss]);
            
            return (
                <div className={`toast ${type}`}>
                    {message}
                </div>
            );
        };
        
        // 🔐 登录组件 - 增强密码可见性切换
        const LoginScreen = ({ onLogin }) => {
            const [password, setPassword] = useState('');
            const [showPassword, setShowPassword] = useState(false);
            const [error, setError] = useState('');
            const [loading, setLoading] = useState(false);
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!password.trim()) {
                    setError('请输入密码');
                    return;
                }
                
                setLoading(true);
                setError('');
                
                // 模拟验证延迟
                setTimeout(() => {
                    if (password === ADMIN_PASSWORD) {
                        onLogin({ role: 'admin' });
                    } else {
                        setError('密码错误，请重试');
                    }
                    setLoading(false);
                }, 500);
            };
            
            const togglePasswordVisibility = () => {
                setShowPassword(!showPassword);
            };
            
            return (
                <div className="login-screen">
                    <div className="login-container">
                        <div className="login-header">
                            <h1>🍽️ 锋味派管理后台</h1>
                            <p>请输入管理员密码访问系统</p>
                        </div>
                        <form className="login-form" onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label className="form-label">管理员密码</label>
                                <div className="password-input-container">
                                    <input
                                        type={showPassword ? 'text' : 'password'}
                                        className="form-control"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        placeholder="输入管理员密码"
                                        required
                                        disabled={loading}
                                    />
                                    <button
                                        type="button"
                                        className="password-toggle"
                                        onClick={togglePasswordVisibility}
                                        title={showPassword ? '隐藏密码' : '显示密码'}
                                    >
                                        <i className={`fas ${showPassword ? 'fa-eye-slash' : 'fa-eye'}`}></i>
                                    </button>
                                </div>
                            </div>
                            {error && (
                                <div className="error-message" style={{
                                    background: 'rgba(192, 21, 47, 0.1)',
                                    color: '#c0152f',
                                    border: '1px solid rgba(192, 21, 47, 0.2)',
                                    padding: '0.75rem',
                                    borderRadius: '0.5rem',
                                    marginBottom: '1rem',
                                    fontSize: '0.875rem'
                                }}>
                                    <i className="fas fa-exclamation-triangle mr-2"></i>
                                    {error}
                                </div>
                            )}
                            <button 
                                type="submit" 
                                className={`btn btn--primary btn--full-width ${loading ? 'loading' : ''}`}
                                disabled={loading}
                                style={{ width: '100%', padding: '0.75rem' }}
                            >
                                {loading ? (
                                    <>
                                        <span className="loading mr-2"></span>
                                        验证中...
                                    </>
                                ) : (
                                    <>
                                        <i className="fas fa-sign-in-alt mr-2"></i>
                                        登录
                                    </>
                                )}
                            </button>
                        </form>
                        <div style={{
                            marginTop: '1.5rem',
                            padding: '1rem',
                            background: 'rgba(33, 128, 141, 0.1)',
                            borderRadius: '0.5rem',
                            fontSize: '0.875rem',
                            color: '#626c71'
                        }}>
                            <p><strong>🚀 系统功能特色：</strong></p>
                            <ul style={{ margin: '0.5rem 0', paddingLeft: '1.5rem' }}>
                                <li>📊 完整仪表盘 & 数据分析</li>
                                <li>🛒 智能购物车 & 库存管理</li>
                                <li>📱 会员系统 & 订单追踪</li>
                                <li>📸 扫码拍照 & 支付凭证</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 🛒 客户端购物视图
        const CustomerView = ({ onAdminClick }) => {
            const [products, setProducts] = useState([]);
            const [cart, setCart] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeCategory, setActiveCategory] = useState('全部商品');
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [toast, setToast] = useState(null);
            const [lastOrder, setLastOrder] = useState(null);
            
            // 分类配置 - 基于产品系列的分类导航
            const categories = [
                { id: 'all', name: '全部商品', emoji: '🍽️' },
                { id: 'hot-meals', name: '热销套餐', emoji: '🔥' },
                { id: 'noodles', name: '面条类', emoji: '🍜' },
                { id: 'rice', name: '饭类', emoji: '🍚' },
                { id: 'soup', name: '汤品', emoji: '🍲' },
                { id: 'snacks', name: '小食', emoji: '🥟' },
                { id: 'seasoning', name: '调料', emoji: '🧂' },
                { id: 'beverages', name: '饮料', emoji: '🥤' }
            ];
            
            const showToast = (message, type = 'success') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 3000);
            };
            
            // 获取产品列表
            const fetchProducts = useCallback(async () => {
                setLoading(true);
                try {
                    const { data, error } = await supabase
                        .from('products')
                        .select('*')
                        .eq('is_published', true)
                        .order('id');
                    
                    if (error) {
                        throw error;
                    }
                    
                    const formattedProducts = (data || []).map(p => ({
                        ...p,
                        stock: p.stock_quantity ?? 0,
                        minStock: p.min_stock_threshold ?? 5,
                        image: p.image_url || p.image || null
                    }));
                    
                    setProducts(formattedProducts);
                } catch (error) {
                    console.error('加载商品失败:', error);
                    showToast('加载商品失败: ' + error.message, 'error');
                } finally {
                    setLoading(false);
                }
            }, []);
            
            useEffect(() => {
                fetchProducts();
            }, [fetchProducts]);
            
            // 过滤产品 - 基于产品系列分类
            const filteredProducts = useMemo(() => {
                if (activeCategory === '全部商品') return products;
                
                // 根据产品分类字段进行筛选
                return products.filter(product => {
                    if (!product.category) return activeCategory === '全部商品';
                    
                    // 根据分类名称匹配
                    switch (activeCategory) {
                        case '热销套餐':
                            return product.category.includes('套餐') || product.category.includes('热销');
                        case '面条类':
                            return product.category.includes('面') || product.category.includes('粉');
                        case '饭类':
                            return product.category.includes('饭') || product.category.includes('粥');
                        case '汤品':
                            return product.category.includes('汤');
                        case '小食':
                            return product.category.includes('小食') || product.category.includes('点心') || product.category.includes('零食');
                        case '调料':
                            return product.category.includes('调料') || product.category.includes('酱');
                        case '饮料':
                            return product.category.includes('饮') || product.category.includes('茶') || product.category.includes('咖啡');
                        default:
                            return product.category === activeCategory;
                    }
                });
            }, [products, activeCategory]);
            
            // 添加到购物车
            const addToCart = (product) => {
                if (!product.is_unlimited && product.stock <= 0) {
                    showToast('商品已售罄', 'error');
                    return;
                }
                
                const existingItem = cart.find(item => item.id === product.id);
                if (existingItem) {
                    if (!product.is_unlimited && existingItem.quantity >= product.stock) {
                        showToast(`库存不足，仅剩${product.stock}件`, 'error');
                        return;
                    }
                    setCart(cart.map(item =>
                        item.id === product.id 
                            ? { ...item, quantity: item.quantity + 1 }
                            : item
                    ));
                } else {
                    setCart([...cart, { ...product, quantity: 1 }]);
                }
                showToast('商品已添加到购物车', 'success');
            };
            
            // 更新购物车数量
            const updateCartQuantity = (productId, newQuantity) => {
                if (newQuantity <= 0) {
                    setCart(cart.filter(item => item.id !== productId));
                    return;
                }
                
                setCart(cart.map(item => {
                    if (item.id === productId) {
                        const maxQuantity = item.is_unlimited ? newQuantity : Math.min(newQuantity, item.stock);
                        if (newQuantity > maxQuantity) {
                            showToast(`数量已调整为库存上限：${maxQuantity}件`, 'warning');
                            return { ...item, quantity: maxQuantity };
                        }
                        return { ...item, quantity: newQuantity };
                    }
                    return item;
                }));
            };
            
            // 移除购物车商品
            const removeFromCart = (productId) => {
                setCart(cart.filter(item => item.id !== productId));
                showToast('商品已移除', 'success');
            };
            
            // 计算购物车总计
            const cartTotal = useMemo(() => {
                return cart.reduce((total, item) => total + item.price * item.quantity, 0);
            }, [cart]);
            
            const totalItems = useMemo(() => {
                return cart.reduce((sum, item) => sum + item.quantity, 0);
            }, [cart]);
            
            return (
                <div className="min-h-screen bg-background">
                    {/* 导航栏 */}
                    <header className="navbar">
                        <div className="container">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center gap-3">
                                    <span className="text-3xl">🍽️</span>
                                    <h1 className="text-2xl font-bold">锋味派美食团购</h1>
                                </div>
                                <button 
                                    onClick={onAdminClick}
                                    className="text-white hover:text-gray-200 transition-colors"
                                >
                                    <div className="flex flex-col items-center">
                                        <i className="fas fa-user-shield text-2xl"></i>
                                        <span className="text-xs mt-1">管理</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </header>
                    
                    {/* 分类导航 */}
                    {window.SYSTEM_CONFIG.ENABLE_CATEGORY_NAVIGATION && (
                        <nav className="category-nav">
                            <div className="container">
                                <div className="category-buttons">
                                    {categories.map(category => (
                                        <button
                                            key={category.id}
                                            onClick={() => setActiveCategory(category.name)}
                                            className={`category-btn ${activeCategory === category.name ? 'active' : ''}`}
                                        >
                                            <span className="text-2xl">{category.emoji}</span>
                                            <span>{category.name}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </nav>
                    )}
                    
                    {/* 主要内容 */}
                    <main className="container" style={{ paddingTop: '2rem', paddingBottom: '6rem' }}>
                        {loading ? (
                            <LoadingSpinner text="加载商品中..." />
                        ) : (
                            <div className="products-grid">
                                {filteredProducts.length === 0 ? (
                                    <div className="empty-state">
                                        <div className="empty-state-icon">📦</div>
                                        <p>该分类下暂无商品</p>
                                    </div>
                                ) : (
                                    filteredProducts.map(product => (
                                        <ProductCard 
                                            key={product.id} 
                                            product={product} 
                                            onAddToCart={addToCart} 
                                        />
                                    ))
                                )}
                            </div>
                        )}
                    </main>
                    
                    {/* 浮动购物车按钮 */}
                    {window.SYSTEM_CONFIG.ENABLE_SHOPPING_CART && cart.length > 0 && (
                        <div className="floating-cart">
                            <button 
                                className="floating-cart-btn"
                                onClick={() => setIsCartOpen(true)}
                            >
                                <div className="relative">
                                    <i className="fas fa-shopping-cart text-2xl"></i>
                                    <span className="cart-badge">{totalItems}</span>
                                </div>
                                <div className="flex flex-col">
                                    <span className="font-bold text-lg">RM{cartTotal.toFixed(2)}</span>
                                    <span className="text-xs opacity-90">{totalItems} 件商品</span>
                                </div>
                            </button>
                        </div>
                    )}
                    
                    {/* 购物车侧边栏 */}
                    {window.SYSTEM_CONFIG.ENABLE_SHOPPING_CART && (
                        <>
                            <div 
                                className={`cart-overlay ${isCartOpen ? 'active' : ''}`}
                                onClick={() => setIsCartOpen(false)}
                            />
                            <CartSidebar
                                isOpen={isCartOpen}
                                cart={cart}
                                updateQuantity={updateCartQuantity}
                                removeFromCart={removeFromCart}
                                totalPrice={cartTotal}
                                totalItems={totalItems}
                                onClose={() => setIsCartOpen(false)}
                                showToast={showToast}
                                setLastOrder={setLastOrder}
                                setCart={setCart}
                                refreshProducts={fetchProducts}
                            />
                        </>
                    )}
                    
                    {/* 订单成功模态框 */}
                    {lastOrder && (
                        <OrderSuccessModal
                            order={lastOrder}
                            onNewOrder={() => {
                                setLastOrder(null);
                                fetchProducts();
                            }}
                        />
                    )}
                    
                    {/* Toast 通知 */}
                    {toast && (
                        <Toast {...toast} onDismiss={() => setToast(null)} />
                    )}
                </div>
            );
        };
        
        // 📦 产品卡片组件
        const ProductCard = ({ product, onAddToCart }) => {
            const isOutOfStock = !product.is_unlimited && product.stock === 0;
            const isLowStock = !product.is_unlimited && product.stock > 0 && product.stock <= product.minStock;
            
            return (
                <div className={`product-card ${isOutOfStock ? 'opacity-60' : ''}`}>
                    {/* 产品徽章 */}
                    {product.is_unlimited && (
                        <div className="product-badge product-badge--presale">
                            <i className="fas fa-infinity mr-1"></i>预购
                        </div>
                    )}
                    {isLowStock && !isOutOfStock && (
                        <div className="product-badge product-badge--low-stock">
                            <i className="fas fa-exclamation-triangle mr-1"></i>低库存
                        </div>
                    )}
                    
                    {/* 产品图片 */}
                    <div className="relative">
                        {product.image ? (
                            <img 
                                src={product.image} 
                                alt={product.name}
                                className="product-image"
                                onError={(e) => {
                                    e.target.style.display = 'none';
                                    e.target.nextSibling.style.display = 'flex';
                                }}
                            />
                        ) : null}
                        <div 
                            className="product-image flex items-center justify-center text-6xl"
                            style={{ display: product.image ? 'none' : 'flex' }}
                        >
                            {product.emoji || '🍽️'}
                        </div>
                        
                        {/* 缺货覆盖层 */}
                        {isOutOfStock && (
                            <div 
                                className="absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center"
                                style={{ 
                                    position: 'absolute',
                                    top: 0,
                                    left: 0,
                                    right: 0,
                                    bottom: 0,
                                    background: 'rgba(0, 0, 0, 0.6)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center'
                                }}
                            >
                                <div className="text-center text-white">
                                    <i className="fas fa-times-circle text-3xl mb-2"></i>
                                    <div className="font-bold">已售完</div>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* 产品信息 */}
                    <div className="product-info">
                        <h3 className="product-name">{product.name}</h3>
                        
                        <div className="flex items-center justify-between mb-3">
                            <span className="product-price">RM{Number(product.price).toFixed(2)}</span>
                            <span className={`stock-badge ${
                                product.is_unlimited ? 'stock-badge--in-stock' : 
                                isOutOfStock ? 'stock-badge--out-of-stock' :
                                isLowStock ? 'stock-badge--low-stock' : 'stock-badge--in-stock'
                            }`}>
                                {product.is_unlimited ? '充足' : `库存: ${product.stock}`}
                            </span>
                        </div>
                        
                        <div className="flex justify-between items-center">
                            <div className="text-sm text-gray-600">
                                {product.is_unlimited ? '预购商品' : '现货商品'}
                                {product.category && (
                                    <span className="ml-2 px-2 py-1 bg-gray-100 rounded text-xs">
                                        {product.category}
                                    </span>
                                )}
                            </div>
                            <button
                                onClick={() => onAddToCart(product)}
                                disabled={isOutOfStock}
                                className={`btn ${isOutOfStock ? 'btn--secondary' : 'btn--primary'}`}
                                style={{ opacity: isOutOfStock ? 0.5 : 1 }}
                            >
                                <i className={`fas ${isOutOfStock ? 'fa-times' : 'fa-cart-plus'} mr-1`}></i>
                                {isOutOfStock ? '售罄' : '添加'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 🛒 购物车侧边栏
        const CartSidebar = ({ 
            isOpen, cart, updateQuantity, removeFromCart, 
            totalPrice, totalItems, onClose, showToast,
            setLastOrder, setCart, refreshProducts 
        }) => {
            const [isCheckoutOpen, setIsCheckoutOpen] = useState(false);
            
            const handleCheckout = () => {
                if (cart.length === 0) {
                    showToast('购物车为空', 'error');
                    return;
                }
                onClose();
                setIsCheckoutOpen(true);
            };
            
            return (
                <>
                    <div className={`cart-sidebar ${isOpen ? 'open' : ''}`}>
                        {/* 头部 */}
                        <header className="p-5 border-b border-border flex justify-between items-center">
                            <h2 className="text-xl font-bold">购物车</h2>
                            <button 
                                onClick={onClose}
                                className="text-gray-500 hover:text-gray-800 p-2"
                            >
                                <i className="fas fa-times text-2xl"></i>
                            </button>
                        </header>
                        
                        {/* 内容 */}
                        <div className="flex-1 overflow-y-auto p-5">
                            {cart.length === 0 ? (
                                <div className="empty-state">
                                    <div className="empty-state-icon">🛒</div>
                                    <p>购物车为空</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {cart.map(item => (
                                        <CartItem 
                                            key={item.id}
                                            item={item}
                                            updateQuantity={updateQuantity}
                                            removeFromCart={removeFromCart}
                                        />
                                    ))}
                                </div>
                            )}
                        </div>
                        
                        {/* 底部 */}
                        {cart.length > 0 && (
                            <footer className="border-t border-border p-5">
                                <div className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <span className="text-gray-600">商品总数:</span>
                                        <span className="font-medium">{totalItems} 件</span>
                                    </div>
                                    <div className="flex justify-between items-center text-lg">
                                        <span className="font-medium">总计:</span>
                                        <span className="text-2xl font-bold text-primary">
                                            RM{totalPrice.toFixed(2)}
                                        </span>
                                    </div>
                                    <button
                                        onClick={handleCheckout}
                                        className="btn btn--primary"
                                        style={{ width: '100%', padding: '1rem' }}
                                    >
                                        <i className="fas fa-credit-card mr-2"></i>
                                        立即结账
                                    </button>
                                </div>
                            </footer>
                        )}
                    </div>
                    
                    {/* 结账模态框 */}
                    {isCheckoutOpen && (
                        <CheckoutModal
                            cart={cart}
                            total={totalPrice}
                            onClose={() => setIsCheckoutOpen(false)}
                            showToast={showToast}
                            setLastOrder={setLastOrder}
                            setCart={setCart}
                            refreshProducts={refreshProducts}
                        />
                    )}
                </>
            );
        };
        
        // 🛒 购物车商品项
        const CartItem = ({ item, updateQuantity, removeFromCart }) => {
            return (
                <div className="bg-white rounded-lg p-4 shadow-sm border border-border">
                    <div className="flex items-center gap-4">
                        <div className="text-3xl flex-shrink-0">
                            {item.emoji || '🍽️'}
                        </div>
                        <div className="flex-1 min-w-0">
                            <h3 className="font-medium text-gray-800 truncate">{item.name}</h3>
                            <div className="flex items-center gap-2">
                                <span className="text-primary font-bold">
                                    RM{Number(item.price).toFixed(2)}
                                </span>
                                <span className="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">
                                    {item.is_unlimited ? '预购' : '现货'}
                                </span>
                                {!item.is_unlimited && (
                                    <span className="text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded">
                                        库存: {item.stock}
                                    </span>
                                )}
                            </div>
                        </div>
                        <div className="flex flex-col items-end gap-2">
                            <div className="flex items-center gap-2">
                                <button
                                    onClick={() => updateQuantity(item.id, item.quantity - 1)}
                                    className="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600"
                                >
                                    <i className="fas fa-minus text-xs"></i>
                                </button>
                                <span className="w-8 text-center font-medium">{item.quantity}</span>
                                <button
                                    onClick={() => updateQuantity(item.id, item.quantity + 1)}
                                    disabled={!item.is_unlimited && item.quantity >= item.stock}
                                    className={`w-8 h-8 rounded-full flex items-center justify-center text-xs ${
                                        !item.is_unlimited && item.quantity >= item.stock
                                            ? 'bg-gray-200 text-gray-400 cursor-not-allowed'
                                            : 'bg-gray-100 hover:bg-gray-200 text-gray-600'
                                    }`}
                                >
                                    <i className="fas fa-plus"></i>
                                </button>
                            </div>
                            <button
                                onClick={() => removeFromCart(item.id)}
                                className="text-xs text-gray-400 hover:text-red-500 transition-colors"
                            >
                                <i className="fas fa-trash mr-1"></i>删除
                            </button>
                        </div>
                    </div>
                    <div className="mt-2 pt-2 border-t border-gray-100">
                        <div className="flex justify-between items-center text-sm">
                            <span className="text-gray-500">小计</span>
                            <span className="font-bold text-gray-800">
                                RM{(item.quantity * item.price).toFixed(2)}
                            </span>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 💳 结账模态框 - 包含取货地址和配送表单
        const CheckoutModal = ({ cart, total, onClose, showToast, setLastOrder, setCart, refreshProducts }) => {
            const [formData, setFormData] = useState({
                name: '',
                phone: '',
                delivery: '',
                address: '',
                remarks: '',
                paymentMethod: ''
            });
            const [loading, setLoading] = useState(false);
            
            // 取货地址选项
            const pickupLocations = [
                { id: 'location1', name: ' 总店 - 吉隆坡武吉加里尔', address: '123 Jalan Bukit Jalil, 57000 Kuala Lumpur' },
                { id: 'location2', name: '分店 - 蒲种', address: '456 Jalan Puchong, 47100 Puchong, Selangor' },
                { id: 'location3', name: '分店 - 八打灵再也', address: '789 Jalan PJ, 46200 Petaling Jaya, Selangor' }
            ];
            
            // 支付二维码数据
            const paymentQRCodes = {
                'Maybank QR': {
                    qrCode: 'https://edfnhhthztskuuosuasw.supabase.co/storage/v1/object/public/qr-codes/maybank-qr.jpg',
                    bankDetails: {
                        bank: 'Maybank',
                        accountName: '锋味派美食',
                        accountNumber: '1234567890',
                        note: '转账后请截图作为支付凭证'
                    }
                },
                'TNG eWallet': {
                    qrCode: 'https://edfnhhthztskuuosuasw.supabase.co/storage/v1/object/public/qr-codes/tng-qr.jpg'
                }
            };
            
            const handleSubmit = async (e) => {
                e.preventDefault();
                setLoading(true);
                
                try {
                    // 生成订单
                    const orderId = await generateOrderId();
                    const orderData = {
                        order_id: orderId,
                        name: formData.name,
                        phone: formData.phone,
                        delivery_method: formData.delivery,
                        delivery_address: formData.address,
                        remarks: formData.remarks,
                        payment_method: formData.paymentMethod,
                        total_amount: total,
                        status: 'pending',
                        order_items: cart.map(item => ({
                            product: item.name,
                            quantity: item.quantity,
                            price: item.price,
                            emoji: item.emoji,
                            is_unlimited: item.is_unlimited
                        })),
                        created_at: new Date().toISOString()
                    };
                    
                    const { data: order, error } = await supabase
                        .from('orders')
                        .insert([orderData])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    
                    // 更新库存
                    for (const item of cart) {
                        if (!item.is_unlimited) {
                            const newStock = Math.max(0, item.stock - item.quantity);
                            await supabase
                                .from('products')
                                .update({ stock_quantity: newStock })
                                .eq('id', item.id);
                        }
                    }
                    
                    showToast('订单提交成功！', 'success');
                    setLastOrder(order);
                    setCart([]);
                    onClose();
                    refreshProducts();
                } catch (error) {
                    console.error('订单提交失败:', error);
                    showToast('订单提交失败: ' + error.message, 'error');
                } finally {
                    setLoading(false);
                }
            };
            
            return (
                <div className="modal active">
                    <div className="modal-content">
                        <div className="modal-header">
                            <h2 className="text-xl font-bold">结账</h2>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-800">
                                <i className="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div className="modal-body">
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="form-group">
                                    <label className="form-label">姓名 *</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.name}
                                        onChange={(e) => setFormData({...formData, name: e.target.value})}
                                        required
                                        placeholder="请输入您的姓名"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">电话号码 *</label>
                                    <input
                                        type="tel"
                                        className="form-control"
                                        value={formData.phone}
                                        onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                        required
                                        placeholder="例如: 0123456789"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">取货方式 *</label>
                                    <select
                                        className="form-control"
                                        value={formData.delivery}
                                        onChange={(e) => setFormData({...formData, delivery: e.target.value})}
                                        required
                                    >
                                        <option value="">请选择取货方式</option>
                                        <option value="self-pickup">自取</option>
                                        <option value="lalamove">Lalamove送货</option>
                                    </select>
                                </div>
                                
                                {/* 显示取货地址选择 */}
                                {formData.delivery === 'self-pickup' && (
                                    <div className="form-group">
                                        <label className="form-label">选择取货地点 *</label>
                                        <div className="space-y-2">
                                            {pickupLocations.map(location => (
                                                <div key={location.id} className="border border-gray-200 rounded-lg p-3 hover:bg-gray-50">
                                                    <label className="flex items-start gap-3 cursor-pointer">
                                                        <input
                                                            type="radio"
                                                            name="pickupLocation"
                                                            value={location.id}
                                                            onChange={(e) => setFormData({...formData, address: location.address})}
                                                            className="mt-1"
                                                            required
                                                        />
                                                        <div>
                                                            <div className="font-medium text-gray-900">{location.name}</div>
                                                            <div className="text-sm text-gray-600">{location.address}</div>
                                                        </div>
                                                    </label>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {/* 显示配送地址输入 */}
                                {formData.delivery === 'lalamove' && (
                                    <div className="form-group">
                                        <label className="form-label">配送地址 *</label>
                                        <textarea
                                            className="form-control"
                                            value={formData.address}
                                            onChange={(e) => setFormData({...formData, address: e.target.value})}
                                            required
                                            rows="3"
                                            placeholder="请输入完整的配送地址（包括门牌号、街道、城市、邮政编码）"
                                        />
                                        <div className="text-sm text-gray-500 mt-1">
                                            💡 配送费用将根据距离计算，我们会在确认订单后联系您
                                        </div>
                                    </div>
                                )}
                                <div className="form-group">
                                    <label className="form-label">付款方式 *</label>
                                    <div className="space-y-3">
                                        {Object.keys(paymentQRCodes).map(method => (
                                            <div key={method} className="border border-gray-200 rounded-lg p-3 hover:bg-gray-50">
                                                <label className="flex items-center gap-3 cursor-pointer">
                                                    <input
                                                        type="radio"
                                                        name="paymentMethod"
                                                        value={method}
                                                        onChange={(e) => setFormData({...formData, paymentMethod: e.target.value})}
                                                        required
                                                    />
                                                    <div className="flex-1">
                                                        <div className="font-medium">{method}</div>
                                                    </div>
                                                </label>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                
                                {/* 显示支付二维码和银行资料 */}
                                {formData.paymentMethod && (
                                    <div className="form-group">
                                        <div className="border border-gray-200 rounded-lg p-4 bg-blue-50">
                                            <h3 className="font-medium mb-3 text-center">{formData.paymentMethod} 支付信息</h3>
                                            
                                            {/* QR码 */}
                                            <div className="text-center mb-4">
                                                <img 
                                                    src={paymentQRCodes[formData.paymentMethod].qrCode}
                                                    alt={`${formData.paymentMethod} QR Code`}
                                                    className="mx-auto border border-gray-300 rounded-lg"
                                                    style={{ width: '200px', height: '200px', objectFit: 'contain' }}
                                                    onError={(e) => {
                                                        e.target.style.display = 'none';
                                                        e.target.nextSibling.style.display = 'block';
                                                    }}
                                                />
                                                <div className="hidden text-center text-gray-500 py-8">
                                                    二维码加载中...
                                                </div>
                                            </div>
                                            
                                            {/* Maybank 银行转账资料 */}
                                            {formData.paymentMethod === 'Maybank QR' && paymentQRCodes[formData.paymentMethod].bankDetails && (
                                                <div className="bg-white rounded-lg p-3 space-y-2">
                                                    <h4 className="font-medium text-center text-gray-800 mb-2">📱 银行转账资料</h4>
                                                    <div className="text-sm space-y-1">
                                                        <div><span className="font-medium">银行:</span> {paymentQRCodes[formData.paymentMethod].bankDetails.bank}</div>
                                                        <div><span className="font-medium">户名:</span> {paymentQRCodes[formData.paymentMethod].bankDetails.accountName}</div>
                                                        <div><span className="font-medium">账号:</span> {paymentQRCodes[formData.paymentMethod].bankDetails.accountNumber}</div>
                                                        <div className="text-orange-600 font-medium mt-2">
                                                            ⚠️ {paymentQRCodes[formData.paymentMethod].bankDetails.note}
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                            
                                            <div className="text-center text-sm text-gray-600 mt-3">
                                                扫描二维码或使用银行资料完成付款
                                            </div>
                                        </div>
                                    </div>
                                )}
                                <div className="form-group">
                                    <label className="form-label">备注</label>
                                    <textarea
                                        className="form-control"
                                        value={formData.remarks}
                                        onChange={(e) => setFormData({...formData, remarks: e.target.value})}
                                        rows="3"
                                        placeholder="如有特殊要求，请在此说明"
                                    />
                                </div>
                            </form>
                        </div>
                        <div className="modal-footer">
                            <div className="w-full">
                                <div className="flex justify-between items-center mb-4">
                                    <span className="text-lg font-medium">订单总计:</span>
                                    <span className="text-2xl font-bold text-primary">
                                        RM{total.toFixed(2)}
                                    </span>
                                </div>
                                <button
                                    onClick={handleSubmit}
                                    disabled={loading}
                                    className="btn btn--primary"
                                    style={{ width: '100%', padding: '0.75rem' }}
                                >
                                    {loading ? (
                                        <>
                                            <span className="loading mr-2"></span>
                                            提交中...
                                        </>
                                    ) : (
                                        <>
                                            <i className="fas fa-check mr-2"></i>
                                            确认订单
                                        </>
                                    )}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 🎉 订单成功模态框
        const OrderSuccessModal = ({ order, onNewOrder }) => {
            const whatsappMsg = buildOrderMessage(order);
            const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(whatsappMsg)}`;
            
            const handleCopy = async () => {
                const success = await copyTextUniversal(whatsappMsg);
                alert(success ? '订单信息已复制到剪贴板' : '复制失败，请长按选择手动复制');
            };
            
            const handleSendWhatsApp = () => {
                window.location.href = whatsappUrl;
                setTimeout(() => onNewOrder(), 1000);
            };
            
            return (
                <div className="modal active">
                    <div className="modal-content">
                        <div className="modal-body text-center">
                            <div className="text-6xl mb-4">🎉</div>
                            <h2 className="text-2xl font-bold mb-4 text-success">订单提交成功!</h2>
                            <div className="bg-gray-50 p-4 rounded-lg mb-4 text-left text-sm max-h-40 overflow-y-auto">
                                <pre className="whitespace-pre-wrap text-xs">{whatsappMsg}</pre>
                            </div>
                            <p className="text-gray-600 mb-4">
                                请点击"发送到WhatsApp"将订单信息发送给我们，或先"复制订单"手动发送。
                            </p>
                            <div className="space-y-3">
                                <button 
                                    onClick={handleSendWhatsApp}
                                    className="btn btn--success"
                                    style={{ width: '100%', padding: '0.75rem' }}
                                >
                                    <i className="fab fa-whatsapp mr-2"></i>
                                    发送到WhatsApp
                                </button>
                                <button 
                                    onClick={handleCopy}
                                    className="btn btn--secondary"
                                    style={{ width: '100%', padding: '0.75rem' }}
                                >
                                    <i className="fas fa-copy mr-2"></i>
                                    复制订单信息
                                </button>
                                <button 
                                    onClick={onNewOrder}
                                    className="btn btn--primary"
                                    style={{ width: '100%', padding: '0.75rem' }}
                                >
                                    <i className="fas fa-shopping-cart mr-2"></i>
                                    继续购物
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 🎯 主应用组件
        const App = () => {
            const [currentView, setCurrentView] = useState('customer');
            const [user, setUser] = useState(null);
            
            const handleLogin = (userData) => {
                setUser(userData);
                setCurrentView('admin');
            };
            
            const handleLogout = () => {
                setUser(null);
                setCurrentView('customer');
            };
            
            const handleAdminClick = () => {
                setCurrentView('login');
            };
            
            // 根据当前视图渲染对应组件
            switch (currentView) {
                case 'login':
                    return <LoginScreen onLogin={handleLogin} />;
                case 'admin':
                    return <AdminLayout user={user} onLogout={handleLogout} />;
                case 'customer':
                default:
                    return <CustomerView onAdminClick={handleAdminClick} />;
            }
        };
        
        // 🔧 完整管理后台布局
        const AdminLayout = ({ user, onLogout }) => {
            const [activeView, setActiveView] = useState('dashboard');
            const [sidebarOpen, setSidebarOpen] = useState(false);
            
            // 管理后台菜单项
            const adminMenuItems = [
                { id: 'dashboard', icon: 'chart-line', title: '仪表盘', component: Dashboard },
                { id: 'products', icon: 'pizza-slice', title: '产品管理', component: ProductsManager },
                { id: 'inventory', icon: 'boxes', title: '库存管理', component: InventoryManager },
                { id: 'orders', icon: 'list', title: '订单管理', component: OrdersManager },
                { id: 'analytics', icon: 'chart-pie', title: '数据分析', component: Analytics },
                { id: 'scanner', icon: 'qrcode', title: '扫码功能', component: Scanner },
                { id: 'camera', icon: 'camera', title: '拍照功能', component: Camera }
            ];
            
            // 如果启用会员系统，添加会员管理
            if (window.MEMBER_CONFIG.ENABLE_MEMBER_BACKEND) {
                adminMenuItems.splice(4, 0, {
                    id: 'members', icon: 'users', title: '会员管理', component: MembersManager
                });
            }
            
            const currentComponent = adminMenuItems.find(item => item.id === activeView)?.component || Dashboard;
            
            return (
                <div className="admin-layout">
                    {/* 移动端侧边栏覆盖层 */}
                    {sidebarOpen && (
                        <div
                            className="fixed inset-0 bg-black bg-opacity-50 z-40 md:hidden"
                            onClick={() => setSidebarOpen(false)}
                        />
                    )}
                    
                    {/* 侧边栏 */}
                    <aside className={`admin-sidebar fixed md:static top-0 left-0 h-full z-50 transform transition-transform duration-300 ease-in-out ${
                        sidebarOpen ? 'translate-x-0' : '-translate-x-full'
                    } md:translate-x-0`}>
                        {/* 移动端侧边栏头部 */}
                        <div className="flex justify-between items-center p-4 md:hidden border-b border-border">
                            <span className="font-bold text-gray-800">管理菜单</span>
                            <button 
                                onClick={() => setSidebarOpen(false)}
                                className="p-2 rounded-lg text-gray-600 hover:bg-gray-100"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        {/* 导航菜单 */}
                        <nav className="admin-nav">
                            {adminMenuItems.map(item => (
                                <div
                                    key={item.id}
                                    className={`admin-nav-item ${activeView === item.id ? 'active' : ''}`}
                                    onClick={() => {
                                        setActiveView(item.id);
                                        setSidebarOpen(false);
                                    }}
                                >
                                    <i className={`fas fa-${item.icon} admin-nav-icon`}></i>
                                    <span>{item.title}</span>
                                </div>
                            ))}
                        </nav>
                    </aside>
                    
                    {/* 主要内容区域 */}
                    <div className="flex-1 flex flex-col">
                        {/* 头部 */}
                        <header className="bg-surface border-b border-border px-6 py-4">
                            <div className="flex justify-between items-center">
                                <div className="flex items-center gap-3">
                                    {/* 移动端菜单按钮 */}
                                    <button 
                                        onClick={() => setSidebarOpen(true)} 
                                        className="md:hidden p-2 rounded-lg text-gray-600 hover:bg-gray-100"
                                    >
                                        <i className="fas fa-bars text-xl"></i>
                                    </button>
                                    <span className="text-2xl">🍽️</span>
                                    <h1 className="text-xl font-bold">锋味派管理后台</h1>
                                </div>
                                <div className="flex items-center gap-4">
                                    <button 
                                        onClick={() => window.location.reload()} 
                                        className="btn btn--secondary btn-sm"
                                    >
                                        <i className="fas fa-store mr-2"></i>返回客户端
                                    </button>
                                    <span className="text-sm text-gray-500 hidden sm:inline">
                                        管理员
                                    </span>
                                    <button 
                                        onClick={onLogout} 
                                        className="btn btn--secondary btn-sm"
                                    >
                                        <i className="fas fa-sign-out-alt mr-2"></i>退出
                                    </button>
                                </div>
                            </div>
                        </header>
                        
                        {/* 内容区 */}
                        <main className="admin-content">
                            {React.createElement(currentComponent, { setActiveView })}
                        </main>
                    </div>
                </div>
            );
        };
        
        // 📊 仪表盘组件
        const Dashboard = ({ setActiveView }) => {
            const [stats, setStats] = useState({
                todaySales: 0,
                monthSales: 0,
                todayOrders: 0,
                pendingOrders: 0,
                totalProducts: 0,
                lowStockProducts: 0,
                totalMembers: 0,
                outOfStockProducts: 0
            });
            const [presaleStats, setPresaleStats] = useState({
                totalBoxes: 0,
                completedGroups: 0,
                remainingBoxes: 0
            });
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                const fetchStats = async () => {
                    try {
                        // 获取今日和本月数据
                        const today = new Date().toISOString().slice(0, 10);
                        const monthStart = new Date();
                        monthStart.setDate(1);
                        
                        const [ordersResult, productsResult, membersResult] = await Promise.all([
                            supabase.from('orders').select('*').order('created_at', { ascending: false }),
                            supabase.from('products').select('*'),
                            window.MEMBER_CONFIG.ENABLE_MEMBER_SYSTEM ? 
                                supabase.from('members').select('*') : 
                                Promise.resolve({ data: [] })
                        ]);
                        
                        const orders = ordersResult.data || [];
                        const products = productsResult.data || [];
                        const members = membersResult.data || [];
                        
                        // 计算今日订单
                        const todayOrders = orders.filter(o => 
                            o.created_at && o.created_at.startsWith(today)
                        );
                        
                        // 计算本月订单
                        const monthOrders = orders.filter(o => 
                            o.created_at && o.created_at >= monthStart.toISOString()
                        );
                        
                        // 计算待处理订单
                        const pendingOrders = orders.filter(o => o.status === 'pending');
                        
                        // 计算库存统计
                        const lowStockProducts = products.filter(p => 
                            !p.is_unlimited && (p.stock_quantity || 0) <= (p.min_stock_threshold || 5)
                        );
                        
                        const outOfStockProducts = products.filter(p => 
                            !p.is_unlimited && (p.stock_quantity || 0) === 0
                        );
                        
                        // 计算预售统计
                        let totalPresaleBoxes = 0;
                        orders.forEach(order => {
                            (order.order_items || []).forEach(item => {
                                if (item.product && !item.product.includes('运费')) {
                                    const product = products.find(p => p.name === item.product);
                                    if (product && product.is_unlimited) {
                                        totalPresaleBoxes += item.quantity || 0;
                                    }
                                }
                            });
                        });
                        
                        const completedGroups = Math.floor(totalPresaleBoxes / 200);
                        const remainingBoxes = 200 - (totalPresaleBoxes % 200);
                        
                        setStats({
                            todaySales: todayOrders.reduce((sum, o) => sum + Number(o.total_amount || 0), 0),
                            monthSales: monthOrders.reduce((sum, o) => sum + Number(o.total_amount || 0), 0),
                            todayOrders: todayOrders.length,
                            pendingOrders: pendingOrders.length,
                            totalProducts: products.filter(p => p.is_published).length,
                            lowStockProducts: lowStockProducts.length,
                            totalMembers: members.length,
                            outOfStockProducts: outOfStockProducts.length
                        });
                        
                        setPresaleStats({
                            totalBoxes: totalPresaleBoxes,
                            completedGroups,
                            remainingBoxes: remainingBoxes === 200 ? 0 : remainingBoxes
                        });
                    } catch (error) {
                        console.error('获取统计数据失败:', error);
                    } finally {
                        setLoading(false);
                    }
                };
                
                fetchStats();
            }, []);
            
            if (loading) {
                return <LoadingSpinner text="加载仪表盘数据..." />;
            }
            
            return (
                <div className="space-y-6">
                    <div className="page-header">
                        <div>
                            <h2 className="page-title">📊 仪表盘</h2>
                            <p className="page-subtitle">系统概览和关键指标</p>
                        </div>
                    </div>
                    
                    {/* 预售成团统计 */}
                    <div className="card" style={{
                        background: 'linear-gradient(135deg, #ec4899, #f43f5e)',
                        color: 'white'
                    }}>
                        <div className="card__body">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                    <span className="text-2xl">👥</span>
                                    <h3 className="text-xl font-bold">预售成团统计</h3>
                                </div>
                                <div className="text-sm bg-white bg-opacity-20 px-3 py-1 rounded-full">
                                    每200盒成团
                                </div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div className="bg-white bg-opacity-10 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-sm font-medium opacity-90">已成团数</p>
                                            <p className="text-2xl font-bold">{presaleStats.completedGroups}团</p>
                                        </div>
                                        <i className="fas fa-check-circle text-2xl opacity-80"></i>
                                    </div>
                                </div>
                                <div className="bg-white bg-opacity-10 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-sm font-medium opacity-90">总售出数量</p>
                                            <p className="text-2xl font-bold">{presaleStats.totalBoxes}盒</p>
                                        </div>
                                        <i className="fas fa-box text-2xl opacity-80"></i>
                                    </div>
                                </div>
                                <div className="bg-white bg-opacity-10 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-sm font-medium opacity-90">下一团还需</p>
                                            <p className="text-2xl font-bold">{presaleStats.remainingBoxes}盒</p>
                                        </div>
                                        <i className="fas fa-hourglass-half text-2xl opacity-80"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* 关键指标 */}
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#16a34a' }}>
                                <i className="fas fa-chart-line"></i>
                            </div>
                            <div className="stat-content">
                                <h3>今日销售额</h3>
                                <p className="stat-value" style={{ color: '#16a34a' }}>
                                    RM{stats.todaySales.toFixed(2)}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#2563eb' }}>
                                <i className="fas fa-calendar-alt"></i>
                            </div>
                            <div className="stat-content">
                                <h3>本月销售额</h3>
                                <p className="stat-value" style={{ color: '#2563eb' }}>
                                    RM{stats.monthSales.toFixed(2)}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#8b5cf6' }}>
                                <i className="fas fa-shopping-cart"></i>
                            </div>
                            <div className="stat-content">
                                <h3>今日订单</h3>
                                <p className="stat-value" style={{ color: '#8b5cf6' }}>
                                    {stats.todayOrders}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card" style={{ cursor: 'pointer' }} 
                             onClick={() => setActiveView('orders')}>
                            <div className="stat-icon" style={{ color: '#f59e0b' }}>
                                <i className="fas fa-clock"></i>
                            </div>
                            <div className="stat-content">
                                <h3>待处理订单</h3>
                                <p className="stat-value" style={{ color: '#f59e0b' }}>
                                    {stats.pendingOrders}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card" style={{ cursor: 'pointer' }} 
                             onClick={() => setActiveView('products')}>
                            <div className="stat-icon" style={{ color: '#06b6d4' }}>
                                <i className="fas fa-store"></i>
                            </div>
                            <div className="stat-content">
                                <h3>上架商品</h3>
                                <p className="stat-value" style={{ color: '#06b6d4' }}>
                                    {stats.totalProducts}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card" style={{ cursor: 'pointer' }} 
                             onClick={() => setActiveView('inventory')}>
                            <div className="stat-icon" style={{ color: '#ef4444' }}>
                                <i className="fas fa-exclamation-triangle"></i>
                            </div>
                            <div className="stat-content">
                                <h3>缺货商品</h3>
                                <p className="stat-value" style={{ color: '#ef4444' }}>
                                    {stats.outOfStockProducts}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card" style={{ cursor: 'pointer' }} 
                             onClick={() => setActiveView('inventory')}>
                            <div className="stat-icon" style={{ color: '#f59e0b' }}>
                                <i className="fas fa-battery-quarter"></i>
                            </div>
                            <div className="stat-content">
                                <h3>低库存商品</h3>
                                <p className="stat-value" style={{ color: '#f59e0b' }}>
                                    {stats.lowStockProducts}
                                </p>
                            </div>
                        </div>
                        
                        {window.MEMBER_CONFIG.ENABLE_MEMBER_SYSTEM && (
                            <div className="stat-card" style={{ cursor: 'pointer' }} 
                                 onClick={() => setActiveView('members')}>
                                <div className="stat-icon" style={{ color: '#8b5cf6' }}>
                                    <i className="fas fa-users"></i>
                                </div>
                                <div className="stat-content">
                                    <h3>注册会员</h3>
                                    <p className="stat-value" style={{ color: '#8b5cf6' }}>
                                        {stats.totalMembers}
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* 快捷操作 */}
                    <div className="card">
                        <div className="card__body">
                            <h3 className="text-lg font-semibold mb-4">快捷操作</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <button 
                                    onClick={() => setActiveView('orders')} 
                                    className="flex flex-col items-center p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors"
                                >
                                    <i className="fas fa-list text-2xl text-blue-600 mb-2"></i>
                                    <span className="text-sm font-medium text-blue-700">查看订单</span>
                                </button>
                                
                                <button 
                                    onClick={() => setActiveView('products')} 
                                    className="flex flex-col items-center p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors"
                                >
                                    <i className="fas fa-pizza-slice text-2xl text-green-600 mb-2"></i>
                                    <span className="text-sm font-medium text-green-700">管理商品</span>
                                </button>
                                
                                <button 
                                    onClick={() => setActiveView('inventory')} 
                                    className="flex flex-col items-center p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors"
                                >
                                    <i className="fas fa-boxes text-2xl text-purple-600 mb-2"></i>
                                    <span className="text-sm font-medium text-purple-700">库存管理</span>
                                </button>
                                
                                <button 
                                    onClick={() => setActiveView('analytics')} 
                                    className="flex flex-col items-center p-4 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors"
                                >
                                    <i className="fas fa-chart-pie text-2xl text-orange-600 mb-2"></i>
                                    <span className="text-sm font-medium text-orange-700">数据分析</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 📦 完整产品管理组件
        const ProductsManager = () => {
            const [products, setProducts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [categoryFilter, setCategoryFilter] = useState('');
            const [editingProduct, setEditingProduct] = useState(null);
            const [showAddForm, setShowAddForm] = useState(false);
            const [toast, setToast] = useState(null);
            
            const showToast = (message, type = 'success') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 3000);
            };
            
            const fetchProducts = useCallback(async () => {
                setLoading(true);
                try {
                    const { data, error } = await supabase
                        .from('products')
                        .select('*')
                        .order('id');
                    
                    if (error) throw error;
                    setProducts(data || []);
                } catch (error) {
                    console.error('加载产品失败:', error);
                    showToast('加载产品失败: ' + error.message, 'error');
                } finally {
                    setLoading(false);
                }
            }, []);
            
            useEffect(() => {
                fetchProducts();
            }, [fetchProducts]);
            
            // 过滤产品
            const filteredProducts = useMemo(() => {
                return products.filter(product => {
                    const matchesSearch = !searchTerm || 
                        product.name.toLowerCase().includes(searchTerm.toLowerCase());
                    const matchesCategory = !categoryFilter || 
                        product.category === categoryFilter;
                    return matchesSearch && matchesCategory;
                });
            }, [products, searchTerm, categoryFilter]);
            
            // 获取所有分类
            const categories = useMemo(() => {
                return [...new Set(products.map(p => p.category).filter(Boolean))];
            }, [products]);
            
            // 删除产品
            const handleDelete = async (id) => {
                if (!confirm('确定要删除这个产品吗？')) return;
                
                try {
                    const { error } = await supabase
                        .from('products')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    showToast('产品删除成功', 'success');
                    fetchProducts();
                } catch (error) {
                    console.error('删除产品失败:', error);
                    showToast('删除产品失败: ' + error.message, 'error');
                }
            };
            
            // 切换产品状态
            const toggleProductStatus = async (product, field) => {
                try {
                    const { error } = await supabase
                        .from('products')
                        .update({ [field]: !product[field] })
                        .eq('id', product.id);
                    
                    if (error) throw error;
                    showToast(`产品${field === 'is_published' ? '发布状态' : '状态'}已更新`, 'success');
                    fetchProducts();
                } catch (error) {
                    console.error('更新产品状态失败:', error);
                    showToast('更新状态失败: ' + error.message, 'error');
                }
            };
            
            if (loading) {
                return <LoadingSpinner text="加载产品数据..." />;
            }
            
            return (
                <div className="space-y-6">
                    <div className="page-header">
                        <div>
                            <h2 className="page-title">📦 产品管理</h2>
                            <p className="page-subtitle">管理商品信息、库存和状态 ({products.length})</p>
                        </div>
                        <button
                            onClick={() => setShowAddForm(true)}
                            className="btn btn--primary"
                        >
                            <i className="fas fa-plus mr-2"></i>添加产品
                        </button>
                    </div>
                    
                    {/* 搜索和过滤工具栏 */}
                    <div className="toolbar">
                        <div className="toolbar-left">
                            <div className="flex items-center gap-3">
                                <input
                                    type="text"
                                    placeholder="搜索产品名称..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="form-control"
                                    style={{ minWidth: '200px' }}
                                />
                                <select
                                    value={categoryFilter}
                                    onChange={(e) => setCategoryFilter(e.target.value)}
                                    className="form-control"
                                >
                                    <option value="">全部分类</option>
                                    {categories.map(category => (
                                        <option key={category} value={category}>{category}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        <div className="toolbar-right">
                            <button
                                onClick={fetchProducts}
                                className="btn btn--secondary"
                            >
                                <i className="fas fa-sync-alt mr-2"></i>刷新
                            </button>
                        </div>
                    </div>
                    
                    {/* 产品表格 */}
                    <div className="card">
                        <div className="overflow-x-auto">
                            <table className="data-table">
                                <thead>
                                    <tr>
                                        <th>商品</th>
                                        <th>价格</th>
                                        <th>库存</th>
                                        <th>分类</th>
                                        <th>类型</th>
                                        <th>状态</th>
                                        <th>发布</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredProducts.map(product => (
                                        <tr key={product.id}>
                                            <td>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-2xl">
                                                        {product.emoji || '🍽️'}
                                                    </span>
                                                    <div>
                                                        <div className="font-medium">{product.name}</div>
                                                        {product.image_url && (
                                                            <div className="text-xs text-gray-500">有图片</div>
                                                        )}
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="font-medium text-primary">
                                                RM{Number(product.price || 0).toFixed(2)}
                                            </td>
                                            <td>
                                                {product.is_unlimited ? (
                                                    <span className="status status--success">
                                                        <i className="fas fa-infinity mr-1"></i>无限制
                                                    </span>
                                                ) : (
                                                    <span className={`font-medium ${
                                                        (product.stock_quantity ?? 0) === 0 ? 'text-red-600' :
                                                        (product.stock_quantity ?? 0) <= (product.min_stock_threshold ?? 5) ? 'text-orange-600' :
                                                        'text-green-600'
                                                    }`}>
                                                        {product.stock_quantity ?? 0}
                                                    </span>
                                                )}
                                            </td>
                                            <td>{product.category || '-'}</td>
                                            <td>
                                                <span className={`status ${
                                                    product.is_unlimited ? 'status--info' : 'status--success'
                                                }`}>
                                                    {product.is_unlimited ? '预购' : '现货'}
                                                </span>
                                            </td>
                                            <td>
                                                <label className="toggle-switch">
                                                    <input
                                                        type="checkbox"
                                                        checked={product.status === 'active'}
                                                        onChange={() => toggleProductStatus(product, 'status')}
                                                    />
                                                    <span className="toggle-slider"></span>
                                                </label>
                                            </td>
                                            <td>
                                                <label className="toggle-switch">
                                                    <input
                                                        type="checkbox"
                                                        checked={product.is_published || false}
                                                        onChange={() => toggleProductStatus(product, 'is_published')}
                                                    />
                                                    <span className="toggle-slider"></span>
                                                </label>
                                            </td>
                                            <td>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => setEditingProduct(product)}
                                                        className="btn btn--secondary btn-sm"
                                                    >
                                                        <i className="fas fa-edit"></i>
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(product.id)}
                                                        className="btn btn--danger btn-sm"
                                                    >
                                                        <i className="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            
                            {filteredProducts.length === 0 && (
                                <div className="empty-state">
                                    <div className="empty-state-icon">📦</div>
                                    <p>没有找到符合条件的产品</p>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {/* 编辑产品模态框 */}
                    {editingProduct && (
                        <ProductEditModal
                            product={editingProduct}
                            onSave={async (updatedProduct) => {
                                try {
                                    const { error } = await supabase
                                        .from('products')
                                        .update({
                                            name: updatedProduct.name,
                                            price: Number(updatedProduct.price),
                                            category: updatedProduct.category,
                                            emoji: updatedProduct.emoji,
                                            stock_quantity: updatedProduct.is_unlimited ? null : Number(updatedProduct.stock_quantity || 0),
                                            min_stock_threshold: Number(updatedProduct.min_stock_threshold || 5),
                                            is_unlimited: updatedProduct.is_unlimited,
                                            is_published: updatedProduct.is_published,
                                            status: updatedProduct.status || 'active',
                                            image_url: updatedProduct.image_url || null
                                        })
                                        .eq('id', updatedProduct.id);
                                    
                                    if (error) throw error;
                                    showToast('产品更新成功', 'success');
                                    setEditingProduct(null);
                                    fetchProducts();
                                } catch (error) {
                                    console.error('更新产品失败:', error);
                                    showToast('更新失败: ' + error.message, 'error');
                                }
                            }}
                            onCancel={() => setEditingProduct(null)}
                            showToast={showToast}
                        />
                    )}
                    
                    {/* 添加产品模态框 */}
                    {showAddForm && (
                        <ProductAddModal
                            onSave={async (newProduct) => {
                                try {
                                    const { error } = await supabase
                                        .from('products')
                                        .insert([{
                                            name: newProduct.name,
                                            price: Number(newProduct.price),
                                            category: newProduct.category || null,
                                            emoji: newProduct.emoji || '🍽️',
                                            stock_quantity: newProduct.is_unlimited ? null : Number(newProduct.stock_quantity || 0),
                                            min_stock_threshold: Number(newProduct.min_stock_threshold || 5),
                                            is_unlimited: newProduct.is_unlimited || false,
                                            is_published: newProduct.is_published || false,
                                            status: newProduct.status || 'active',
                                            image_url: newProduct.image_url || null
                                        }]);
                                    
                                    if (error) throw error;
                                    showToast('产品添加成功', 'success');
                                    setShowAddForm(false);
                                    fetchProducts();
                                } catch (error) {
                                    console.error('添加产品失败:', error);
                                    showToast('添加失败: ' + error.message, 'error');
                                }
                            }}
                            onCancel={() => setShowAddForm(false)}
                            showToast={showToast}
                        />
                    )}
                    
                    {/* Toast 通知 */}
                    {toast && <Toast {...toast} onDismiss={() => setToast(null)} />}
                </div>
            );
        };
        
        // 产品编辑模态框
        const ProductEditModal = ({ product, onSave, onCancel, showToast }) => {
            const [formData, setFormData] = useState({ ...product });
            const [uploading, setUploading] = useState(false);
            
            const handleChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };
            
            const handleImageUpload = async (file) => {
                if (!file) return;
                
                setUploading(true);
                try {
                    const ext = file.name.split('.').pop();
                    const filename = `products/${Date.now()}-${Math.random().toString(36).substring(7)}.${ext}`;
                    
                    const { error: uploadError } = await supabase.storage
                        .from('product-photos')
                        .upload(filename, file);
                    
                    if (uploadError) {
                        throw new Error('图片上传失败: ' + uploadError.message);
                    }
                    
                    const { data: { publicUrl } } = supabase.storage
                        .from('product-photos')
                        .getPublicUrl(filename);
                    
                    handleChange('image_url', publicUrl);
                    showToast('图片上传成功', 'success');
                } catch (error) {
                    showToast(error.message, 'error');
                } finally {
                    setUploading(false);
                }
            };
            
            const handleSubmit = () => {
                if (!formData.name || !formData.price) {
                    showToast('请填写商品名称和价格', 'error');
                    return;
                }
                onSave(formData);
            };
            
            return (
                <div className="modal active">
                    <div className="modal-content">
                        <div className="modal-header">
                            <h3 className="text-lg font-bold">编辑产品</h3>
                            <button onClick={onCancel} className="text-gray-500 hover:text-gray-700">
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div className="modal-body space-y-4">
                            <div className="grid md:grid-cols-2 gap-4">
                                <div className="form-group">
                                    <label className="form-label">商品名称 *</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.name || ''}
                                        onChange={(e) => handleChange('name', e.target.value)}
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">表情符号</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.emoji || ''}
                                        onChange={(e) => handleChange('emoji', e.target.value)}
                                        placeholder="🍽️"
                                    />
                                </div>
                            </div>
                            
                            <div className="grid md:grid-cols-2 gap-4">
                                <div className="form-group">
                                    <label className="form-label">价格 (RM) *</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        className="form-control"
                                        value={formData.price || ''}
                                        onChange={(e) => handleChange('price', e.target.value)}
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">分类</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.category || ''}
                                        onChange={(e) => handleChange('category', e.target.value)}
                                    />
                                </div>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">商品图片</label>
                                <div className="flex items-center gap-4">
                                    <input
                                        type="file"
                                        accept="image/*"
                                        onChange={(e) => e.target.files[0] && handleImageUpload(e.target.files[0])}
                                        className="hidden"
                                        id="image-upload-edit"
                                        disabled={uploading}
                                    />
                                    <label
                                        htmlFor="image-upload-edit"
                                        className={`btn btn--secondary ${uploading ? 'opacity-50' : ''}`}
                                    >
                                        {uploading ? '上传中...' : '更换图片'}
                                    </label>
                                    {formData.image_url && (
                                        <img
                                            src={formData.image_url}
                                            alt="商品图片"
                                            className="w-16 h-16 object-cover rounded-lg"
                                        />
                                    )}
                                </div>
                                {formData.image_url && (
                                    <button
                                        onClick={() => handleChange('image_url', '')}
                                        className="text-red-600 text-xs mt-1 hover:underline"
                                    >
                                        删除图片
                                    </button>
                                )}
                            </div>
                            
                            <div className="flex items-center gap-6">
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={formData.is_unlimited || false}
                                        onChange={(e) => handleChange('is_unlimited', e.target.checked)}
                                    />
                                    <span className="text-sm">预购商品（无限库存）</span>
                                </label>
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={formData.is_published || false}
                                        onChange={(e) => handleChange('is_published', e.target.checked)}
                                    />
                                    <span className="text-sm">已上架</span>
                                </label>
                            </div>
                            
                            {!formData.is_unlimited && (
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div className="form-group">
                                        <label className="form-label">当前库存</label>
                                        <input
                                            type="number"
                                            className="form-control"
                                            value={formData.stock_quantity || 0}
                                            onChange={(e) => handleChange('stock_quantity', e.target.value)}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">最低库存提醒</label>
                                        <input
                                            type="number"
                                            className="form-control"
                                            value={formData.min_stock_threshold || 5}
                                            onChange={(e) => handleChange('min_stock_threshold', e.target.value)}
                                        />
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <div className="modal-footer">
                            <button onClick={onCancel} className="btn btn--secondary">
                                取消
                            </button>
                            <button onClick={handleSubmit} className="btn btn--primary">
                                保存
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 产品添加模态框
        const ProductAddModal = ({ onSave, onCancel, showToast }) => {
            const [formData, setFormData] = useState({
                name: '',
                emoji: '🍽️',
                price: '',
                category: '',
                is_unlimited: false,
                is_published: false,
                stock_quantity: 0,
                min_stock_threshold: 5,
                status: 'active',
                image_url: ''
            });
            const [uploading, setUploading] = useState(false);
            
            const handleChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };
            
            const handleImageUpload = async (file) => {
                if (!file) return;
                
                setUploading(true);
                try {
                    const ext = file.name.split('.').pop();
                    const filename = `products/${Date.now()}-${Math.random().toString(36).substring(7)}.${ext}`;
                    
                    const { error: uploadError } = await supabase.storage
                        .from('product-photos')
                        .upload(filename, file);
                    
                    if (uploadError) {
                        throw new Error('图片上传失败: ' + uploadError.message);
                    }
                    
                    const { data: { publicUrl } } = supabase.storage
                        .from('product-photos')
                        .getPublicUrl(filename);
                    
                    handleChange('image_url', publicUrl);
                    showToast('图片上传成功', 'success');
                } catch (error) {
                    showToast(error.message, 'error');
                } finally {
                    setUploading(false);
                }
            };
            
            const handleSubmit = () => {
                if (!formData.name || !formData.price) {
                    showToast('请填写商品名称和价格', 'error');
                    return;
                }
                onSave(formData);
            };
            
            return (
                <div className="modal active">
                    <div className="modal-content">
                        <div className="modal-header">
                            <h3 className="text-lg font-bold">添加新产品</h3>
                            <button onClick={onCancel} className="text-gray-500 hover:text-gray-700">
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div className="modal-body space-y-4">
                            <div className="grid md:grid-cols-2 gap-4">
                                <div className="form-group">
                                    <label className="form-label">商品名称 *</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.name}
                                        onChange={(e) => handleChange('name', e.target.value)}
                                        placeholder="请输入商品名称"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">表情符号</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.emoji}
                                        onChange={(e) => handleChange('emoji', e.target.value)}
                                        placeholder="🍽️"
                                    />
                                </div>
                            </div>
                            
                            <div className="grid md:grid-cols-2 gap-4">
                                <div className="form-group">
                                    <label className="form-label">价格 (RM) *</label>
                                    <input
                                        type="number"
                                        step="0.01"
                                        className="form-control"
                                        value={formData.price}
                                        onChange={(e) => handleChange('price', e.target.value)}
                                        placeholder="0.00"
                                    />
                                </div>
                                <div className="form-group">
                                    <label className="form-label">分类</label>
                                    <input
                                        type="text"
                                        className="form-control"
                                        value={formData.category}
                                        onChange={(e) => handleChange('category', e.target.value)}
                                        placeholder="例如：烤肠系列"
                                    />
                                </div>
                            </div>
                            
                            <div className="form-group">
                                <label className="form-label">商品图片</label>
                                <div className="flex items-center gap-4">
                                    <input
                                        type="file"
                                        accept="image/*"
                                        onChange={(e) => e.target.files[0] && handleImageUpload(e.target.files[0])}
                                        className="hidden"
                                        id="image-upload-add"
                                        disabled={uploading}
                                    />
                                    <label
                                        htmlFor="image-upload-add"
                                        className={`btn btn--success ${uploading ? 'opacity-50' : ''}`}
                                    >
                                        {uploading ? '上传中...' : '选择图片'}
                                    </label>
                                    {formData.image_url && (
                                        <img
                                            src={formData.image_url}
                                            alt="预览"
                                            className="w-16 h-16 object-cover rounded-lg"
                                        />
                                    )}
                                </div>
                                {formData.image_url && (
                                    <button
                                        onClick={() => handleChange('image_url', '')}
                                        className="text-red-600 text-xs mt-1 hover:underline"
                                    >
                                        删除图片
                                    </button>
                                )}
                            </div>
                            
                            <div className="flex items-center gap-6">
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={formData.is_unlimited}
                                        onChange={(e) => handleChange('is_unlimited', e.target.checked)}
                                    />
                                    <span className="text-sm">预购商品（无限库存）</span>
                                </label>
                                <label className="flex items-center gap-2">
                                    <input
                                        type="checkbox"
                                        checked={formData.is_published}
                                        onChange={(e) => handleChange('is_published', e.target.checked)}
                                    />
                                    <span className="text-sm">立即上架</span>
                                </label>
                            </div>
                            
                            {!formData.is_unlimited && (
                                <div className="grid md:grid-cols-2 gap-4">
                                    <div className="form-group">
                                        <label className="form-label">初始库存</label>
                                        <input
                                            type="number"
                                            className="form-control"
                                            value={formData.stock_quantity}
                                            onChange={(e) => handleChange('stock_quantity', e.target.value)}
                                        />
                                    </div>
                                    <div className="form-group">
                                        <label className="form-label">最低库存提醒</label>
                                        <input
                                            type="number"
                                            className="form-control"
                                            value={formData.min_stock_threshold}
                                            onChange={(e) => handleChange('min_stock_threshold', e.target.value)}
                                        />
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <div className="modal-footer">
                            <button onClick={onCancel} className="btn btn--secondary">
                                取消
                            </button>
                            <button onClick={handleSubmit} className="btn btn--primary" disabled={uploading}>
                                添加产品
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 📊 完整库存管理组件
        const InventoryManager = () => {
            const [products, setProducts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [stats, setStats] = useState({
                totalStock: 0,
                stockValue: 0,
                lowStockCount: 0,
                outOfStockCount: 0
            });
            
            const fetchInventoryData = useCallback(async () => {
                setLoading(true);
                try {
                    const { data, error } = await supabase
                        .from('products')
                        .select('*')
                        .order('name');
                    
                    if (error) throw error;
                    
                    const products = data || [];
                    
                    // 计算库存统计（只计算现货商品）
                    const physicalProducts = products.filter(p => !p.is_unlimited);
                    const totalStock = physicalProducts.reduce((sum, p) => sum + (p.stock_quantity || 0), 0);
                    const stockValue = physicalProducts.reduce((sum, p) => sum + ((p.stock_quantity || 0) * (p.price || 0)), 0);
                    const lowStockCount = physicalProducts.filter(p => (p.stock_quantity || 0) <= (p.min_stock_threshold || 5) && (p.stock_quantity || 0) > 0).length;
                    const outOfStockCount = physicalProducts.filter(p => (p.stock_quantity || 0) === 0).length;
                    
                    setProducts(products);
                    setStats({ totalStock, stockValue, lowStockCount, outOfStockCount });
                } catch (error) {
                    console.error('加载库存数据失败:', error);
                } finally {
                    setLoading(false);
                }
            }, []);
            
            useEffect(() => {
                fetchInventoryData();
            }, [fetchInventoryData]);
            
            if (loading) {
                return <LoadingSpinner text="加载库存数据..." />;
            }
            
            return (
                <div className="space-y-6">
                    <div className="page-header">
                        <h2 className="page-title">📊 库存管理</h2>
                        <p className="page-subtitle">监控库存状态和补货提醒</p>
                    </div>
                    
                    {/* 库存统计卡片 */}
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#2563eb' }}>
                                <i className="fas fa-boxes"></i>
                            </div>
                            <div className="stat-content">
                                <h3>总库存</h3>
                                <p className="stat-value" style={{ color: '#2563eb' }}>
                                    {stats.totalStock}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#16a34a' }}>
                                <i className="fas fa-dollar-sign"></i>
                            </div>
                            <div className="stat-content">
                                <h3>库存价值</h3>
                                <p className="stat-value" style={{ color: '#16a34a' }}>
                                    RM{stats.stockValue.toFixed(2)}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#f59e0b' }}>
                                <i className="fas fa-exclamation-triangle"></i>
                            </div>
                            <div className="stat-content">
                                <h3>低库存商品</h3>
                                <p className="stat-value" style={{ color: '#f59e0b' }}>
                                    {stats.lowStockCount}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#ef4444' }}>
                                <i className="fas fa-times-circle"></i>
                            </div>
                            <div className="stat-content">
                                <h3>缺货商品</h3>
                                <p className="stat-value" style={{ color: '#ef4444' }}>
                                    {stats.outOfStockCount}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    {/* 库存详情表格 */}
                    <div className="card">
                        <div className="card__body">
                            <h3 className="text-lg font-semibold mb-4">产品库存详情</h3>
                            <div className="overflow-x-auto">
                                <table className="data-table">
                                    <thead>
                                        <tr>
                                            <th>商品</th>
                                            <th>分类</th>
                                            <th>价格</th>
                                            <th>库存状态</th>
                                            <th>当前库存</th>
                                            <th>最低库存</th>
                                            <th>状态</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {products.map(product => {
                                            const stock = product.stock_quantity ?? 0;
                                            const threshold = product.min_stock_threshold ?? 5;
                                            const isLowStock = !product.is_unlimited && stock <= threshold && stock > 0;
                                            const isOutOfStock = !product.is_unlimited && stock === 0;
                                            
                                            return (
                                                <tr key={product.id}>
                                                    <td>
                                                        <div className="flex items-center gap-2">
                                                            <span className="text-lg">{product.emoji || '🍽️'}</span>
                                                            <span className="font-medium">{product.name}</span>
                                                        </div>
                                                    </td>
                                                    <td>{product.category || '-'}</td>
                                                    <td className="font-medium text-primary">
                                                        RM{Number(product.price || 0).toFixed(2)}
                                                    </td>
                                                    <td>
                                                        {product.is_unlimited ? (
                                                            <span className="status status--success">
                                                                <i className="fas fa-infinity mr-1"></i>预购
                                                            </span>
                                                        ) : isOutOfStock ? (
                                                            <span className="status status--error">
                                                                <i className="fas fa-times-circle mr-1"></i>缺货
                                                            </span>
                                                        ) : isLowStock ? (
                                                            <span className="status status--warning">
                                                                <i className="fas fa-exclamation-triangle mr-1"></i>低库存
                                                            </span>
                                                        ) : (
                                                            <span className="status status--success">
                                                                <i className="fas fa-check-circle mr-1"></i>正常
                                                            </span>
                                                        )}
                                                    </td>
                                                    <td>
                                                        {product.is_unlimited ? '无限制' : stock}
                                                    </td>
                                                    <td>
                                                        {product.is_unlimited ? '-' : threshold}
                                                    </td>
                                                    <td>
                                                        <span className={`status ${
                                                            product.is_published ? 'status--success' : 'status--warning'
                                                        }`}>
                                                            {product.is_published ? '已上架' : '已下架'}
                                                        </span>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                                
                                {products.length === 0 && (
                                    <div className="empty-state">
                                        <div className="empty-state-icon">📦</div>
                                        <p>暂无产品数据</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 📋 完整订单管理组件
        const OrdersManager = () => {
            const [orders, setOrders] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filterStatus, setFilterStatus] = useState('');
            const [filterDelivery, setFilterDelivery] = useState('');
            const [searchText, setSearchText] = useState('');
            const [updating, setUpdating] = useState(null);
            const [toast, setToast] = useState(null);
            const [modalOrder, setModalOrder] = useState(null);
            const [uploadFile, setUploadFile] = useState(null);
            
            const showToast = (message, type = 'success') => {
                setToast({ message, type });
                setTimeout(() => setToast(null), 3000);
            };
            
            const fetchOrders = useCallback(async () => {
                setLoading(true);
                try {
                    const { data, error } = await supabase
                        .from('orders')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    setOrders(data || []);
                } catch (error) {
                    console.error('加载订单失败:', error);
                    showToast('加载订单失败: ' + error.message, 'error');
                } finally {
                    setLoading(false);
                }
            }, []);
            
            useEffect(() => {
                fetchOrders();
            }, [fetchOrders]);
            
            // 过滤订单
            const filteredOrders = useMemo(() => {
                return orders.filter(order => {
                    const matchesStatus = !filterStatus || order.status === filterStatus;
                    const matchesDelivery = !filterDelivery || order.delivery_method === filterDelivery;
                    const matchesSearch = !searchText || 
                        order.order_id.toLowerCase().includes(searchText.toLowerCase()) ||
                        order.name.toLowerCase().includes(searchText.toLowerCase()) ||
                        order.phone.toLowerCase().includes(searchText.toLowerCase());
                    return matchesStatus && matchesDelivery && matchesSearch;
                });
            }, [orders, filterStatus, filterDelivery, searchText]);
            
            // 更新订单状态
            const updateOrderStatus = async (orderId, newStatus) => {
                setUpdating(orderId);
                try {
                    const { error } = await supabase
                        .from('orders')
                        .update({ status: newStatus })
                        .eq('id', orderId);
                    
                    if (error) throw error;
                    showToast('订单状态已更新', 'success');
                    fetchOrders();
                } catch (error) {
                    console.error('更新订单状态失败:', error);
                    showToast('状态更新失败: ' + error.message, 'error');
                } finally {
                    setUpdating(null);
                }
            };
            
            // 复制订单详情
            const copyOrderDetails = async (order) => {
                const orderMsg = buildOrderMessage(order).replace(/\*/g, '');
                const success = await copyTextUniversal(orderMsg);
                showToast(success ? '订单详情已复制' : '复制失败', success ? 'success' : 'error');
            };
            
            // 打印订单
            const printOrder = (order) => {
                const printWindow = window.open('', '_blank', 'width=820,height=900');
                if (!printWindow) {
                    showToast('请允许弹窗', 'error');
                    return;
                }
                
                const doc = printWindow.document;
                doc.open();
                doc.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="utf-8">
                        <title>订单 ${order.order_id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 16px; font-size: 16px; font-weight: bold; }
                            h1 { font-size: 28px; margin: 0 0 12px; font-weight: bold; }
                            div { font-size: 16px; margin: 6px 0; font-weight: bold; }
                            table { width: 100%; border-collapse: collapse; margin-top: 12px; }
                            th, td { border: 2px solid #333; padding: 8px; font-size: 16px; font-weight: bold; }
                            th { background: #f5f5f5; font-size: 18px; }
                            .checkbox { width: 20px; height: 20px; border: 3px solid #333; display: inline-block; margin-left: 10px; }
                            @media print { @page { margin: 10mm; } button { display: none; } }
                        </style>
                    </head>
                    <body>
                        <h1>锋味派订单 #${order.order_id}</h1>
                        <div>客户: ${order.name} (${order.phone})</div>
                        <div>方式: ${order.delivery_method === 'self-pickup' ? '自取' : 'Lalamove送货'}</div>
                        <div>备注: ${order.remarks || '无'}</div>
                        <table>
                            <thead>
                                <tr>
                                    <th>商品</th>
                                    <th style="width:120px;">数量 & 已打包</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${(order.order_items || []).map(item => 
                                    `<tr>
                                        <td>${item.product}</td>
                                        <td style="text-align:center;">${item.quantity}<span class="checkbox"></span></td>
                                    </tr>`
                                ).join('')}
                            </tbody>
                        </table>
                        <div style="margin-top:16px; border-top:2px solid #333; padding-top:10px; font-size:14px; color:#666; font-weight:bold;">
                            打包完成后请在数量旁边的勾选框内打勾 ✓
                        </div>
                        <button onclick="window.print()" style="font-size:16px;font-weight:bold;padding:10px 20px;margin-top:16px;">打印</button>
                    </body>
                    </html>
                `);
                doc.close();
            };
            
            // 上传运费凭证
            const uploadShippingProof = async () => {
                if (!uploadFile || !modalOrder) return;
                
                try {
                    const ext = uploadFile.name.split('.').pop();
                    const path = `proofs/${modalOrder.order_id}-shipping.${ext}`;
                    
                    const { error: uploadError } = await supabase.storage
                        .from('payment-proofs')
                        .upload(path, uploadFile, { upsert: true });
                    
                    if (uploadError) throw uploadError;
                    
                    const { data: { publicUrl } } = supabase.storage
                        .from('payment-proofs')
                        .getPublicUrl(path);
                    
                    const { error: updateError } = await supabase
                        .from('orders')
                        .update({ shipping_payment_proof_url: publicUrl })
                        .eq('order_id', modalOrder.order_id);
                    
                    if (updateError) throw updateError;
                    
                    showToast('运费凭证上传成功', 'success');
                    setUploadFile(null);
                    setModalOrder(null);
                    fetchOrders();
                } catch (error) {
                    console.error('上传失败:', error);
                    showToast('上传失败: ' + error.message, 'error');
                }
            };
            
            const getStatusDisplay = (status) => {
                const statusMap = {
                    'pending': '待处理',
                    'ready for pick up': '待取货',
                    'delivered': '已发货',
                    'completed': '已完成',
                    'cancelled': '已取消'
                };
                return statusMap[status] || status;
            };
            
            const getStatusColor = (status) => {
                const colorMap = {
                    'pending': 'status--warning',
                    'ready for pick up': 'status--info',
                    'delivered': 'status--success',
                    'completed': 'status--success',
                    'cancelled': 'status--error'
                };
                return colorMap[status] || 'status--info';
            };
            
            if (loading) {
                return <LoadingSpinner text="加载订单数据..." />;
            }
            
            return (
                <div className="space-y-6">
                    <div className="page-header">
                        <div>
                            <h2 className="page-title">📋 订单管理</h2>
                            <p className="page-subtitle">
                                处理和跟踪所有订单 ({filteredOrders.length}/{orders.length})
                            </p>
                        </div>
                    </div>
                    
                    {/* 搜索和过滤工具栏 */}
                    <div className="toolbar">
                        <div className="toolbar-left">
                            <div className="flex items-center gap-3 flex-wrap">
                                <input
                                    type="text"
                                    placeholder="搜索订单号、客户姓名或电话"
                                    value={searchText}
                                    onChange={(e) => setSearchText(e.target.value)}
                                    className="form-control"
                                    style={{ minWidth: '250px' }}
                                />
                                <select
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="form-control"
                                >
                                    <option value="">全部状态</option>
                                    <option value="pending">待处理</option>
                                    <option value="ready for pick up">待取货</option>
                                    <option value="delivered">已发货</option>
                                    <option value="completed">已完成</option>
                                    <option value="cancelled">已取消</option>
                                </select>
                                <select
                                    value={filterDelivery}
                                    onChange={(e) => setFilterDelivery(e.target.value)}
                                    className="form-control"
                                >
                                    <option value="">全部方式</option>
                                    <option value="self-pickup">自取</option>
                                    <option value="lalamove">Lalamove送货</option>
                                </select>
                            </div>
                        </div>
                        <div className="toolbar-right">
                            <button onClick={fetchOrders} className="btn btn--secondary">
                                <i className="fas fa-sync-alt mr-2"></i>刷新
                            </button>
                        </div>
                    </div>
                    
                    {/* 订单表格 */}
                    <div className="card">
                        <div className="overflow-x-auto">
                            <table className="data-table">
                                <thead>
                                    <tr>
                                        <th>订单号</th>
                                        <th>客户信息</th>
                                        <th>订单明细</th>
                                        <th>金额</th>
                                        <th>状态</th>
                                        <th>下单时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredOrders.map(order => (
                                        <tr key={order.id}>
                                            <td>
                                                <div>
                                                    <span className="font-bold text-primary">{order.order_id}</span>
                                                    <div className="text-xs text-gray-500 mt-1">
                                                        {order.delivery_method === 'self-pickup' ? '自提' : 'Lalamove配送'}
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div>
                                                    <div className="font-medium">{order.name}</div>
                                                    <div className="text-xs text-gray-500">{order.phone}</div>
                                                    {order.remarks && (
                                                        <div className="text-xs text-gray-500 mt-1">
                                                            备注: {order.remarks}
                                                        </div>
                                                    )}
                                                </div>
                                            </td>
                                            <td className="text-xs">
                                                {(order.order_items || []).map((item, index) => (
                                                    <div key={index} className="mb-1">
                                                        <span className="mr-1">{item.emoji || '▫️'}</span>
                                                        {item.product} × {item.quantity}
                                                    </div>
                                                ))}
                                            </td>
                                            <td>
                                                <span className="font-bold text-primary">
                                                    RM{Number(order.total_amount || 0).toFixed(2)}
                                                </span>
                                            </td>
                                            <td>
                                                {updating === order.id ? (
                                                    <span className="text-xs">更新中...</span>
                                                ) : (
                                                    <div>
                                                        <select
                                                            className="text-xs border rounded px-2 py-1 bg-white mb-2"
                                                            value={order.status}
                                                            onChange={(e) => updateOrderStatus(order.id, e.target.value)}
                                                        >
                                                            <option value="pending">待处理</option>
                                                            <option value="ready for pick up">待取货</option>
                                                            <option value="delivered">已发货</option>
                                                            <option value="completed">已完成</option>
                                                            <option value="cancelled">已取消</option>
                                                        </select>
                                                        <div>
                                                            <span className={`status ${getStatusColor(order.status)}`}>
                                                                {getStatusDisplay(order.status)}
                                                            </span>
                                                        </div>
                                                    </div>
                                                )}
                                            </td>
                                            <td className="text-xs text-gray-500">
                                                {new Date(order.created_at).toLocaleString('zh-CN')}
                                            </td>
                                            <td>
                                                <div className="space-y-1 flex flex-col" style={{ minWidth: '120px' }}>
                                                    {order.payment_proof_url && (
                                                        <a
                                                            href={order.payment_proof_url}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            className="text-blue-600 text-xs underline hover:text-blue-800"
                                                        >
                                                            支付凭证
                                                        </a>
                                                    )}
                                                    <button
                                                        onClick={() => copyOrderDetails(order)}
                                                        className="btn btn--secondary btn-sm text-xs"
                                                    >
                                                        复制详情
                                                    </button>
                                                    <button
                                                        onClick={() => setModalOrder(order)}
                                                        className="btn btn--primary btn-sm text-xs"
                                                    >
                                                        上传运费凭证
                                                    </button>
                                                    <button
                                                        onClick={() => printOrder(order)}
                                                        className="btn btn--success btn-sm text-xs"
                                                    >
                                                        打印订单
                                                    </button>
                                                    {order.shipping_payment_proof_url && (
                                                        <a
                                                            href={order.shipping_payment_proof_url}
                                                            target="_blank"
                                                            rel="noopener noreferrer"
                                                            className="text-purple-600 text-xs underline hover:text-purple-800"
                                                        >
                                                            运费凭证
                                                        </a>
                                                    )}
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            
                            {filteredOrders.length === 0 && (
                                <div className="empty-state">
                                    <div className="empty-state-icon">📋</div>
                                    <p>没有找到符合条件的订单</p>
                                </div>
                            )}
                        </div>
                    </div>
                    
                    {/* 上传运费凭证模态框 */}
                    {modalOrder && (
                        <div className="modal active">
                            <div className="modal-content">
                                <div className="modal-header">
                                    <h3 className="font-semibold">
                                        上传运费凭证 - {modalOrder.order_id}
                                    </h3>
                                    <button
                                        onClick={() => {
                                            setModalOrder(null);
                                            setUploadFile(null);
                                        }}
                                        className="text-gray-500 hover:text-gray-700"
                                    >
                                        <i className="fas fa-times"></i>
                                    </button>
                                </div>
                                <div className="modal-body space-y-3">
                                    <input
                                        type="file"
                                        accept="image/*,.pdf"
                                        onChange={(e) => setUploadFile(e.target.files[0])}
                                        className="form-control"
                                    />
                                    <button
                                        disabled={!uploadFile}
                                        onClick={uploadShippingProof}
                                        className="btn btn--primary w-full"
                                    >
                                        {uploadFile ? '上传凭证' : '请选择文件'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Toast 通知 */}
                    {toast && <Toast {...toast} onDismiss={() => setToast(null)} />}
                </div>
            );
        };
        
        // 👥 完整会员管理组件
        const MembersManager = () => {
            const [members, setMembers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [stats, setStats] = useState({
                totalMembers: 0,
                activeMembers: 0,
                totalPoints: 0,
                avgOrderValue: 0
            });
            
            const fetchMembersData = useCallback(async () => {
                setLoading(true);
                try {
                    const [membersResult, ordersResult] = await Promise.all([
                        supabase.from('members').select('*').order('created_at', { ascending: false }),
                        supabase.from('orders').select('*')
                    ]);
                    
                    const members = membersResult.data || [];
                    const orders = ordersResult.data || [];
                    
                    // 计算会员统计
                    const totalMembers = members.length;
                    const activeMembers = members.filter(m => 
                        orders.some(o => o.phone === m.phone)
                    ).length;
                    const totalPoints = members.reduce((sum, m) => sum + (m.points || 0), 0);
                    const totalOrderValue = orders.reduce((sum, o) => sum + Number(o.total_amount || 0), 0);
                    const avgOrderValue = orders.length > 0 ? totalOrderValue / orders.length : 0;
                    
                    // 为每个会员计算订单统计
                    const membersWithStats = members.map(member => {
                        const memberOrders = orders.filter(o => o.phone === member.phone);
                        const totalSpent = memberOrders.reduce((sum, o) => sum + Number(o.total_amount || 0), 0);
                        const orderCount = memberOrders.length;
                        
                        return {
                            ...member,
                            orderCount,
                            totalSpent,
                            lastOrderDate: memberOrders.length > 0 ? 
                                new Date(Math.max(...memberOrders.map(o => new Date(o.created_at)))).toISOString() : 
                                null
                        };
                    });
                    
                    setMembers(membersWithStats);
                    setStats({ totalMembers, activeMembers, totalPoints, avgOrderValue });
                } catch (error) {
                    console.error('加载会员数据失败:', error);
                } finally {
                    setLoading(false);
                }
            }, []);
            
            useEffect(() => {
                if (window.MEMBER_CONFIG.ENABLE_MEMBER_SYSTEM) {
                    fetchMembersData();
                } else {
                    setLoading(false);
                }
            }, [fetchMembersData]);
            
            if (!window.MEMBER_CONFIG.ENABLE_MEMBER_SYSTEM) {
                return (
                    <div className="space-y-6">
                        <div className="page-header">
                            <h2 className="page-title">👥 会员管理</h2>
                            <p className="page-subtitle">会员系统未启用</p>
                        </div>
                        <div className="card">
                            <div className="card__body text-center py-8">
                                <i className="fas fa-toggle-off text-4xl text-gray-400 mb-4"></i>
                                <p className="text-gray-600">会员系统功能已关闭</p>
                                <p className="text-sm text-gray-500 mt-2">
                                    请在配置中启用 MEMBER_CONFIG.ENABLE_MEMBER_SYSTEM
                                </p>
                            </div>
                        </div>
                    </div>
                );
            }
            
            if (loading) {
                return <LoadingSpinner text="加载会员数据..." />;
            }
            
            return (
                <div className="space-y-6">
                    <div className="page-header">
                        <h2 className="page-title">👥 会员管理</h2>
                        <p className="page-subtitle">管理会员信息和积分系统</p>
                    </div>
                    
                    {/* 会员统计卡片 */}
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#8b5cf6' }}>
                                <i className="fas fa-users"></i>
                            </div>
                            <div className="stat-content">
                                <h3>注册会员</h3>
                                <p className="stat-value" style={{ color: '#8b5cf6' }}>
                                    {stats.totalMembers}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#16a34a' }}>
                                <i className="fas fa-user-check"></i>
                            </div>
                            <div className="stat-content">
                                <h3>活跃会员</h3>
                                <p className="stat-value" style={{ color: '#16a34a' }}>
                                    {stats.activeMembers}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#f59e0b' }}>
                                <i className="fas fa-star"></i>
                            </div>
                            <div className="stat-content">
                                <h3>总积分</h3>
                                <p className="stat-value" style={{ color: '#f59e0b' }}>
                                    {stats.totalPoints}
                                </p>
                            </div>
                        </div>
                        
                        <div className="stat-card">
                            <div className="stat-icon" style={{ color: '#2563eb' }}>
                                <i className="fas fa-chart-line"></i>
                            </div>
                            <div className="stat-content">
                                <h3>平均订单价值</h3>
                                <p className="stat-value" style={{ color: '#2563eb' }}>
                                    RM{stats.avgOrderValue.toFixed(2)}
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    {/* 会员列表 */}
                    <div className="card">
                        <div className="card__body">
                            <h3 className="text-lg font-semibold mb-4">会员列表</h3>
                            <div className="overflow-x-auto">
                                <table className="data-table">
                                    <thead>
                                        <tr>
                                            <th>姓名</th>
                                            <th>电话</th>
                                            <th>积分</th>
                                            <th>订单数</th>
                                            <th>消费总额</th>
                                            <th>最后订单</th>
                                            <th>注册时间</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {members.map(member => (
                                            <tr key={member.id}>
                                                <td className="font-medium">{member.name}</td>
                                                <td>{member.phone}</td>
                                                <td>
                                                    <span className="status status--warning">
                                                        <i className="fas fa-star mr-1"></i>
                                                        {member.points || 0}
                                                    </span>
                                                </td>
                                                <td>{member.orderCount}</td>
                                                <td className="font-medium text-primary">
                                                    RM{member.totalSpent.toFixed(2)}
                                                </td>
                                                <td className="text-sm text-gray-500">
                                                    {member.lastOrderDate ? 
                                                        new Date(member.lastOrderDate).toLocaleDateString('zh-CN') : 
                                                        '无订单'
                                                    }
                                                </td>
                                                <td className="text-sm text-gray-500">
                                                    {new Date(member.created_at).toLocaleDateString('zh-CN')}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                                
                                {members.length === 0 && (
                                    <div className="empty-state">
                                        <div className="empty-state-icon">👥</div>
                                        <p>暂无会员数据</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 📈 数据分析组件
        const Analytics = () => {
            const [analyticsData, setAnalyticsData] = useState({
                salesByMonth: [],
                topProducts: [],
                ordersByStatus: [],
                revenueByCategory: []
            });
            const [loading, setLoading] = useState(true);
            const [chartType, setChartType] = useState('sales');
            
            useEffect(() => {
                const fetchAnalyticsData = async () => {
                    try {
                        const [ordersResult, productsResult] = await Promise.all([
                            supabase.from('orders').select('*').order('created_at', { ascending: false }),
                            supabase.from('products').select('*')
                        ]);
                        
                        const orders = ordersResult.data || [];
                        const products = productsResult.data || [];
                        
                        // 计算每月销售额
                        const salesByMonth = {};
                        orders.forEach(order => {
                            if (order.created_at) {
                                const month = order.created_at.substring(0, 7); // YYYY-MM
                                salesByMonth[month] = (salesByMonth[month] || 0) + Number(order.total_amount || 0);
                            }
                        });
                        
                        // 计算热销产品
                        const productSales = {};
                        orders.forEach(order => {
                            (order.order_items || []).forEach(item => {
                                if (item.product) {
                                    productSales[item.product] = (productSales[item.product] || 0) + (item.quantity || 0);
                                }
                            });
                        });
                        
                        // 订单状态分布
                        const statusCounts = {};
                        orders.forEach(order => {
                            const status = order.status || 'unknown';
                            statusCounts[status] = (statusCounts[status] || 0) + 1;
                        });
                        
                        // 分类收入分析
                        const categoryRevenue = {};
                        orders.forEach(order => {
                            (order.order_items || []).forEach(item => {
                                const product = products.find(p => p.name === item.product);
                                const category = product ? (product.category || '其他') : '其他';
                                const revenue = (item.quantity || 0) * Number(item.price || 0);
                                categoryRevenue[category] = (categoryRevenue[category] || 0) + revenue;
                            });
                        });
                        
                        setAnalyticsData({
                            salesByMonth: Object.entries(salesByMonth).map(([month, sales]) => ({ month, sales })),
                            topProducts: Object.entries(productSales).sort((a, b) => b[1] - a[1]).slice(0, 10),
                            ordersByStatus: Object.entries(statusCounts).map(([status, count]) => ({ status, count })),
                            revenueByCategory: Object.entries(categoryRevenue).map(([category, revenue]) => ({ category, revenue }))
                        });
                    } catch (error) {
                        console.error('获取分析数据失败:', error);
                    } finally {
                        setLoading(false);
                    }
                };
                
                fetchAnalyticsData();
            }, []);
            
            if (loading) {
                return <LoadingSpinner text="加载分析数据..." />;
            }
            
            return (
                <div className="space-y-6">
                    <div className="page-header">
                        <div>
                            <h2 className="page-title">📈 数据分析</h2>
                            <p className="page-subtitle">销售报表和业务洞察</p>
                        </div>
                        <div className="flex gap-2">
                            <select
                                value={chartType}
                                onChange={(e) => setChartType(e.target.value)}
                                className="form-control"
                            >
                                <option value="sales">月度销售</option>
                                <option value="products">热销产品</option>
                                <option value="status">订单状态</option>
                                <option value="category">分类收入</option>
                            </select>
                        </div>
                    </div>
                    
                    {/* 销售趋势图 */}
                    {chartType === 'sales' && (
                        <div className="card">
                            <div className="card__body">
                                <h3 className="text-lg font-semibold mb-4">📊 月度销售趋势</h3>
                                <div className="space-y-3">
                                    {analyticsData.salesByMonth.map((item, index) => (
                                        <div key={index} className="flex items-center gap-4">
                                            <div className="w-20 text-sm font-medium">{item.month}</div>
                                            <div className="flex-1 bg-gray-200 rounded-full h-6 relative">
                                                <div
                                                    className="bg-primary h-full rounded-full flex items-center justify-end pr-2"
                                                    style={{
                                                        width: `${Math.max(10, (item.sales / Math.max(...analyticsData.salesByMonth.map(s => s.sales))) * 100)}%`
                                                    }}
                                                >
                                                    <span className="text-xs text-white font-medium">
                                                        RM{item.sales.toFixed(0)}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* 热销产品 */}
                    {chartType === 'products' && (
                        <div className="card">
                            <div className="card__body">
                                <h3 className="text-lg font-semibold mb-4">🏆 热销产品排行</h3>
                                <div className="space-y-3">
                                    {analyticsData.topProducts.map(([product, quantity], index) => (
                                        <div key={index} className="flex items-center gap-4">
                                            <div className="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold">
                                                {index + 1}
                                            </div>
                                            <div className="flex-1">
                                                <div className="font-medium">{product}</div>
                                                <div className="text-sm text-gray-600">销量: {quantity} 件</div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* 订单状态分布 */}
                    {chartType === 'status' && (
                        <div className="card">
                            <div className="card__body">
                                <h3 className="text-lg font-semibold mb-4">📋 订单状态分布</h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {analyticsData.ordersByStatus.map((item, index) => (
                                        <div key={index} className="text-center">
                                            <div className="text-2xl font-bold text-primary">{item.count}</div>
                                            <div className="text-sm text-gray-600 capitalize">{item.status}</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* 分类收入分析 */}
                    {chartType === 'category' && (
                        <div className="card">
                            <div className="card__body">
                                <h3 className="text-lg font-semibold mb-4">💰 分类收入分析</h3>
                                <div className="space-y-3">
                                    {analyticsData.revenueByCategory.map((item, index) => (
                                        <div key={index} className="flex items-center gap-4">
                                            <div className="w-16 text-sm font-medium">{item.category}</div>
                                            <div className="flex-1 bg-gray-200 rounded-full h-6 relative">
                                                <div
                                                    className="bg-success h-full rounded-full flex items-center justify-end pr-2"
                                                    style={{
                                                        width: `${Math.max(10, (item.revenue / Math.max(...analyticsData.revenueByCategory.map(c => c.revenue))) * 100)}%`
                                                    }}
                                                >
                                                    <span className="text-xs text-white font-medium">
                                                        RM{item.revenue.toFixed(0)}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* 数据概要 */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="card">
                            <div className="card__body text-center">
                                <div className="text-2xl font-bold text-primary">
                                    {analyticsData.salesByMonth.reduce((sum, item) => sum + item.sales, 0).toFixed(2)}
                                </div>
                                <div className="text-sm text-gray-600">总销售额 (RM)</div>
                            </div>
                        </div>
                        <div className="card">
                            <div className="card__body text-center">
                                <div className="text-2xl font-bold text-success">
                                    {analyticsData.ordersByStatus.reduce((sum, item) => sum + item.count, 0)}
                                </div>
                                <div className="text-sm text-gray-600">总订单数</div>
                            </div>
                        </div>
                        <div className="card">
                            <div className="card__body text-center">
                                <div className="text-2xl font-bold text-warning">
                                    {analyticsData.topProducts.reduce((sum, [, quantity]) => sum + quantity, 0)}
                                </div>
                                <div className="text-sm text-gray-600">总销售件数</div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 📱 扫码功能组件
        const Scanner = () => {
            const [isScanning, setIsScanning] = useState(false);
            const [scannedResults, setScannedResults] = useState([]);
            const [scanMode, setScanMode] = useState('qr'); // 'qr' or 'barcode'
            const scannerRef = useRef(null);
            
            useEffect(() => {
                let html5QrcodeScanner = null;
                
                if (isScanning && scannerRef.current) {
                    try {
                        html5QrcodeScanner = new Html5QrcodeScanner(
                            "qr-reader", 
                            { 
                                fps: 10, 
                                qrbox: { width: 250, height: 250 },
                                rememberLastUsedCamera: true,
                                supportedScanTypes: scanMode === 'qr' 
                                    ? [Html5QrcodeScanType.SCAN_TYPE_CAMERA] 
                                    : [Html5QrcodeScanType.SCAN_TYPE_CAMERA]
                            },
                            false
                        );
                        
                        html5QrcodeScanner.render(onScanSuccess, onScanFailure);
                    } catch (error) {
                        console.error('扫码器初始化失败:', error);
                    }
                }
                
                return () => {
                    if (html5QrcodeScanner) {
                        html5QrcodeScanner.clear().catch(error => {
                            console.error('清理扫码器失败:', error);
                        });
                    }
                };
            }, [isScanning, scanMode]);
            
            const onScanSuccess = (decodedText, decodedResult) => {
                const timestamp = new Date().toLocaleString('zh-CN');
                const newResult = {
                    id: Date.now(),
                    text: decodedText,
                    format: decodedResult.result?.format,
                    timestamp: timestamp,
                    type: scanMode
                };
                
                setScannedResults(prev => [newResult, ...prev]);
                
                // 显示扫码成功通知
                showToast(`扫码成功: ${decodedText}`, 'success');
            };
            
            const onScanFailure = (error) => {
                // 扫码失败，通常是因为没有找到码，可以忽略
            };
            
            const startScanning = () => {
                setIsScanning(true);
            };
            
            const stopScanning = () => {
                setIsScanning(false);
            };
            
            const clearResults = () => {
                setScannedResults([]);
            };
            
            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    showToast('已复制到剪贴板', 'success');
                } catch (error) {
                    showToast('复制失败', 'error');
                }
            };
            
            const showToast = (message, type) => {
                // 简单的Toast通知实现
                const toast = document.createElement('div');
                toast.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-md text-white ${
                    type === 'success' ? 'bg-green-500' : 'bg-red-500'
                }`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 3000);
            };
            
            return (
                <div className="space-y-6">
                    <div className="page-header">
                        <div>
                            <h2 className="page-title">📱 扫码功能</h2>
                            <p className="page-subtitle">二维码和条形码扫描</p>
                        </div>
                        <div className="flex gap-2">
                            <select
                                value={scanMode}
                                onChange={(e) => setScanMode(e.target.value)}
                                className="form-control"
                                disabled={isScanning}
                            >
                                <option value="qr">二维码</option>
                                <option value="barcode">条形码</option>
                            </select>
                        </div>
                    </div>
                    
                    {/* 扫码控制面板 */}
                    <div className="card">
                        <div className="card__body">
                            <div className="flex flex-col md:flex-row gap-4 items-center">
                                <div className="flex-1">
                                    {isScanning ? (
                                        <div className="flex items-center gap-3 text-green-600">
                                            <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                            <span className="font-medium">扫码器运行中...</span>
                                        </div>
                                    ) : (
                                        <div className="flex items-center gap-3 text-gray-600">
                                            <div className="w-3 h-3 bg-gray-400 rounded-full"></div>
                                            <span>扫码器已停止</span>
                                        </div>
                                    )}
                                </div>
                                <div className="flex gap-2">
                                    {!isScanning ? (
                                        <button
                                            onClick={startScanning}
                                            className="btn btn--primary"
                                        >
                                            <i className="fas fa-play mr-2"></i>
                                            开始扫码
                                        </button>
                                    ) : (
                                        <button
                                            onClick={stopScanning}
                                            className="btn btn--danger"
                                        >
                                            <i className="fas fa-stop mr-2"></i>
                                            停止扫码
                                        </button>
                                    )}
                                    {scannedResults.length > 0 && (
                                        <button
                                            onClick={clearResults}
                                            className="btn btn--secondary"
                                        >
                                            <i className="fas fa-trash mr-2"></i>
                                            清空记录
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* 扫码区域 */}
                    {isScanning && (
                        <div className="card">
                            <div className="card__body">
                                <div className="text-center mb-4">
                                    <h3 className="text-lg font-semibold">
                                        {scanMode === 'qr' ? '📱 请对准二维码' : '🏷️ 请对准条形码'}
                                    </h3>
                                    <p className="text-gray-600 text-sm mt-1">
                                        请将摄像头对准要扫描的码，保持稳定
                                    </p>
                                </div>
                                <div id="qr-reader" style={{ width: '100%' }}></div>
                            </div>
                        </div>
                    )}
                    
                    {/* 扫码结果 */}
                    {scannedResults.length > 0 && (
                        <div className="card">
                            <div className="card__body">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-lg font-semibold">📋 扫码记录</h3>
                                    <span className="text-sm text-gray-600">
                                        共 {scannedResults.length} 条记录
                                    </span>
                                </div>
                                
                                <div className="space-y-3 max-h-96 overflow-y-auto">
                                    {scannedResults.map((result) => (
                                        <div key={result.id} className="border border-gray-200 rounded-lg p-4">
                                            <div className="flex items-start justify-between gap-3">
                                                <div className="flex-1">
                                                    <div className="flex items-center gap-2 mb-2">
                                                        <span className="text-lg">
                                                            {result.type === 'qr' ? '📱' : '🏷️'}
                                                        </span>
                                                        <span className="text-xs bg-gray-100 px-2 py-1 rounded">
                                                            {result.type === 'qr' ? '二维码' : '条形码'}
                                                        </span>
                                                        <span className="text-xs text-gray-500">
                                                            {result.timestamp}
                                                        </span>
                                                    </div>
                                                    <div className="bg-gray-50 rounded p-3 font-mono text-sm break-all">
                                                        {result.text}
                                                    </div>
                                                    {result.format && (
                                                        <div className="mt-2 text-xs text-gray-600">
                                                            格式: {result.format}
                                                        </div>
                                                    )}
                                                </div>
                                                <button
                                                    onClick={() => copyToClipboard(result.text)}
                                                    className="btn btn--secondary btn-sm"
                                                    title="复制内容"
                                                >
                                                    <i className="fas fa-copy"></i>
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* 使用说明 */}
                    <div className="card">
                        <div className="card__body">
                            <h3 className="text-lg font-semibold mb-3">📖 使用说明</h3>
                            <div className="space-y-2 text-sm text-gray-600">
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-check-circle text-green-500 mt-0.5"></i>
                                    <span>点击"开始扫码"按钮激活摄像头</span>
                                </div>
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-check-circle text-green-500 mt-0.5"></i>
                                    <span>将设备摄像头对准二维码或条形码</span>
                                </div>
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-check-circle text-green-500 mt-0.5"></i>
                                    <span>保持稳定直到自动识别成功</span>
                                </div>
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-check-circle text-green-500 mt-0.5"></i>
                                    <span>扫码结果会自动保存并可复制到剪贴板</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 📸 拍照功能组件
        const Camera = () => {
            const [isCamera, setIsCamera] = useState(false);
            const [capturedPhotos, setCapturedPhotos] = useState([]);
            const [uploading, setUploading] = useState(false);
            const videoRef = useRef(null);
            const canvasRef = useRef(null);
            const streamRef = useRef(null);
            
            useEffect(() => {
                return () => {
                    // 清理摄像头资源
                    if (streamRef.current) {
                        streamRef.current.getTracks().forEach(track => track.stop());
                    }
                };
            }, []);
            
            const startCamera = async () => {
                try {
                    const constraints = {
                        video: {
                            width: { ideal: 1280 },
                            height: { ideal: 720 },
                            facingMode: 'environment' // 后置摄像头
                        },
                        audio: false
                    };
                    
                    const stream = await navigator.mediaDevices.getUserMedia(constraints);
                    streamRef.current = stream;
                    
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                        videoRef.current.play();
                    }
                    
                    setIsCamera(true);
                    showToast('摄像头启动成功', 'success');
                } catch (error) {
                    console.error('启动摄像头失败:', error);
                    showToast('无法访问摄像头，请检查权限设置', 'error');
                }
            };
            
            const stopCamera = () => {
                if (streamRef.current) {
                    streamRef.current.getTracks().forEach(track => track.stop());
                    streamRef.current = null;
                }
                
                if (videoRef.current) {
                    videoRef.current.srcObject = null;
                }
                
                setIsCamera(false);
                showToast('摄像头已停止', 'success');
            };
            
            const capturePhoto = () => {
                if (!videoRef.current || !canvasRef.current) return;
                
                const video = videoRef.current;
                const canvas = canvasRef.current;
                const context = canvas.getContext('2d');
                
                // 设置画布尺寸
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // 绘制视频帧到画布
                context.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // 转换为Base64图片
                const imageData = canvas.toDataURL('image/jpeg', 0.8);
                const timestamp = new Date().toLocaleString('zh-CN');
                
                const newPhoto = {
                    id: Date.now(),
                    data: imageData,
                    timestamp: timestamp,
                    size: Math.round(imageData.length * 0.75), // 估算文件大小
                    uploaded: false
                };
                
                setCapturedPhotos(prev => [newPhoto, ...prev]);
                showToast('照片拍摄成功', 'success');
            };
            
            const deletePhoto = (photoId) => {
                setCapturedPhotos(prev => prev.filter(photo => photo.id !== photoId));
                showToast('照片已删除', 'success');
            };
            
            const uploadPhoto = async (photo) => {
                if (!photo || photo.uploaded) return;
                
                try {
                    setUploading(true);
                    
                    // 将Base64转换为Blob
                    const response = await fetch(photo.data);
                    const blob = await response.blob();
                    
                    const fileName = `product_${Date.now()}.jpg`;
                    
                    // 上传到Supabase Storage
                    const { data, error } = await supabase.storage
                        .from('product-photos')
                        .upload(fileName, blob, {
                            contentType: 'image/jpeg',
                            upsert: true
                        });
                    
                    if (error) throw error;
                    
                    // 更新照片状态
                    setCapturedPhotos(prev => prev.map(p => 
                        p.id === photo.id ? { ...p, uploaded: true, uploadPath: data.path } : p
                    ));
                    
                    showToast('照片上传成功', 'success');
                } catch (error) {
                    console.error('照片上传失败:', error);
                    showToast('上传失败: ' + error.message, 'error');
                } finally {
                    setUploading(false);
                }
            };
            
            const downloadPhoto = (photo) => {
                const link = document.createElement('a');
                link.href = photo.data;
                link.download = `photo_${photo.timestamp.replace(/[:/\s]/g, '_')}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };
            
            const showToast = (message, type) => {
                const toast = document.createElement('div');
                toast.className = `fixed top-4 right-4 z-50 px-4 py-2 rounded-md text-white ${
                    type === 'success' ? 'bg-green-500' : 'bg-red-500'
                }`;
                toast.textContent = message;
                document.body.appendChild(toast);
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 3000);
            };
            
            return (
                <div className="space-y-6">
                    <div className="page-header">
                        <div>
                            <h2 className="page-title">📸 拍照功能</h2>
                            <p className="page-subtitle">商品拍照和图片管理</p>
                        </div>
                    </div>
                    
                    {/* 相机控制面板 */}
                    <div className="card">
                        <div className="card__body">
                            <div className="flex flex-col md:flex-row gap-4 items-center">
                                <div className="flex-1">
                                    {isCamera ? (
                                        <div className="flex items-center gap-3 text-green-600">
                                            <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                            <span className="font-medium">摄像头运行中...</span>
                                        </div>
                                    ) : (
                                        <div className="flex items-center gap-3 text-gray-600">
                                            <div className="w-3 h-3 bg-gray-400 rounded-full"></div>
                                            <span>摄像头已停止</span>
                                        </div>
                                    )}
                                </div>
                                <div className="flex gap-2">
                                    {!isCamera ? (
                                        <button
                                            onClick={startCamera}
                                            className="btn btn--primary"
                                        >
                                            <i className="fas fa-video mr-2"></i>
                                            启动摄像头
                                        </button>
                                    ) : (
                                        <>
                                            <button
                                                onClick={capturePhoto}
                                                className="btn btn--success"
                                            >
                                                <i className="fas fa-camera mr-2"></i>
                                                拍照
                                            </button>
                                            <button
                                                onClick={stopCamera}
                                                className="btn btn--danger"
                                            >
                                                <i className="fas fa-stop mr-2"></i>
                                                停止
                                            </button>
                                        </>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* 摄像头视频预览 */}
                    {isCamera && (
                        <div className="card">
                            <div className="card__body">
                                <div className="text-center mb-4">
                                    <h3 className="text-lg font-semibold">📷 摄像头预览</h3>
                                    <p className="text-gray-600 text-sm mt-1">
                                        调整好角度后点击"拍照"按钮
                                    </p>
                                </div>
                                <div className="relative bg-black rounded-lg overflow-hidden" style={{ maxWidth: '100%', aspectRatio: '16/9' }}>
                                    <video
                                        ref={videoRef}
                                        autoPlay
                                        playsInline
                                        muted
                                        className="w-full h-full object-contain"
                                    />
                                </div>
                                <canvas ref={canvasRef} className="hidden" />
                            </div>
                        </div>
                    )}
                    
                    {/* 拍摄的照片gallery */}
                    {capturedPhotos.length > 0 && (
                        <div className="card">
                            <div className="card__body">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-lg font-semibold">📸 拍摄记录</h3>
                                    <span className="text-sm text-gray-600">
                                        共 {capturedPhotos.length} 张照片
                                    </span>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {capturedPhotos.map((photo) => (
                                        <div key={photo.id} className="border border-gray-200 rounded-lg overflow-hidden">
                                            <div className="aspect-video bg-gray-100">
                                                <img
                                                    src={photo.data}
                                                    alt={`拍摄于 ${photo.timestamp}`}
                                                    className="w-full h-full object-cover"
                                                />
                                            </div>
                                            <div className="p-3">
                                                <div className="text-xs text-gray-600 mb-2">
                                                    {photo.timestamp}
                                                </div>
                                                <div className="text-xs text-gray-500 mb-3">
                                                    大小: {(photo.size / 1024).toFixed(1)} KB
                                                    {photo.uploaded && (
                                                        <span className="ml-2 text-green-600">
                                                            <i className="fas fa-check-circle mr-1"></i>
                                                            已上传
                                                        </span>
                                                    )}
                                                </div>
                                                <div className="flex gap-2">
                                                    <button
                                                        onClick={() => downloadPhoto(photo)}
                                                        className="btn btn--secondary btn-sm flex-1"
                                                        title="下载照片"
                                                    >
                                                        <i className="fas fa-download"></i>
                                                    </button>
                                                    {!photo.uploaded && (
                                                        <button
                                                            onClick={() => uploadPhoto(photo)}
                                                            disabled={uploading}
                                                            className="btn btn--primary btn-sm flex-1"
                                                            title="上传到云端"
                                                        >
                                                            <i className="fas fa-cloud-upload-alt"></i>
                                                        </button>
                                                    )}
                                                    <button
                                                        onClick={() => deletePhoto(photo.id)}
                                                        className="btn btn--danger btn-sm"
                                                        title="删除照片"
                                                    >
                                                        <i className="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* 使用说明 */}
                    <div className="card">
                        <div className="card__body">
                            <h3 className="text-lg font-semibold mb-3">📖 使用说明</h3>
                            <div className="space-y-2 text-sm text-gray-600">
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-check-circle text-green-500 mt-0.5"></i>
                                    <span>点击"启动摄像头"允许浏览器访问摄像头</span>
                                </div>
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-check-circle text-green-500 mt-0.5"></i>
                                    <span>调整设备角度确保商品清晰可见</span>
                                </div>
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-check-circle text-green-500 mt-0.5"></i>
                                    <span>点击"拍照"按钮捕获当前画面</span>
                                </div>
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-check-circle text-green-500 mt-0.5"></i>
                                    <span>照片可下载到本地或上传到云端存储</span>
                                </div>
                                <div className="flex items-start gap-2">
                                    <i className="fas fa-info-circle text-blue-500 mt-0.5"></i>
                                    <span>建议使用后置摄像头获得更好的拍摄效果</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // 渲染应用
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</body>
</html>
